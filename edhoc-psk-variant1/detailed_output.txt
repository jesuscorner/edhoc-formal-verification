theory edhoc_psk_variant1 begin

// Function signature and definition of the equational theory E

builtins: diffie-hellman
functions: aeaddec/3[destructor], aeadenc/4, check_grp/1, decxor/2,
           edhoc_kdf/4, edhoc_mac_length/0, error_code_one/0, error_code_two/0,
           fst/1[destructor], get_psk/1[destructor], grpid/0, hash/1, hash_length/0,
           hkdfexpand/2, hkdfextract/2, iv_length/0, key_length/0,
           method_psk_variant1/0, pair/2, plaintext_length/0, psk_cred/1, psk_id/1,
           snd/1[destructor], suitesIConst/0, suitesRConst/0, wrap/1
equations:
    aeaddec(aeadenc(m, r, k, ad), k, ad) = m,
    fst(<x.1, x.2>) = x.1,
    get_psk(psk_cred(psk)) = psk,
    snd(<x.1, x.2>) = x.2

heuristic: p



restriction Equality:
  "∀ x y #i. (Eq( x, y ) @ #i) ⇒ (x = y)"
  // safety formula

restriction Inequality:
  "∀ x #i. (Neq( x, x ) @ #i) ⇒ (⊥)"
  // safety formula

restriction OnlyOnceHonest:
  "∀ pk #i #j. ((Honest( pk ) @ #i) ∧ (Honest( pk ) @ #j)) ⇒ (#i = #j)"
  // safety formula





















restriction MethodOk:
  "∀ method #i. (MethodOk( method ) @ #i) ⇒ (method = method_psk_variant1)"
  // safety formula

restriction GroupCheck:
  "∀ elem #i. (GroupCheck( elem ) @ #i) ⇒ (¬(elem = grpid))"
  // safety formula

lemma secretPSK [reuse]:
  all-traces
  "∀ psk #i #j.
    ((PSKGenerated( psk ) @ #i) ∧ (!KU( psk ) @ #j)) ⇒
    (∃ #t. CompromisePSK( psk ) @ #t)"
/*
guarded formula characterizing all counter-examples:
"∃ psk #i #j.
  (PSKGenerated( psk ) @ #i) ∧ (!KU( psk ) @ #j)
 ∧
  ∀ #t. (CompromisePSK( psk ) @ #t) ⇒ ⊥"
*/
by sorry

lemma secretShares [reuse]:
  all-traces "∀ k #i #j. ((Share( k ) @ #i) ∧ (!KU( k ) @ #j)) ⇒ (⊥)"
/*
guarded formula characterizing all counter-examples:
"∃ k #i #j. (Share( k ) @ #i) ∧ (!KU( k ) @ #j)"
*/
by sorry

lemma secretR_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk k3 ko y gx #i #j #k.
    ((((AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
        ) @ #i) ∧
       (SessionSecrets_R( cid, y, gx, ko ) @ #i)) ∧
      (!KU( ko ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t. (CompromisePSK( psk_id ) @ #t) ∧ (#t < #i)) ∨
       (∃ #t. LeakSessionKey( ko ) @ #t)) ∨
      (∃ #t. LeakShare( y ) @ #t)) ∨
     (∃ #t. LeakShare( gx ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 ko y gx #i #j #k.
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #i) ∧
  (SessionSecrets_R( cid, y, gx, ko ) @ #i) ∧
  (!KU( ko ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ¬(#t < #i)) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma secretI_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk k3 k4 ko x gy #i #j #k.
    ((((AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4,
                     ko
        ) @ #i) ∧
       (SessionSecrets_I( cid, x, gy, ko ) @ #i)) ∧
      (!KU( ko ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t. (CompromisePSK( psk_id ) @ #t) ∧ (#t < #i)) ∨
       (∃ #t. LeakSessionKey( ko ) @ #t)) ∨
      (∃ #t. LeakShare( x ) @ #t)) ∨
     (∃ #t. LeakShare( gy ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 k4 ko x gy #i #j #k.
  (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
   ) @ #i) ∧
  (SessionSecrets_I( cid, x, gy, ko ) @ #i) ∧
  (!KU( ko ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ¬(#t < #i)) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( x ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gy ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma forwardSecrecy_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk k3 ko y gx #i #j #k #l.
    ((((((AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
          ) @ #i) ∧
         (SessionSecrets_R( cid, y, gx, ko ) @ #i)) ∧
        (!KU( ko ) @ #j)) ∧
       (CompromisePSK( psk_id ) @ #k)) ∧
      (HonestPSK( psk_id ) @ #l)) ∧
     (#i < #k)) ⇒
    (((∃ #t. LeakSessionKey( ko ) @ #t) ∨
      (∃ #t. (LeakShare( y ) @ #t) ∧ (#t < #k))) ∨
     (∃ #t. (LeakShare( gx ) @ #t) ∧ (#t < #k)))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 ko y gx #i #j #k #l.
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #i) ∧
  (SessionSecrets_R( cid, y, gx, ko ) @ #i) ∧
  (!KU( ko ) @ #j) ∧
  (CompromisePSK( psk_id ) @ #k) ∧
  (HonestPSK( psk_id ) @ #l)
 ∧
  (#i < #k) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ¬(#t < #k)) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ¬(#t < #k))"
*/
by sorry

lemma honestauthRI_PSK_non_inj:
  all-traces
  "∀ cid psk_id id_cred_psk k3 ko y gx #i #k.
    (((AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
       ) @ #i) ∧
      (SessionSecrets_R( cid, y, gx, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (((∃ #t x gy k4 ko2 cid2.
        ((#t < #i) ∧
         (AcceptI_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko2
          ) @ #t)) ∧
        (SessionSecrets_I( cid2, x, gy, ko2 ) @ #t)) ∨
      (∃ #t. CompromisePSK( psk_id ) @ #t)) ∨
     (∃ #t. LeakShare( y ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 ko y gx #i #k.
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #i) ∧
  (SessionSecrets_R( cid, y, gx, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t x gy k4 ko2 cid2.
    (AcceptI_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko2
     ) @ #t) ∧
    (SessionSecrets_I( cid2, x, gy, ko2 ) @ #t)
   ⇒
    ¬(#t < #i)) ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma honestauthRI_PSK_unique:
  all-traces
  "∀ cid psk_id id_cred_psk k3 ko y gx #i #j #k.
    ((((AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
        ) @ #i) ∧
       (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
        ) @ #j)) ∧
      (SessionSecrets_R( cid, y, gx, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (((∃ #t. CompromisePSK( psk_id ) @ #t) ∨ (∃ #t. LeakShare( y ) @ #t)) ∨
     (#i = #j))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 ko y gx #i #j #k.
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #i) ∧
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #j) ∧
  (SessionSecrets_R( cid, y, gx, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (¬(#i = #j))"
*/
by sorry

lemma honestauthIR_PSK_non_inj:
  all-traces
  "∀ cid psk_id id_cred_psk k3 k4 ko x gy #i #k.
    (((AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
       ) @ #i) ∧
      (SessionSecrets_I( cid, x, gy, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (((∃ #j y gx cid2 k3_r.
        (#j < #i) ∧
        (DerivedR_PSK( cid2, psk_id, id_cred_psk, k3_r, y, gx ) @ #j)) ∨
      (∃ #t. CompromisePSK( psk_id ) @ #t)) ∨
     (∃ #t. LeakShare( x ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 k4 ko x gy #i #k.
  (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
   ) @ #i) ∧
  (SessionSecrets_I( cid, x, gy, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #j y gx cid2 k3_r.
    (DerivedR_PSK( cid2, psk_id, id_cred_psk, k3_r, y, gx ) @ #j)
   ⇒
    ¬(#j < #i)) ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( x ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma honestauthIR_PSK_unique:
  all-traces
  "∀ cid psk_id id_cred_psk k3 k4 ko x gy #i #j #k.
    ((((AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4,
                     ko
        ) @ #i) ∧
       (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
        ) @ #j)) ∧
      (SessionSecrets_I( cid, x, gy, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (((∃ #t. CompromisePSK( psk_id ) @ #t) ∨ (∃ #t. LeakShare( x ) @ #t)) ∨
     (#i = #j))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 k4 ko x gy #i #j #k.
  (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
   ) @ #i) ∧
  (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
   ) @ #j) ∧
  (SessionSecrets_I( cid, x, gy, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( x ) @ #t) ⇒ ⊥) ∧
  (¬(#i = #j))"
*/
by sorry

lemma sessionKeyAgreement_PSK:
  all-traces
  "∀ cid1 cid2 psk_id id_cred_psk k3_i k3_r k4 ko_i ko_r x y gx gy #i #j
     #k.
    (((((AcceptI_PSK( cid1, method_psk_variant1, psk_id, id_cred_psk, k3_i,
                      k4, ko_i
         ) @ #i) ∧
        (AcceptR_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3_r, ko_r
         ) @ #j)) ∧
       (SessionSecrets_I( cid1, x, gy, ko_i ) @ #i)) ∧
      (SessionSecrets_R( cid2, y, gx, ko_r ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (ko_i = ko_r)"
/*
guarded formula characterizing all counter-examples:
"∃ cid1 cid2 psk_id id_cred_psk k3_i k3_r k4 ko_i ko_r x y gx gy #i #j
   #k.
  (AcceptI_PSK( cid1, method_psk_variant1, psk_id, id_cred_psk, k3_i, k4,
                ko_i
   ) @ #i) ∧
  (AcceptR_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3_r, ko_r
   ) @ #j) ∧
  (SessionSecrets_I( cid1, x, gy, ko_i ) @ #i) ∧
  (SessionSecrets_R( cid2, y, gx, ko_r ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  ¬(ko_i = ko_r)"
*/
by sorry

lemma data_authentication_I_to_R_PSK:
  all-traces
  "∀ psk_id id_cred_psk TH_2 TH_3 TH_4 suitesI EAD_1 EAD_2 EAD_3 m1 m2 m3
     #i #j x gy PRK_out.
    ((AcceptIData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, x,
                       gy, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m1, m2, m3>
      ) @ #i) ∧
     (HonestPSK( psk_id ) @ #j)) ⇒
    (((∃ #l m11 m22.
        (#l < #i) ∧
        (SendRData_PSK( method_psk_variant1, psk_id,
                        <TH_2, suitesI, EAD_1, EAD_2, m11, m22>
         ) @ #l)) ∨
      (∃ #l. (#l < #i) ∧ (CompromisePSK( psk_id ) @ #l))) ∨
     (∃ #l. LeakShare( x ) @ #l))"
/*
guarded formula characterizing all counter-examples:
"∃ psk_id id_cred_psk TH_2 TH_3 TH_4 suitesI EAD_1 EAD_2 EAD_3 m1 m2 m3
   #i #j x gy PRK_out.
  (AcceptIData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, x,
                    gy, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m1, m2, m3>
   ) @ #i) ∧
  (HonestPSK( psk_id ) @ #j)
 ∧
  (∀ #l m11 m22.
    (SendRData_PSK( method_psk_variant1, psk_id,
                    <TH_2, suitesI, EAD_1, EAD_2, m11, m22>
     ) @ #l)
   ⇒
    ¬(#l < #i)) ∧
  (∀ #l. (CompromisePSK( psk_id ) @ #l) ⇒ ¬(#l < #i)) ∧
  (∀ #l. (LeakShare( x ) @ #l) ⇒ ⊥)"
*/
by sorry

lemma data_authentication_R_to_I_PSK:
  all-traces
  "∀ psk_id id_cred_psk y gx TH_2 TH_3 TH_4 suitesI EAD_1 EAD_2 EAD_3 m1 m2
     m3 #i #j PRK_out.
    ((AcceptRData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, y,
                       gx, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m1, m2, m3>
      ) @ #i) ∧
     (HonestPSK( psk_id ) @ #j)) ⇒
    (((∃ #l gy x m11 m22 m33.
        (#l < #i) ∧
        (AcceptIData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, x,
                          gy, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m11, m22, m33>
         ) @ #l)) ∨
      (∃ #l. (#l < #i) ∧ (CompromisePSK( psk_id ) @ #l))) ∨
     (∃ #l. LeakShare( y ) @ #l))"
/*
guarded formula characterizing all counter-examples:
"∃ psk_id id_cred_psk y gx TH_2 TH_3 TH_4 suitesI EAD_1 EAD_2 EAD_3 m1 m2
   m3 #i #j PRK_out.
  (AcceptRData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, y,
                    gx, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m1, m2, m3>
   ) @ #i) ∧
  (HonestPSK( psk_id ) @ #j)
 ∧
  (∀ #l gy x m11 m22 m33.
    (AcceptIData_PSK( PRK_out, method_psk_variant1, psk_id, id_cred_psk, x,
                      gy, <TH_2, TH_3, TH_4, suitesI, EAD_1, EAD_2, EAD_3, m11, m22, m33>
     ) @ #l)
   ⇒
    ¬(#l < #i)) ∧
  (∀ #l. (CompromisePSK( psk_id ) @ #l) ⇒ ¬(#l < #i)) ∧
  (∀ #l. (LeakShare( y ) @ #l) ⇒ ⊥)"
*/
by sorry

lemma psk_identity_privacy_variant1 [output=[proverif]]:
  all-traces
  "∀ cid psk_id id_cred_psk #i #j.
    ((InitiatorStart_PSK( cid, psk_id, id_cred_psk ) @ #i) ∧
     (!KU( id_cred_psk ) @ #j)) ⇒
    (⊥)"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk #i #j.
  (InitiatorStart_PSK( cid, psk_id, id_cred_psk ) @ #i) ∧
  (!KU( id_cred_psk ) @ #j)"
*/
by sorry

lemma no_reflection_attacks_RI_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk k3 ko y gx #i #k.
    (((AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
       ) @ #i) ∧
      (SessionSecrets_R( cid, y, gx, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t x gy k4 ko2 cid2.
         (((#t < #i) ∧
           (AcceptI_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko2
            ) @ #t)) ∧
          (SessionSecrets_I( cid2, x, gy, ko2 ) @ #t)) ∧
         (¬(cid = cid2))) ∨
       (∃ #t. CompromisePSK( psk_id ) @ #t)) ∨
      (∃ #t. LeakShare( y ) @ #t)) ∨
     (∃ #t. LeakShare( gx ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 ko y gx #i #k.
  (AcceptR_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, ko
   ) @ #i) ∧
  (SessionSecrets_R( cid, y, gx, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t x gy k4 ko2 cid2.
    (AcceptI_PSK( cid2, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko2
     ) @ #t) ∧
    (SessionSecrets_I( cid2, x, gy, ko2 ) @ #t)
   ⇒
    ((¬(#t < #i)) ∨ (cid = cid2))) ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma no_reflection_attacks_IR_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk k3 k4 ko gy x #i #k.
    (((AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
       ) @ #i) ∧
      (SessionSecrets_I( cid, x, gy, ko ) @ #i)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    (((∃ #j y gx cid2 k3_r.
        ((#j < #i) ∧
         (DerivedR_PSK( cid2, psk_id, id_cred_psk, k3_r, y, gx ) @ #j)) ∧
        (¬(cid = cid2))) ∨
      (∃ #t. CompromisePSK( psk_id ) @ #t)) ∨
     (∃ #t. LeakShare( x ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk k3 k4 ko gy x #i #k.
  (AcceptI_PSK( cid, method_psk_variant1, psk_id, id_cred_psk, k3, k4, ko
   ) @ #i) ∧
  (SessionSecrets_I( cid, x, gy, ko ) @ #i) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #j y gx cid2 k3_r.
    (DerivedR_PSK( cid2, psk_id, id_cred_psk, k3_r, y, gx ) @ #j)
   ⇒
    ((¬(#j < #i)) ∨ (cid = cid2))) ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( x ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma secretR_PRK_2e_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
     #k.
    (((SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                     ks2, k3, iv3, y, gx
       ) @ #i) ∧
      (!KU( prk2e ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t. (CompromisePSK( psk_id ) @ #t) ∧ (#t < #i)) ∨
       (∃ #t. LeakSessionKey( ko ) @ #t)) ∨
      (∃ #t. LeakShare( y ) @ #t)) ∨
     (∃ #t. LeakShare( gx ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
   #k.
  (SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                 ks2, k3, iv3, y, gx
   ) @ #i) ∧
  (!KU( prk2e ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ¬(#t < #i)) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma secretR_ks2_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
     #k.
    (((SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                     ks2, k3, iv3, y, gx
       ) @ #i) ∧
      (!KU( ks2 ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t. (CompromisePSK( psk_id ) @ #t) ∧ (#t < #i)) ∨
       (∃ #t. LeakSessionKey( ko ) @ #t)) ∨
      (∃ #t. LeakShare( y ) @ #t)) ∨
     (∃ #t. LeakShare( gx ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
   #k.
  (SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                 ks2, k3, iv3, y, gx
   ) @ #i) ∧
  (!KU( ks2 ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ¬(#t < #i)) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ⊥)"
*/
by sorry

lemma secretR_k3_PSK:
  all-traces
  "∀ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
     #k.
    (((SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                     ks2, k3, iv3, y, gx
       ) @ #i) ∧
      (!KU( k3 ) @ #j)) ∧
     (HonestPSK( psk_id ) @ #k)) ⇒
    ((((∃ #t. (CompromisePSK( psk_id ) @ #t) ∧ (#t < #i)) ∨
       (∃ #t. LeakSessionKey( ko ) @ #t)) ∨
      (∃ #t. LeakShare( y ) @ #t)) ∨
     (∃ #t. LeakShare( gx ) @ #t))"
/*
guarded formula characterizing all counter-examples:
"∃ cid psk_id id_cred_psk prk2e prk3e2m prk4e3m ko ks2 k3 iv3 y gx #i #j
   #k.
  (SecretsR_PSK( cid, psk_id, id_cred_psk, prk2e, prk3e2m, prk4e3m, ko,
                 ks2, k3, iv3, y, gx
   ) @ #i) ∧
  (!KU( k3 ) @ #j) ∧
  (HonestPSK( psk_id ) @ #k)
 ∧
  (∀ #t. (CompromisePSK( psk_id ) @ #t) ⇒ ¬(#t < #i)) ∧
  (∀ #t. (LeakSessionKey( ko ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( y ) @ #t) ⇒ ⊥) ∧
  (∀ #t. (LeakShare( gx ) @ #t) ⇒ ⊥)"
*/
by sorry















































rule (modulo E) newpsk_0_1111[color=#40804e, process="new ~psk.1;"]:
   [ State_1111( ), Fr( ~psk.1 ), Fr( ~id_i.1 ), Fr( ~id_r.1 ) ]
  --[ PSKEstablished( ~psk.1, ~id_i.1, ~id_r.1 ) ]->
   [ State_11111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]

  /*
  rule (modulo AC) newpsk_0_1111[color=#40804e, process="new ~psk.1;"]:
     [ State_1111( ), Fr( ~psk ), Fr( ~id_i ), Fr( ~id_r ) ]
    --[ PSKEstablished( ~psk, ~id_i, ~id_r ) ]->
     [ State_11111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididi_0_11111111[color=#638040,
                                                  process="event HonestPSK( psk_id(~id_i.1) );"]:
   [ State_11111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ HonestPSK( psk_id(~id_i.1) ) ]->
   [ State_111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididi_0_11111111[color=#638040,
                                                     process="event HonestPSK( psk_id(~id_i.1) );"]:
     [ State_11111111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_i) ) ]->
     [ State_111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididr_0_111111111[color=#638040,
                                                   process="event HonestPSK( psk_id(~id_r.1) );"]:
   [ State_111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ HonestPSK( psk_id(~id_r.1) ) ]->
   [ State_1111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididr_0_111111111[color=#638040,
                                                      process="event HonestPSK( psk_id(~id_r.1) );"]:
     [ State_111111111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_r) ) ]->
     [ State_1111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididi_0_1111111111[color=#638040,
                                                 process="event Honest( psk_id(~id_i.1) );"]:
   [ State_1111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ Honest( psk_id(~id_i.1) ) ]->
   [ State_11111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]

  /*
  rule (modulo AC) eventHonestpskididi_0_1111111111[color=#638040,
                                                    process="event Honest( psk_id(~id_i.1) );"]:
     [ State_1111111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_i) ) ]->
     [ State_11111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididr_0_11111111111[color=#638040,
                                                  process="event Honest( psk_id(~id_r.1) );"]:
   [ State_11111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ Honest( psk_id(~id_r.1) ) ]->
   [ State_111111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]

  /*
  rule (modulo AC) eventHonestpskididr_0_11111111111[color=#638040,
                                                     process="event Honest( psk_id(~id_r.1) );"]:
     [ State_11111111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_r) ) ]->
     [ State_111111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) inmethodsuitesICIEAD_0_1111111111111111[color=#40805e,
                                                        process="in(<method.1, suitesI.1, C_I.1, EAD_1.1>);"]:
   [
   State_1111111111111111( ~id_i.1, ~id_r.1, ~psk.1 ),
   In( <method.1, suitesI.1, C_I.1, EAD_1.1> )
   ]
  --[ MethodOk( method.1 ) ]->
   [
   State_111111111111111111( ~id_i.1, ~id_r.1, ~psk.1, C_I.1, EAD_1.1,
                             method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) inmethodsuitesICIEAD_0_1111111111111111[color=#40805e,
                                                           process="in(<method.1, suitesI.1, C_I.1, EAD_1.1>);"]:
     [
     State_1111111111111111( ~id_i, ~id_r, ~psk ),
     In( <method, suitesI, C_I, EAD_1> )
     ]
    --[ MethodOk( method ) ]->
     [
     State_111111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_111111111111111111[color=#408056,
                                                                   process="event Eq( method.1, method_psk_variant1 );"]:
   [
   State_111111111111111111( ~id_i.1, ~id_r.1, ~psk.1, C_I.1, EAD_1.1,
                             method.1, suitesI.1
   )
   ]
  --[ Eq( method.1, method_psk_variant1 ) ]->
   [
   State_1111111111111111111( ~id_i.1, ~id_r.1, ~psk.1, C_I.1, EAD_1.1,
                              method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_111111111111111111[color=#408056,
                                                                      process="event Eq( method.1, method_psk_variant1 );"]:
     [
     State_111111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_1111111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method,
                                suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_1111111111111111111111111[color=#408056,
                                                               process="event LeakShare( 'null' );"]:
   [
   State_1111111111111111111111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                    ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_1111111111111111111111111[color=#408056,
                                                                  process="event LeakShare( 'null' );"]:
     [
     State_1111111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifmethodmethodpskvariant_0_1111111111111111111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_1111111111111111111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_1111111111111111111[color=#408056,
                                                               process="if method.1 = method_psk_variant1"]:
   [
   State_1111111111111111111( ~id_i.1, ~id_r.1, ~psk.1, C_I.1, EAD_1.1,
                              method.1, suitesI.1
   ),
   Fr( ~X.1 ), Fr( ~EAD_3.1 )
   ]
  --[
  Share( ~X.1 ),
  Restr_ifmethodmethodpskvariant_0_1111111111111111111_1( method.1 )
  ]->
   [
   State_1111111111111111111111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                    ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   ),
   State_111111111111111111111112( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1, ~psk.1,
                                   C_I.1, EAD_1.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_1111111111111111111[color=#408056,
                                                                  process="if method.1 = method_psk_variant1"]:
     [
     State_1111111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method,
                                suitesI
     ),
     Fr( ~X ), Fr( ~EAD_3 )
     ]
    --[
    Share( ~X ),
    Restr_ifmethodmethodpskvariant_0_1111111111111111111_1( method )
    ]->
     [
     State_1111111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     ),
     State_111111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventInitiatorStartPSKidipskpskididi_0_111111111111111111111112[color=#408056,
                                                                                process="event InitiatorStart_PSK( ~id_i.1, ~psk.1, psk_id(~id_i.1) );"]:
   [
   State_111111111111111111111112( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1, ~psk.1,
                                   C_I.1, EAD_1.1, method.1, suitesI.1
   )
   ]
  --[ InitiatorStart_PSK( ~id_i.1, ~psk.1, psk_id(~id_i.1) ) ]->
   [
   State_1111111111111111111111121( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                    ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventInitiatorStartPSKidipskpskididi_0_111111111111111111111112[color=#408056,
                                                                                   process="event InitiatorStart_PSK( ~id_i.1, ~psk.1, psk_id(~id_i.1) );"]:
     [
     State_111111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
    --[ InitiatorStart_PSK( ~id_i, ~psk, psk_id(~id_i) ) ]->
     [
     State_1111111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididigrpid_0_1111111111111111111111121[color=#408056,
                                                                  process="event Neq( psk_id(~id_i.1), grpid );"]:
   [
   State_1111111111111111111111121( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                    ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   )
   ]
  --[ Neq( psk_id(~id_i.1), grpid ) ]->
   [
   State_111111111111111111111112111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                      ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   ),
   Out( <method.1, suitesI.1, 'g'^~X.1, C_I.1, psk_id(~id_i.1), EAD_1.1> )
   ]

  /*
  rule (modulo AC) eventNeqpskididigrpid_0_1111111111111111111111121[color=#408056,
                                                                     process="event Neq( psk_id(~id_i.1), grpid );"]:
     [
     State_1111111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_i), grpid ) ]->
     [
     State_111111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                        EAD_1, method, suitesI
     ),
     Out( <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1> )
     ]
  */

rule (modulo E) inm_0_111111111111111111111112111[color=#408056,
                                                  process="in(m2.1);"]:
   [
   State_111111111111111111111112111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                      ~psk.1, C_I.1, EAD_1.1, method.1, suitesI.1
   ),
   In( m2.1 )
   ]
  -->
   [
   Let_11111111111111111111111211111( m2.1, ~EAD_3.1, ~X.1, ~id_i.1,
                                      ~id_r.1, ~psk.1, C_I.1, EAD_1.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) inm_0_111111111111111111111112111[color=#408056,
                                                     process="in(m2.1);"]:
     [
     State_111111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                        EAD_1, method, suitesI
     ),
     In( m2 )
     ]
    -->
     [
     Let_11111111111111111111111211111( m2, ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                        C_I, EAD_1, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letGYCIPHERTEXTCRm_1_1111111111111111111111121111[color=#ffffff,
                                                                  process="let <G_Y.1, CIPHERTEXT_2.1, C_R.1>=m2.1"]:
   [
   Let_11111111111111111111111211111( <G_Y.1, CIPHERTEXT_2.1, C_R.1>,
                                      ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1, ~psk.1, C_I.1, EAD_1.1, m2.1,
                                      method.1, suitesI.1
   )
   ]
  -->
   [
   State_11111111111111111111111211111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, G_Y.1, m2.1, method.1,
                                        suitesI.1
   )
   ]

  /*
  rule (modulo AC) letGYCIPHERTEXTCRm_1_1111111111111111111111121111[color=#ffffff,
                                                                     process="let <G_Y.1, CIPHERTEXT_2.1, C_R.1>=m2.1"]:
     [
     Let_11111111111111111111111211111( <G_Y, CIPHERTEXT_2, C_R>, ~EAD_3, ~X,
                                        ~id_i, ~id_r, ~psk, C_I, EAD_1, m2, method, suitesI
     )
     ]
    -->
     [
     State_11111111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_11111111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                          process="let <ID_CRED_PSK_R.1, MAC_2.1, EAD_2.1>=decxor(CIPHERTEXT_2.1,
       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                 hash(<wrap(G_Y.1), C_R.1, 
                       wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                  wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                      >),
                 plaintext_length))"]:
   [
   State_11111111111111111111111211111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, G_Y.1, m2.1, method.1,
                                        suitesI.1
   )
   ]
  -->
   [
   Let_111111111111111111111112111111( decxor(CIPHERTEXT_2.1,
                                              edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                        hash(<wrap(G_Y.1), C_R.1, 
                                                              wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                         wrap('g'^~X.1), wrap(C_I.1), 
                                                                         wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                             >),
                                                        plaintext_length)),
                                       ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1,
                                       EAD_1.1, G_Y.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_11111111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                             process="let <ID_CRED_PSK_R.1, MAC_2.1, EAD_2.1>=decxor(CIPHERTEXT_2.1,
       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                 hash(<wrap(G_Y.1), C_R.1, 
                       wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                  wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                      >),
                 plaintext_length))"]:
     [
     State_11111111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
    -->
     [
     Let_111111111111111111111112111111( decxor(CIPHERTEXT_2,
                                                edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                          hash(<wrap(G_Y), C_R, 
                                                                wrap(hash(<wrap(method), wrap(suitesI), 
                                                                           wrap('g'^~X), wrap(C_I), 
                                                                           wrap(psk_id(~id_i)), EAD_1>))
                                                               >),
                                                          plaintext_length)),
                                         ~EAD_3, ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y,
                                         m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.26
       G_Y   = G_Y.34
       z     = G_Y.34^~X.26
    
    2. ~X    = ~X.31
       G_Y   = z.44^inv(~X.31)
       z     = z.44
    
    3. ~X    = ~X.110
       G_Y   = x.215^x.216
       z     = x.215^(~X.110*x.216)
    
    4. ~X    = ~X.118
       G_Y   = x.231^inv((~X.118*x.232))
       z     = x.231^inv(x.232)
    
    5. ~X    = ~X.118
       G_Y   = x.231^(x.232*inv(~X.118))
       z     = x.231^x.232
    
    6. ~X    = ~X.119
       G_Y   = x.232^(x.233*inv((~X.119*x.234)))
       z     = x.232^(x.233*inv(x.234))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_11111111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                          process="let <ID_CRED_PSK_R.1, MAC_2.1, EAD_2.1>=decxor(CIPHERTEXT_2.1,
       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                 hash(<wrap(G_Y.1), C_R.1, 
                       wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                  wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                      >),
                 plaintext_length))"]:
   [
   Let_111111111111111111111112111111( <ID_CRED_PSK_R.1, MAC_2.1, EAD_2.1>,
                                       ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1,
                                       EAD_1.1, G_Y.1, m2.1, method.1, suitesI.1
   )
   ]
  -->
   [
   State_111111111111111111111112111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                         ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1, G_Y.1,
                                         ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_11111111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                             process="let <ID_CRED_PSK_R.1, MAC_2.1, EAD_2.1>=decxor(CIPHERTEXT_2.1,
       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                 hash(<wrap(G_Y.1), C_R.1, 
                       wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                  wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                      >),
                 plaintext_length))"]:
     [
     Let_111111111111111111111112111111( <ID_CRED_PSK_R, MAC_2, EAD_2>,
                                         ~EAD_3, ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y,
                                         m2, method, suitesI
     )
     ]
    -->
     [
     State_111111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                           m2, method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGY_0_111111111111111111111112111111[color=#408056,
                                                                   process="event GroupCheck( G_Y.1 );"]:
   [
   State_111111111111111111111112111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                         ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1, G_Y.1,
                                         ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]
  --[ GroupCheck( G_Y.1 ) ]->
   [
   State_1111111111111111111111121111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                          ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1, G_Y.1,
                                          ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGY_0_111111111111111111111112111111[color=#408056,
                                                                      process="event GroupCheck( G_Y.1 );"]:
     [
     State_111111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                           m2, method, suitesI
     )
     ]
    --[ GroupCheck( G_Y ) ]->
     [
     State_1111111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                            CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                            m2, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGYgrpid_1_1111111111111111111111121111111_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGYgrpid_1_1111111111111111111111121111111_1( x
     ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGYgrpid_1_1111111111111111111111121111111[color=#408056,
                                                                    process="if check_grp(G_Y.1) = grpid"]:
   [
   State_1111111111111111111111121111111( ~EAD_3.1, ~X.1, ~id_i.1, ~id_r.1,
                                          ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1, G_Y.1,
                                          ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]
  --[
  Eq( ID_CRED_PSK_R.1, ~id_r.1 ),
  Restr_ifcheckgrpGYgrpid_1_1111111111111111111111121111111_1( check_grp(G_Y.1)
  )
  ]->
   [
   State_111111111111111111111112111111121( ~EAD_3.1, ~X.1, ~id_i.1,
                                            ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1,
                                            G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGYgrpid_1_1111111111111111111111121111111[color=#408056,
                                                                       process="if check_grp(G_Y.1) = grpid"]:
     [
     State_1111111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                            CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                            m2, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_R, ~id_r ),
    Restr_ifcheckgrpGYgrpid_1_1111111111111111111111121111111_1( check_grp(G_Y)
    )
    ]->
     [
     State_111111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                              CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                              m2, method, suitesI
     )
     ]
  */

restriction Restr_ifIDCREDPSKRidr_0_111111111111111111111112111111121_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKRidr_0_111111111111111111111112111111121_1( x, x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKRidr_0_111111111111111111111112111111121[color=#408056,
                                                                    process="if ID_CRED_PSK_R.1 = ~id_r.1"]:
   [
   State_111111111111111111111112111111121( ~EAD_3.1, ~X.1, ~id_i.1,
                                            ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1,
                                            G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]
  --[
  DerivedIShared_PSK( ~id_i.1, psk_id(~id_i.1), ID_CRED_PSK_R.1,
                      hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                            hash(<wrap(G_Y.1), C_R.1, 
                                                  wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                             wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                 >),
                                            hash_length),
                                  psk_cred(~psk.1)),
                      ~X.1, G_Y.1
  ),
  Restr_ifIDCREDPSKRidr_0_111111111111111111111112111111121_1( ID_CRED_PSK_R.1,
                                                               ~id_r.1
  )
  ]->
   [
   State_11111111111111111111111211111112111( ~EAD_3.1, ~X.1, ~id_i.1,
                                              ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1,
                                              G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKRidr_0_111111111111111111111112111111121[color=#408056,
                                                                       process="if ID_CRED_PSK_R.1 = ~id_r.1"]:
     [
     State_111111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                              CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, ID_CRED_PSK_R, MAC_2,
                                              m2, method, suitesI
     )
     ]
    --[
    DerivedIShared_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                        hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                              hash(<wrap(G_Y), C_R, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                               wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk)),
                        ~X, G_Y
    ),
    Restr_ifIDCREDPSKRidr_0_111111111111111111111112111111121_1( ID_CRED_PSK_R,
                                                                 ~id_r
    )
    ]->
     [
     State_11111111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.39
       z     = G_Y.39^~X.30
    
    2. ~X    = ~X.37
       G_Y   = z.53^inv(~X.37)
       z     = z.53
    
    3. ~X    = ~X.128
       G_Y   = x.251^x.252
       z     = x.251^(~X.128*x.252)
    
    4. ~X    = ~X.137
       G_Y   = x.269^inv((~X.137*x.270))
       z     = x.269^inv(x.270)
    
    5. ~X    = ~X.137
       G_Y   = x.269^(x.270*inv(~X.137))
       z     = x.269^x.270
    
    6. ~X    = ~X.138
       G_Y   = x.270^(x.271*inv((~X.138*x.272)))
       z     = x.270^(x.271*inv(x.272))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_11111111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                        process="event Eq( MAC_2.1,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              'mac_2',
              <C_R.1, psk_id(~id_i.1), 
               hash(<wrap(G_Y.1), C_R.1, 
                     wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                    >), 
               psk_cred(~psk.1), EAD_2.1>,
              edhoc_mac_length)
);"]:
   [
   State_11111111111111111111111211111112111( ~EAD_3.1, ~X.1, ~id_i.1,
                                              ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1, EAD_2.1,
                                              G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1, suitesI.1
   )
   ]
  --[
  Eq( MAC_2.1,
      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                      'salt_3e2m',
                                      hash(<wrap(G_Y.1), C_R.1, 
                                            wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                       wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                'mac_2',
                <C_R.1, psk_id(~id_i.1), 
                 hash(<wrap(G_Y.1), C_R.1, 
                       wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), wrap(C_I.1), 
                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                      >), 
                 psk_cred(~psk.1), EAD_2.1>,
                edhoc_mac_length)
  )
  ]->
   [
   State_111111111111111111111112111111121111( ~EAD_3.1, ~X.1, ~id_i.1,
                                               ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                               EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                               suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_11111111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                           process="event Eq( MAC_2.1,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              'mac_2',
              <C_R.1, psk_id(~id_i.1), 
               hash(<wrap(G_Y.1), C_R.1, 
                     wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                    >), 
               psk_cred(~psk.1), EAD_2.1>,
              edhoc_mac_length)
);"]:
     [
     State_11111111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    Eq( MAC_2,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  'mac_2',
                  <C_R, psk_id(~id_i), 
                   hash(<wrap(G_Y), C_R, 
                         wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                    wrap(psk_id(~id_i)), EAD_1>))
                        >), 
                   psk_cred(~psk), EAD_2>,
                  edhoc_mac_length)
    )
    ]->
     [
     State_111111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                 ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                 ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.39
       z     = G_Y.39^~X.30
    
    2. ~X    = ~X.37
       G_Y   = z.53^inv(~X.37)
       z     = z.53
    
    3. ~X    = ~X.154
       G_Y   = x.303^x.304
       z     = x.303^(~X.154*x.304)
    
    4. ~X    = ~X.163
       G_Y   = x.321^inv((~X.163*x.322))
       z     = x.321^inv(x.322)
    
    5. ~X    = ~X.163
       G_Y   = x.321^(x.322*inv(~X.163))
       z     = x.321^x.322
    
    6. ~X    = ~X.164
       G_Y   = x.322^(x.323*inv((~X.164*x.324)))
       z     = x.322^(x.323*inv(x.324))
    
    7. G_Y   = grpid
       z     = grpid
  */

restriction Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111_1:
  "∀ x #NOW x.1.
    (Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111_1( x,
                                                                                                                                                                                                                                                                                                                  x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                    process="if MAC_2.1 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                'salt_3e2m',
                                hash(<wrap(G_Y.1), C_R.1, 
                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                 wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                     >),
                                hash_length),
                      psk_cred(~psk.1)),
          'mac_2',
          <C_R.1, psk_id(~id_i.1), 
           hash(<wrap(G_Y.1), C_R.1, 
                 wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                            wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                >), 
           psk_cred(~psk.1), EAD_2.1>,
          edhoc_mac_length)"]:
   [
   State_111111111111111111111112111111121111( ~EAD_3.1, ~X.1, ~id_i.1,
                                               ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                               EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                               suitesI.1
   )
   ]
  --[
  THIShared_PSK( psk_id(~id_i.1),
                 hash(<
                       wrap(hash(<wrap(G_Y.1), C_R.1, 
                                  wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), wrap(C_I.1), 
                                             wrap(psk_id(~id_i.1)), EAD_1.1>))
                                 >)), 
                       decxor(CIPHERTEXT_2.1,
                              edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                        hash(<wrap(G_Y.1), C_R.1, 
                                              wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                         wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                             >),
                                        plaintext_length)), 
                       psk_cred(~psk.1)>)
  ),
  Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111_1( MAC_2.1,
                                                                                                                                                                                                                                                                                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                           G_Y.1^~X.1),
                                                                                                                                                                                                                                                                                                                                               'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                               hash(<
                                                                                                                                                                                                                                                                                                                                                     wrap(G_Y.1), 
                                                                                                                                                                                                                                                                                                                                                     C_R.1, 
                                                                                                                                                                                                                                                                                                                                                     wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                                wrap(method.1), 
                                                                                                                                                                                                                                                                                                                                                                wrap(suitesI.1), 
                                                                                                                                                                                                                                                                                                                                                                wrap('g'^~X.1), 
                                                                                                                                                                                                                                                                                                                                                                wrap(C_I.1), 
                                                                                                                                                                                                                                                                                                                                                                wrap(psk_id(~id_i.1)), 
                                                                                                                                                                                                                                                                                                                                                                EAD_1.1
                                                                                                                                                                                                                                                                                                                                                               >))
                                                                                                                                                                                                                                                                                                                                                    >),
                                                                                                                                                                                                                                                                                                                                               hash_length),
                                                                                                                                                                                                                                                                                                                                     psk_cred(~psk.1)),
                                                                                                                                                                                                                                                                                                                         'mac_2',
                                                                                                                                                                                                                                                                                                                         <
                                                                                                                                                                                                                                                                                                                          C_R.1, 
                                                                                                                                                                                                                                                                                                                          psk_id(~id_i.1), 
                                                                                                                                                                                                                                                                                                                          hash(<
                                                                                                                                                                                                                                                                                                                                wrap(G_Y.1), 
                                                                                                                                                                                                                                                                                                                                C_R.1, 
                                                                                                                                                                                                                                                                                                                                wrap(hash(<
                                                                                                                                                                                                                                                                                                                                           wrap(method.1), 
                                                                                                                                                                                                                                                                                                                                           wrap(suitesI.1), 
                                                                                                                                                                                                                                                                                                                                           wrap('g'^~X.1), 
                                                                                                                                                                                                                                                                                                                                           wrap(C_I.1), 
                                                                                                                                                                                                                                                                                                                                           wrap(psk_id(~id_i.1)), 
                                                                                                                                                                                                                                                                                                                                           EAD_1.1
                                                                                                                                                                                                                                                                                                                                          >))
                                                                                                                                                                                                                                                                                                                               >), 
                                                                                                                                                                                                                                                                                                                          psk_cred(~psk.1), 
                                                                                                                                                                                                                                                                                                                          EAD_2.1
                                                                                                                                                                                                                                                                                                                         >,
                                                                                                                                                                                                                                                                                                                         edhoc_mac_length)
  )
  ]->
   [
   State_11111111111111111111111211111112111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                 ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                 EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                 suitesI.1
   )
   ]

  /*
  rule (modulo AC) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                       process="if MAC_2.1 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                'salt_3e2m',
                                hash(<wrap(G_Y.1), C_R.1, 
                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                 wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                     >),
                                hash_length),
                      psk_cred(~psk.1)),
          'mac_2',
          <C_R.1, psk_id(~id_i.1), 
           hash(<wrap(G_Y.1), C_R.1, 
                 wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                            wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                >), 
           psk_cred(~psk.1), EAD_2.1>,
          edhoc_mac_length)"]:
     [
     State_111111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                 ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                 ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    THIShared_PSK( psk_id(~id_i),
                   hash(<
                         wrap(hash(<wrap(G_Y), C_R, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                               wrap(psk_id(~id_i)), EAD_1>))
                                   >)), 
                         decxor(CIPHERTEXT_2,
                                edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                          hash(<wrap(G_Y), C_R, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                           wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                               >),
                                          plaintext_length)), 
                         psk_cred(~psk)>)
    ),
    Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_111111111111111111111112111111121111_1( MAC_2,
                                                                                                                                                                                                                                                                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                             z),
                                                                                                                                                                                                                                                                                                                                                 'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                                 hash(<
                                                                                                                                                                                                                                                                                                                                                       wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                                       C_R, 
                                                                                                                                                                                                                                                                                                                                                       wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                                  wrap(method), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                                                  wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                                                  EAD_1
                                                                                                                                                                                                                                                                                                                                                                 >))
                                                                                                                                                                                                                                                                                                                                                      >),
                                                                                                                                                                                                                                                                                                                                                 hash_length),
                                                                                                                                                                                                                                                                                                                                       psk_cred(~psk)),
                                                                                                                                                                                                                                                                                                                           'mac_2',
                                                                                                                                                                                                                                                                                                                           <
                                                                                                                                                                                                                                                                                                                            C_R, 
                                                                                                                                                                                                                                                                                                                            psk_id(~id_i), 
                                                                                                                                                                                                                                                                                                                            hash(<
                                                                                                                                                                                                                                                                                                                                  wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                  C_R, 
                                                                                                                                                                                                                                                                                                                                  wrap(hash(<
                                                                                                                                                                                                                                                                                                                                             wrap(method), 
                                                                                                                                                                                                                                                                                                                                             wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                             wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                             wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                             wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                             EAD_1
                                                                                                                                                                                                                                                                                                                                            >))
                                                                                                                                                                                                                                                                                                                                 >), 
                                                                                                                                                                                                                                                                                                                            psk_cred(~psk), 
                                                                                                                                                                                                                                                                                                                            EAD_2
                                                                                                                                                                                                                                                                                                                           >,
                                                                                                                                                                                                                                                                                                                           edhoc_mac_length)
    )
    ]->
     [
     State_11111111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                   ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.31
       G_Y   = G_Y.40
       z     = G_Y.40^~X.31
    
    2. ~X    = ~X.39
       G_Y   = z.56^inv(~X.39)
       z     = z.56
    
    3. ~X    = ~X.183
       G_Y   = x.361^x.362
       z     = x.361^(~X.183*x.362)
    
    4. ~X    = ~X.192
       G_Y   = x.379^inv((~X.192*x.380))
       z     = x.379^inv(x.380)
    
    5. ~X    = ~X.192
       G_Y   = x.379^(x.380*inv(~X.192))
       z     = x.379^x.380
    
    6. ~X    = ~X.193
       G_Y   = x.380^(x.381*inv((~X.193*x.382)))
       z     = x.380^(x.381*inv(x.382))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_11111111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event AcceptI_PSK( ~id_i.1, method_psk_variant1, psk_id(~id_i.1),
             ID_CRED_PSK_R.1,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                   hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                   hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.1), C_R.1, 
                                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                              wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.1)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                              wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.1,
                                               edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.1), C_R.1, 
                                                               wrap(hash(<wrap(method.1), 
                                                                          wrap(suitesI.1), 
                                                                          wrap('g'^~X.1), 
                                                                          wrap(C_I.1), 
                                                                          wrap(psk_id(~id_i.1)), 
                                                                          EAD_1.1>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.1)>)), 
                             ~EAD_3.1, psk_cred(~psk.1)>),
                       hash_length)
);"]:
   [
   State_11111111111111111111111211111112111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                 ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                 EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                 suitesI.1
   )
   ]
  --[
  AcceptI_PSK( ~id_i.1, method_psk_variant1, psk_id(~id_i.1),
               ID_CRED_PSK_R.1,
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                     hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.1)),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                     hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.1)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                               'salt_3e2m',
                                               hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.1)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.1,
                                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                           hash(<wrap(G_Y.1), C_R.1, 
                                                                 wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                            wrap('g'^~X.1), wrap(C_I.1), 
                                                                            wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.1)>)), 
                               ~EAD_3.1, psk_cred(~psk.1)>),
                         hash_length)
  )
  ]->
   [
   State_111111111111111111111112111111121111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                  ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                  EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                  suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_11111111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event AcceptI_PSK( ~id_i.1, method_psk_variant1, psk_id(~id_i.1),
             ID_CRED_PSK_R.1,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                   hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                   hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.1), C_R.1, 
                                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                              wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.1)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                              wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.1,
                                               edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.1), C_R.1, 
                                                               wrap(hash(<wrap(method.1), 
                                                                          wrap(suitesI.1), 
                                                                          wrap('g'^~X.1), 
                                                                          wrap(C_I.1), 
                                                                          wrap(psk_id(~id_i.1)), 
                                                                          EAD_1.1>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.1)>)), 
                             ~EAD_3.1, psk_cred(~psk.1)>),
                       hash_length)
);"]:
     [
     State_11111111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                   ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptI_PSK( ~id_i, method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R,
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2,
                                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                             hash(<wrap(G_Y), C_R, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap('g'^~X), wrap(C_I), 
                                                                              wrap(psk_id(~id_i)), EAD_1>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk)>)), 
                                 ~EAD_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_111111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                    ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.39
       z     = G_Y.39^~X.30
    
    2. ~X    = ~X.37
       G_Y   = z.53^inv(~X.37)
       z     = z.53
    
    3. ~X    = ~X.182
       G_Y   = x.359^x.360
       z     = x.359^(~X.182*x.360)
    
    4. ~X    = ~X.191
       G_Y   = x.377^inv((~X.191*x.378))
       z     = x.377^inv(x.378)
    
    5. ~X    = ~X.191
       G_Y   = x.377^(x.378*inv(~X.191))
       z     = x.377^x.378
    
    6. ~X    = ~X.192
       G_Y   = x.378^(x.379*inv((~X.192*x.380)))
       z     = x.378^(x.379*inv(x.380))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_111111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event SessionSecrets_I( ~id_i.1, ~X.1, G_Y.1,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.1), C_R.1, 
                                                        wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                   wrap('g'^~X.1), wrap(C_I.1), 
                                                                   wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.1)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                        wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                   wrap('g'^~X.1), wrap(C_I.1), 
                                                                   wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.1,
                                                    edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.1), C_R.1, 
                                                                    wrap(hash(<wrap(method.1), 
                                                                               wrap(suitesI.1), 
                                                                               wrap('g'^~X.1), 
                                                                               wrap(C_I.1), 
                                                                               wrap(psk_id(~id_i.1)), 
                                                                               EAD_1.1>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.1)>)), 
                                  ~EAD_3.1, psk_cred(~psk.1)>),
                            hash_length)
);"]:
   [
   State_111111111111111111111112111111121111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                  ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                  EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                  suitesI.1
   )
   ]
  --[
  SessionSecrets_I( ~id_i.1, ~X.1, G_Y.1,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                    'salt_3e2m',
                                                    hash(<wrap(G_Y.1), C_R.1, 
                                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.1)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                         >)), 
                                               decxor(CIPHERTEXT_2.1,
                                                      edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                                'keystream_2',
                                                                hash(<wrap(G_Y.1), C_R.1, 
                                                                      wrap(hash(<wrap(method.1), 
                                                                                 wrap(suitesI.1), 
                                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                                 wrap(psk_id(~id_i.1)), 
                                                                                 EAD_1.1>))
                                                                     >),
                                                                plaintext_length)), 
                                               psk_cred(~psk.1)>)), 
                                    ~EAD_3.1, psk_cred(~psk.1)>),
                              hash_length)
  )
  ]->
   [
   State_1111111111111111111111121111111211111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                   ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                   EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                   suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_111111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event SessionSecrets_I( ~id_i.1, ~X.1, G_Y.1,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.1), C_R.1, 
                                                        wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                   wrap('g'^~X.1), wrap(C_I.1), 
                                                                   wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.1)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                        wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                   wrap('g'^~X.1), wrap(C_I.1), 
                                                                   wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.1,
                                                    edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.1), C_R.1, 
                                                                    wrap(hash(<wrap(method.1), 
                                                                               wrap(suitesI.1), 
                                                                               wrap('g'^~X.1), 
                                                                               wrap(C_I.1), 
                                                                               wrap(psk_id(~id_i.1)), 
                                                                               EAD_1.1>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.1)>)), 
                                  ~EAD_3.1, psk_cred(~psk.1)>),
                            hash_length)
);"]:
     [
     State_111111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                    ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SessionSecrets_I( ~id_i, ~X, G_Y,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >)), 
                                                 decxor(CIPHERTEXT_2,
                                                        edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                  hash(<wrap(G_Y), C_R, 
                                                                        wrap(hash(<wrap(method), 
                                                                                   wrap(suitesI), 
                                                                                   wrap('g'^~X), wrap(C_I), 
                                                                                   wrap(psk_id(~id_i)), EAD_1
                                                                                  >))
                                                                       >),
                                                                  plaintext_length)), 
                                                 psk_cred(~psk)>)), 
                                      ~EAD_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_1111111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                     ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.39
       z     = G_Y.39^~X.30
    
    2. ~X    = ~X.37
       G_Y   = z.53^inv(~X.37)
       z     = z.53
    
    3. ~X    = ~X.182
       G_Y   = x.359^x.360
       z     = x.359^(~X.182*x.360)
    
    4. ~X    = ~X.191
       G_Y   = x.377^inv((~X.191*x.378))
       z     = x.377^inv(x.378)
    
    5. ~X    = ~X.191
       G_Y   = x.377^(x.378*inv(~X.191))
       z     = x.377^x.378
    
    6. ~X    = ~X.192
       G_Y   = x.378^(x.379*inv((~X.192*x.380)))
       z     = x.378^(x.379*inv(x.380))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_1111111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event SecretsI_PSK( ~id_i.1, psk_id(~id_i.1), ID_CRED_PSK_R.1,
              hkdfextract('null', G_Y.1^~X.1),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.1,
                                                edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.1)>)), 
                              ~EAD_3.1, psk_cred(~psk.1)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                        hash(<wrap(G_Y.1), C_R.1, 
                              wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                         wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >)), 
                              decxor(CIPHERTEXT_2.1,
                                     edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                               hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.1)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >)), 
                              decxor(CIPHERTEXT_2.1,
                                     edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                               hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.1)>),
                        iv_length),
              ~X.1, G_Y.1
);"]:
   [
   State_1111111111111111111111121111111211111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                   ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                   EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                   suitesI.1
   )
   ]
  --[
  SecretsI_PSK( ~id_i.1, psk_id(~id_i.1), ID_CRED_PSK_R.1,
                hkdfextract('null', G_Y.1^~X.1),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                      hash(<wrap(G_Y.1), C_R.1, 
                                            wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                       wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                      hash(<wrap(G_Y.1), C_R.1, 
                                            wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                       wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >)), 
                                           decxor(CIPHERTEXT_2.1,
                                                  edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                            hash(<wrap(G_Y.1), C_R.1, 
                                                                  wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                             wrap('g'^~X.1), wrap(C_I.1), 
                                                                             wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                                 >),
                                                            plaintext_length)), 
                                           psk_cred(~psk.1)>)), 
                                ~EAD_3.1, psk_cred(~psk.1)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                          hash(<wrap(G_Y.1), C_R.1, 
                                wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), wrap(C_I.1), 
                                           wrap(psk_id(~id_i.1)), EAD_1.1>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >)), 
                                decxor(CIPHERTEXT_2.1,
                                       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.1)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >)), 
                                decxor(CIPHERTEXT_2.1,
                                       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.1)>),
                          iv_length),
                ~X.1, G_Y.1
  )
  ]->
   [
   State_11111111111111111111111211111112111111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                    ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                    EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                    suitesI.1
   )
   ]

  /*
  rule (modulo AC) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_1111111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SecretsI_PSK( ~id_i.1, psk_id(~id_i.1), ID_CRED_PSK_R.1,
              hkdfextract('null', G_Y.1^~X.1),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'salt_3e2m',
                                    hash(<wrap(G_Y.1), C_R.1, 
                                          wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.1,
                                                edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.1)>)), 
                              ~EAD_3.1, psk_cred(~psk.1)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                        hash(<wrap(G_Y.1), C_R.1, 
                              wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                         wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >)), 
                              decxor(CIPHERTEXT_2.1,
                                     edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                               hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.1)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.1), C_R.1, 
                                                    wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                               wrap('g'^~X.1), wrap(C_I.1), 
                                                               wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.1), C_R.1, 
                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                        >)), 
                              decxor(CIPHERTEXT_2.1,
                                     edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                               hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.1)>),
                        iv_length),
              ~X.1, G_Y.1
);"]:
     [
     State_1111111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                     ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SecretsI_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2,
                                                    edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk)>)), 
                                  ~EAD_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap(G_Y), C_R, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                             wrap(psk_id(~id_i)), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~X, G_Y
    )
    ]->
     [
     State_11111111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i,
                                                      ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                      ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.39
       z     = G_Y.39^~X.30
    
    2. ~X    = ~X.37
       G_Y   = z.53^inv(~X.37)
       z     = z.53
    
    3. ~X    = ~X.244
       G_Y   = x.483^x.484
       z     = x.483^(~X.244*x.484)
    
    4. ~X    = ~X.253
       G_Y   = x.501^inv((~X.253*x.502))
       z     = x.501^inv(x.502)
    
    5. ~X    = ~X.253
       G_Y   = x.501^(x.502*inv(~X.253))
       z     = x.501^x.502
    
    6. ~X    = ~X.254
       G_Y   = x.502^(x.503*inv((~X.254*x.504)))
       z     = x.502^(x.503*inv(x.504))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_11111111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.1^~X.1),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.1)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.1,
                                                   edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.1), C_R.1, 
                                                                   wrap(hash(<wrap(method.1), 
                                                                              wrap(suitesI.1), 
                                                                              wrap('g'^~X.1), 
                                                                              wrap(C_I.1), 
                                                                              wrap(psk_id(~id_i.1)), 
                                                                              EAD_1.1>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.1)>)), 
                                 ~EAD_3.1, psk_cred(~psk.1)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.1), ID_CRED_PSK_R.1, ~X.1, G_Y.1,
                 <
                  hash(<wrap(G_Y.1), C_R.1, 
                        wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                   wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.1), C_R.1, 
                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                              wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                  >)), 
                        decxor(CIPHERTEXT_2.1,
                               edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                         hash(<wrap(G_Y.1), C_R.1, 
                                               wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                          wrap('g'^~X.1), wrap(C_I.1), 
                                                          wrap(psk_id(~id_i.1)), EAD_1.1>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.1)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.1), C_R.1, 
                                              wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                         wrap('g'^~X.1), wrap(C_I.1), 
                                                         wrap(psk_id(~id_i.1)), EAD_1.1>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.1,
                                          edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                    hash(<wrap(G_Y.1), C_R.1, 
                                                          wrap(hash(<wrap(method.1), 
                                                                     wrap(suitesI.1), 
                                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                                     wrap(psk_id(~id_i.1)), EAD_1.1
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.1)>)), 
                        ~EAD_3.1, psk_cred(~psk.1)>), 
                  suitesI.1, EAD_1.1, EAD_2.1, ~EAD_3.1, 
                  <method.1, suitesI.1, 'g'^~X.1, C_I.1, psk_id(~id_i.1), EAD_1.1>, 
                  m2.1, 
                  aeadenc(~EAD_3.1, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.1)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.1,
                                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.1), C_R.1, 
                                                                 wrap(hash(<wrap(method.1), 
                                                                            wrap(suitesI.1), 
                                                                            wrap('g'^~X.1), 
                                                                            wrap(C_I.1), 
                                                                            wrap(psk_id(~id_i.1)), 
                                                                            EAD_1.1>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.1)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.1)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.1,
                                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.1), C_R.1, 
                                                                 wrap(hash(<wrap(method.1), 
                                                                            wrap(suitesI.1), 
                                                                            wrap('g'^~X.1), 
                                                                            wrap(C_I.1), 
                                                                            wrap(psk_id(~id_i.1)), 
                                                                            EAD_1.1>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.1)>),
                                    iv_length))
                 >
);"]:
   [
   State_11111111111111111111111211111112111111111( ~EAD_3.1, ~X.1, ~id_i.1,
                                                    ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1, EAD_1.1,
                                                    EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1, m2.1, method.1,
                                                    suitesI.1
   )
   ]
  --[
  AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_Y.1^~X.1),
                                                   'salt_3e2m',
                                                   hash(<wrap(G_Y.1), C_R.1, 
                                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.1)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                         wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                    wrap('g'^~X.1), wrap(C_I.1), 
                                                                    wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2.1,
                                                     edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                               hash(<wrap(G_Y.1), C_R.1, 
                                                                     wrap(hash(<wrap(method.1), 
                                                                                wrap(suitesI.1), 
                                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                                wrap(psk_id(~id_i.1)), EAD_1.1
                                                                               >))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk.1)>)), 
                                   ~EAD_3.1, psk_cred(~psk.1)>),
                             hash_length),
                   method_psk_variant1, psk_id(~id_i.1), ID_CRED_PSK_R.1, ~X.1, G_Y.1,
                   <
                    hash(<wrap(G_Y.1), C_R.1, 
                          wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), wrap(C_I.1), 
                                     wrap(psk_id(~id_i.1)), EAD_1.1>))
                         >), 
                    hash(<
                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), wrap(C_I.1), 
                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                    >)), 
                          decxor(CIPHERTEXT_2.1,
                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                           hash(<wrap(G_Y.1), C_R.1, 
                                                 wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                            wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                >),
                                           plaintext_length)), 
                          psk_cred(~psk.1)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                           wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                               >)), 
                                     decxor(CIPHERTEXT_2.1,
                                            edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                      hash(<wrap(G_Y.1), C_R.1, 
                                                            wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                       wrap('g'^~X.1), wrap(C_I.1), 
                                                                       wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                           >),
                                                      plaintext_length)), 
                                     psk_cred(~psk.1)>)), 
                          ~EAD_3.1, psk_cred(~psk.1)>), 
                    suitesI.1, EAD_1.1, EAD_2.1, ~EAD_3.1, 
                    <method.1, suitesI.1, 'g'^~X.1, C_I.1, psk_id(~id_i.1), EAD_1.1>, m2.1, 
                    aeadenc(~EAD_3.1, 'rep',
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.1), C_R.1, 
                                                                  wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                             wrap('g'^~X.1), wrap(C_I.1), 
                                                                             wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.1)),
                                      'k_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.1,
                                                   edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                             hash(<wrap(G_Y.1), C_R.1, 
                                                                   wrap(hash(<wrap(method.1), 
                                                                              wrap(suitesI.1), 
                                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                                              wrap(psk_id(~id_i.1)), EAD_1.1
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.1)>),
                                      key_length),
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.1), C_R.1, 
                                                                  wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                             wrap('g'^~X.1), wrap(C_I.1), 
                                                                             wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.1)),
                                      'iv_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.1,
                                                   edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                             hash(<wrap(G_Y.1), C_R.1, 
                                                                   wrap(hash(<wrap(method.1), 
                                                                              wrap(suitesI.1), 
                                                                              wrap('g'^~X.1), wrap(C_I.1), 
                                                                              wrap(psk_id(~id_i.1)), EAD_1.1
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.1)>),
                                      iv_length))
                   >
  )
  ]->
   [
   State_11111111111111111111111211111112111111111111( ~EAD_3.1, ~X.1,
                                                       ~id_i.1, ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1,
                                                       EAD_1.1, EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1,
                                                       m2.1, method.1, suitesI.1
   ),
   Out( aeadenc(~EAD_3.1, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >)), 
                                decxor(CIPHERTEXT_2.1,
                                       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.1)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.1), C_R.1, 
                                                      wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                 wrap('g'^~X.1), wrap(C_I.1), 
                                                                 wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.1), C_R.1, 
                                           wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                                      wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                          >)), 
                                decxor(CIPHERTEXT_2.1,
                                       edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.1)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_11111111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.1^~X.1),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.1)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                       wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                  wrap('g'^~X.1), wrap(C_I.1), 
                                                                  wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.1,
                                                   edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.1), C_R.1, 
                                                                   wrap(hash(<wrap(method.1), 
                                                                              wrap(suitesI.1), 
                                                                              wrap('g'^~X.1), 
                                                                              wrap(C_I.1), 
                                                                              wrap(psk_id(~id_i.1)), 
                                                                              EAD_1.1>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.1)>)), 
                                 ~EAD_3.1, psk_cred(~psk.1)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.1), ID_CRED_PSK_R.1, ~X.1, G_Y.1,
                 <
                  hash(<wrap(G_Y.1), C_R.1, 
                        wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                   wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.1), C_R.1, 
                                   wrap(hash(<wrap(method.1), wrap(suitesI.1), wrap('g'^~X.1), 
                                              wrap(C_I.1), wrap(psk_id(~id_i.1)), EAD_1.1>))
                                  >)), 
                        decxor(CIPHERTEXT_2.1,
                               edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                         hash(<wrap(G_Y.1), C_R.1, 
                                               wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                          wrap('g'^~X.1), wrap(C_I.1), 
                                                          wrap(psk_id(~id_i.1)), EAD_1.1>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.1)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.1), C_R.1, 
                                              wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                         wrap('g'^~X.1), wrap(C_I.1), 
                                                         wrap(psk_id(~id_i.1)), EAD_1.1>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.1,
                                          edhoc_kdf(hkdfextract('null', G_Y.1^~X.1), 'keystream_2',
                                                    hash(<wrap(G_Y.1), C_R.1, 
                                                          wrap(hash(<wrap(method.1), 
                                                                     wrap(suitesI.1), 
                                                                     wrap('g'^~X.1), wrap(C_I.1), 
                                                                     wrap(psk_id(~id_i.1)), EAD_1.1
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.1)>)), 
                        ~EAD_3.1, psk_cred(~psk.1)>), 
                  suitesI.1, EAD_1.1, EAD_2.1, ~EAD_3.1, 
                  <method.1, suitesI.1, 'g'^~X.1, C_I.1, psk_id(~id_i.1), EAD_1.1>, 
                  m2.1, 
                  aeadenc(~EAD_3.1, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.1)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.1,
                                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.1), C_R.1, 
                                                                 wrap(hash(<wrap(method.1), 
                                                                            wrap(suitesI.1), 
                                                                            wrap('g'^~X.1), 
                                                                            wrap(C_I.1), 
                                                                            wrap(psk_id(~id_i.1)), 
                                                                            EAD_1.1>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.1)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.1), C_R.1, 
                                                                wrap(hash(<wrap(method.1), 
                                                                           wrap(suitesI.1), 
                                                                           wrap('g'^~X.1), 
                                                                           wrap(C_I.1), 
                                                                           wrap(psk_id(~id_i.1)), 
                                                                           EAD_1.1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.1)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.1), C_R.1, 
                                                     wrap(hash(<wrap(method.1), wrap(suitesI.1), 
                                                                wrap('g'^~X.1), wrap(C_I.1), 
                                                                wrap(psk_id(~id_i.1)), EAD_1.1>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.1,
                                                 edhoc_kdf(hkdfextract('null', G_Y.1^~X.1),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.1), C_R.1, 
                                                                 wrap(hash(<wrap(method.1), 
                                                                            wrap(suitesI.1), 
                                                                            wrap('g'^~X.1), 
                                                                            wrap(C_I.1), 
                                                                            wrap(psk_id(~id_i.1)), 
                                                                            EAD_1.1>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.1)>),
                                    iv_length))
                 >
);"]:
     [
     State_11111111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i,
                                                      ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                                      ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >)), 
                                                decxor(CIPHERTEXT_2,
                                                       edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                 hash(<wrap(G_Y), C_R, 
                                                                       wrap(hash(<wrap(method), 
                                                                                  wrap(suitesI), 
                                                                                  wrap('g'^~X), wrap(C_I), 
                                                                                  wrap(psk_id(~id_i)), EAD_1
                                                                                 >))
                                                                      >),
                                                                 plaintext_length)), 
                                                psk_cred(~psk)>)), 
                                     ~EAD_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R, ~X, G_Y,
                     <
                      hash(<wrap(G_Y), C_R, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                       wrap(psk_id(~id_i)), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap(G_Y), C_R, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                  wrap(psk_id(~id_i)), EAD_1>))
                                      >)), 
                            decxor(CIPHERTEXT_2,
                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                             hash(<wrap(G_Y), C_R, 
                                                   wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                              wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                  >),
                                             plaintext_length)), 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap(G_Y), C_R, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                             wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                 >)), 
                                       decxor(CIPHERTEXT_2,
                                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                        hash(<wrap(G_Y), C_R, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap('g'^~X), wrap(C_I), 
                                                                         wrap(psk_id(~id_i)), EAD_1>))
                                                             >),
                                                        plaintext_length)), 
                                       psk_cred(~psk)>)), 
                            ~EAD_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, EAD_2, ~EAD_3, 
                      <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1>, m2, 
                      aeadenc(~EAD_3, 'rep',
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'k_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        key_length),
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'iv_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        iv_length))
                     >
    )
    ]->
     [
     State_11111111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                         ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                         G_Y, ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     ),
     Out( aeadenc(~EAD_3, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.31
       G_Y   = G_Y.40
       z     = G_Y.40^~X.31
    
    2. ~X    = ~X.39
       G_Y   = z.56^inv(~X.39)
       z     = z.56
    
    3. ~X    = ~X.279
       G_Y   = x.553^x.554
       z     = x.553^(~X.279*x.554)
    
    4. ~X    = ~X.288
       G_Y   = x.571^inv((~X.288*x.572))
       z     = x.571^inv(x.572)
    
    5. ~X    = ~X.288
       G_Y   = x.571^(x.572*inv(~X.288))
       z     = x.571^x.572
    
    6. ~X    = ~X.289
       G_Y   = x.572^(x.573*inv((~X.289*x.574)))
       z     = x.572^(x.573*inv(x.574))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_11111111111111111111111211111112111111111111[color=#408079,
                                                                                       process="event LeakSessionKey( 'null' );"]:
   [
   State_11111111111111111111111211111112111111111111( ~EAD_3.1, ~X.1,
                                                       ~id_i.1, ~id_r.1, ~psk.1, CIPHERTEXT_2.1, C_I.1, C_R.1,
                                                       EAD_1.1, EAD_2.1, G_Y.1, ID_CRED_PSK_R.1, MAC_2.1,
                                                       m2.1, method.1, suitesI.1
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_11111111111111111111111211111112111111111111[color=#408079,
                                                                                          process="event LeakSessionKey( 'null' );"]:
     [
     State_11111111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                         ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                         G_Y, ID_CRED_PSK_R, MAC_2, m2, method, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) inm_0_1111111111111121[color=#408057,
                                       process="in(m1.2);"]:
   [ State_1111111111111121( ~id_i.1, ~id_r.1, ~psk.1 ), In( m1.2 ) ]
  -->
   [ Let_111111111111112111( m1.2, ~id_i.1, ~id_r.1, ~psk.1, m1.2 ) ]

  /*
  rule (modulo AC) inm_0_1111111111111121[color=#408057,
                                          process="in(m1.2);"]:
     [ State_1111111111111121( ~id_i, ~id_r, ~psk ), In( m1 ) ]
    -->
     [ Let_111111111111112111( m1, ~id_i, ~id_r, ~psk, m1 ) ]
  */

rule (modulo E) letmethodsuitesIGXCIIDCREDPSKIEADm_1_11111111111111211[color=#ffffff,
                                                                       process="let <method.2, suitesI.2, G_X.2, C_I.2, ID_CRED_PSK_I.1, EAD_1.2>=m1.2"]:
   [
   Let_111111111111112111( <method.2, suitesI.2, G_X.2, C_I.2, 
                            ID_CRED_PSK_I.1, EAD_1.2>,
                           ~id_i.1, ~id_r.1, ~psk.1, m1.2
   )
   ]
  -->
   [
   State_111111111111112111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                             C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) letmethodsuitesIGXCIIDCREDPSKIEADm_1_11111111111111211[color=#ffffff,
                                                                          process="let <method.2, suitesI.2, G_X.2, C_I.2, ID_CRED_PSK_I.1, EAD_1.2>=m1.2"]:
     [
     Let_111111111111112111( <method, suitesI, G_X, C_I, ID_CRED_PSK_I, EAD_1
                             >,
                             ~id_i, ~id_r, ~psk, m1
     )
     ]
    -->
     [
     State_111111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventMethodOkmethod_0_111111111111112111[color=#408048,
                                                         process="event MethodOk( method.2 );"]:
   [
   State_111111111111112111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                             C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]
  --[ MethodOk( method.2 ) ]->
   [
   State_1111111111111121111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                              C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventMethodOkmethod_0_111111111111112111[color=#408048,
                                                            process="event MethodOk( method.2 );"]:
     [
     State_111111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
    --[ MethodOk( method ) ]->
     [
     State_1111111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_1111111111111121111[color=#408048,
                                                                    process="event Eq( method.2, method_psk_variant1 );"]:
   [
   State_1111111111111121111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                              C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]
  --[ Eq( method.2, method_psk_variant1 ) ]->
   [
   State_11111111111111211111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                               C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_1111111111111121111[color=#408048,
                                                                       process="event Eq( method.2, method_psk_variant1 );"]:
     [
     State_1111111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_11111111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                 EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifmethodmethodpskvariant_0_11111111111111211111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_11111111111111211111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_11111111111111211111[color=#408048,
                                                                process="if method.2 = method_psk_variant1"]:
   [
   State_11111111111111211111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                               C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]
  --[
  Eq( ID_CRED_PSK_I.1, ~id_i.1 ),
  Restr_ifmethodmethodpskvariant_0_11111111111111211111_1( method.2 )
  ]->
   [
   State_1111111111111121111111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                                 C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_11111111111111211111[color=#408048,
                                                                   process="if method.2 = method_psk_variant1"]:
     [
     State_11111111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                 EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_I, ~id_i ),
    Restr_ifmethodmethodpskvariant_0_11111111111111211111_1( method )
    ]->
     [
     State_1111111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                   EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_11111111111111211111111111111[color=#40804f,
                                                                   process="event LeakShare( 'null' );"]:
   [
   State_11111111111111211111111111111( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                        method.2, suitesI.2
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_11111111111111211111111111111[color=#40804f,
                                                                      process="event LeakShare( 'null' );"]:
     [
     State_11111111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifIDCREDPSKIidi_0_1111111111111121111111_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKIidi_0_1111111111111121111111_1( x, x.1 ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKIidi_0_1111111111111121111111[color=#408048,
                                                         process="if ID_CRED_PSK_I.1 = ~id_i.1"]:
   [
   State_1111111111111121111111( ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                                 C_I.2, EAD_1.2, G_X.2, m1.2, method.2, suitesI.2
   ),
   Fr( ~Y.1 ), Fr( ~EAD_2.2 ), Fr( ~EAD_4.1 )
   ]
  --[
  Share( ~Y.1 ),
  Restr_ifIDCREDPSKIidi_0_1111111111111121111111_1( ID_CRED_PSK_I.1,
                                                    ~id_i.1
  )
  ]->
   [
   State_11111111111111211111111111111( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                        method.2, suitesI.2
   ),
   State_1111111111111121111111111112( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                       ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                       method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKIidi_0_1111111111111121111111[color=#408048,
                                                            process="if ID_CRED_PSK_I.1 = ~id_i.1"]:
     [
     State_1111111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                   EAD_1, G_X, m1, method, suitesI
     ),
     Fr( ~Y ), Fr( ~EAD_2 ), Fr( ~EAD_4 )
     ]
    --[
    Share( ~Y ),
    Restr_ifIDCREDPSKIidi_0_1111111111111121111111_1( ID_CRED_PSK_I, ~id_i )
    ]->
     [
     State_11111111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     ),
     State_1111111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGX_0_1111111111111121111111111112[color=#408048,
                                                                 process="event GroupCheck( G_X.2 );"]:
   [
   State_1111111111111121111111111112( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                       ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                       method.2, suitesI.2
   )
   ]
  --[ GroupCheck( G_X.2 ) ]->
   [
   State_11111111111111211111111111121( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                        method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGX_0_1111111111111121111111111112[color=#408048,
                                                                    process="event GroupCheck( G_X.2 );"]:
     [
     State_1111111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ GroupCheck( G_X ) ]->
     [
     State_11111111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGXgrpid_1_11111111111111211111111111121_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGXgrpid_1_11111111111111211111111111121_1( x ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGXgrpid_1_11111111111111211111111111121[color=#408048,
                                                                  process="if check_grp(G_X.2) = grpid"]:
   [
   State_11111111111111211111111111121( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                        ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                        method.2, suitesI.2
   )
   ]
  --[
  DerivedR_PSK( ~id_r.1, ID_CRED_PSK_I.1, psk_id(~id_r.1),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                       wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                ~Y.1, G_X.2
  ),
  Restr_ifcheckgrpGXgrpid_1_11111111111111211111111111121_1( check_grp(G_X.2)
  )
  ]->
   [
   State_1111111111111121111111111112121( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                          ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                          method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGXgrpid_1_11111111111111211111111111121[color=#408048,
                                                                     process="if check_grp(G_X.2) = grpid"]:
     [
     State_11111111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    DerivedR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  ~Y, G_X
    ),
    Restr_ifcheckgrpGXgrpid_1_11111111111111211111111111121_1( check_grp(G_X)
    )
    ]->
     [
     State_1111111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.27
       G_X   = G_X.35
       z     = G_X.35^~Y.27
    
    2. ~Y    = ~Y.32
       G_X   = z.45^inv(~Y.32)
       z     = z.45
    
    3. ~Y    = ~Y.111
       G_X   = x.216^x.217
       z     = x.216^(~Y.111*x.217)
    
    4. ~Y    = ~Y.119
       G_X   = x.232^inv((~Y.119*x.233))
       z     = x.232^inv(x.233)
    
    5. ~Y    = ~Y.119
       G_X   = x.232^(x.233*inv(~Y.119))
       z     = x.232^x.233
    
    6. ~Y    = ~Y.120
       G_X   = x.233^(x.234*inv((~Y.120*x.235)))
       z     = x.233^(x.234*inv(x.235))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventResponderStartPSKidrpskIDCREDPSKI_0_1111111111111121111111111112121[color=#408048,
                                                                                         process="event ResponderStart_PSK( ~id_r.1, ~psk.1, ID_CRED_PSK_I.1 );"]:
   [
   State_1111111111111121111111111112121( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                          ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                          method.2, suitesI.2
   )
   ]
  --[ ResponderStart_PSK( ~id_r.1, ~psk.1, ID_CRED_PSK_I.1 ) ]->
   [
   State_11111111111111211111111111121211( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                           ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                           method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventResponderStartPSKidrpskIDCREDPSKI_0_1111111111111121111111111112121[color=#408048,
                                                                                            process="event ResponderStart_PSK( ~id_r.1, ~psk.1, ID_CRED_PSK_I.1 );"]:
     [
     State_1111111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ ResponderStart_PSK( ~id_r, ~psk, ID_CRED_PSK_I ) ]->
     [
     State_11111111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididrgrpid_0_11111111111111211111111111121211[color=#408048,
                                                                         process="event Neq( psk_id(~id_r.1), grpid );"]:
   [
   State_11111111111111211111111111121211( ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1,
                                           ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2,
                                           method.2, suitesI.2
   )
   ]
  --[ Neq( psk_id(~id_r.1), grpid ) ]->
   [
   State_111111111111112111111111111212111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                            ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2,
                                            m1.2, method.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventNeqpskididrgrpid_0_11111111111111211111111111121211[color=#408048,
                                                                            process="event Neq( psk_id(~id_r.1), grpid );"]:
     [
     State_11111111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_r), grpid ) ]->
     [
     State_111111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_111111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.1,
               <
                hash(<wrap('g'^~Y.1), ~id_r.1, 
                      wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                 wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                     >), 
                suitesI.2, EAD_1.2, ~EAD_2.2, m1.2, 'g'^~Y.1, 
                decxor(<psk_id(~id_r.1), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                              wrap(hash(<wrap(method.2), 
                                                                         wrap(suitesI.2), 
                                                                         wrap(G_X.2), wrap(C_I.2), 
                                                                         wrap(ID_CRED_PSK_I.1), 
                                                                         EAD_1.2>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.1)),
                                  'mac_2',
                                  <~id_r.1, ID_CRED_PSK_I.1, 
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >), 
                                   psk_cred(~psk.1), ~EAD_2.2>,
                                  edhoc_mac_length), 
                        ~EAD_2.2>,
                       edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                  wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                      >),
                                 plaintext_length)), 
                ~id_r.1>
);"]:
   [
   State_111111111111112111111111111212111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                            ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2, G_X.2,
                                            m1.2, method.2, suitesI.2
   )
   ]
  --[
  SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.1,
                 <
                  hash(<wrap('g'^~Y.1), ~id_r.1, 
                        wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                   wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                       >), 
                  suitesI.2, EAD_1.2, ~EAD_2.2, m1.2, 'g'^~Y.1, 
                  decxor(<psk_id(~id_r.1), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                          'salt_3e2m',
                                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                           wrap(G_X.2), wrap(C_I.2), 
                                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.1)),
                                    'mac_2',
                                    <~id_r.1, ID_CRED_PSK_I.1, 
                                     hash(<wrap('g'^~Y.1), ~id_r.1, 
                                           wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                      wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                          >), 
                                     psk_cred(~psk.1), ~EAD_2.2>,
                                    edhoc_mac_length), 
                          ~EAD_2.2>,
                         edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >),
                                   plaintext_length)), 
                  ~id_r.1>
  )
  ]->
   [
   State_11111111111111211111111111121211111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                              ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                              G_X.2, m1.2, method.2, suitesI.2
   ),
   Out( <'g'^~Y.1, 
         decxor(<psk_id(~id_r.1), 
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.1)),
                           'mac_2',
                           <~id_r.1, ID_CRED_PSK_I.1, 
                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                  wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                             wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                 >), 
                            psk_cred(~psk.1), ~EAD_2.2>,
                           edhoc_mac_length), 
                 ~EAD_2.2>,
                edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                               >),
                          plaintext_length)), 
         ~id_r.1>
   )
   ]

  /*
  rule (modulo AC) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_111111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.1,
               <
                hash(<wrap('g'^~Y.1), ~id_r.1, 
                      wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                 wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                     >), 
                suitesI.2, EAD_1.2, ~EAD_2.2, m1.2, 'g'^~Y.1, 
                decxor(<psk_id(~id_r.1), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                              wrap(hash(<wrap(method.2), 
                                                                         wrap(suitesI.2), 
                                                                         wrap(G_X.2), wrap(C_I.2), 
                                                                         wrap(ID_CRED_PSK_I.1), 
                                                                         EAD_1.2>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.1)),
                                  'mac_2',
                                  <~id_r.1, ID_CRED_PSK_I.1, 
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >), 
                                   psk_cred(~psk.1), ~EAD_2.2>,
                                  edhoc_mac_length), 
                        ~EAD_2.2>,
                       edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                  wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                      >),
                                 plaintext_length)), 
                ~id_r.1>
);"]:
     [
     State_111111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I,
                   <
                    hash(<wrap('g'^~Y), ~id_r, 
                          wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                     wrap(ID_CRED_PSK_I), EAD_1>))
                         >), 
                    suitesI, EAD_1, ~EAD_2, m1, 'g'^~Y, 
                    decxor(<psk_id(~id_r), 
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk)),
                                      'mac_2',
                                      <~id_r, ID_CRED_PSK_I, 
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >), 
                                       psk_cred(~psk), ~EAD_2>,
                                      edhoc_mac_length), 
                            ~EAD_2>,
                           edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >),
                                     plaintext_length)), 
                    ~id_r>
    )
    ]->
     [
     State_11111111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method,
                                                suitesI
     ),
     Out( <'g'^~Y, 
           decxor(<psk_id(~id_r), 
                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk)),
                             'mac_2',
                             <~id_r, ID_CRED_PSK_I, 
                              hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >), 
                              psk_cred(~psk), ~EAD_2>,
                             edhoc_mac_length), 
                   ~EAD_2>,
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length)), 
           ~id_r>
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.28
       G_X   = G_X.36
       z     = G_X.36^~Y.28
    
    2. ~Y    = ~Y.34
       G_X   = z.48^inv(~Y.34)
       z     = z.48
    
    3. ~Y    = ~Y.160
       G_X   = x.314^x.315
       z     = x.314^(~Y.160*x.315)
    
    4. ~Y    = ~Y.168
       G_X   = x.330^inv((~Y.168*x.331))
       z     = x.330^inv(x.331)
    
    5. ~Y    = ~Y.168
       G_X   = x.330^(x.331*inv(~Y.168))
       z     = x.330^x.331
    
    6. ~Y    = ~Y.169
       G_X   = x.331^(x.332*inv((~Y.169*x.333)))
       z     = x.331^(x.332*inv(x.333))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) inm_0_11111111111111211111111111121211111[color=#408048,
                                                          process="in(m3.2);"]:
   [
   State_11111111111111211111111111121211111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                              ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                              G_X.2, m1.2, method.2, suitesI.2
   ),
   In( m3.2 )
   ]
  --[
  THRShared_PSK( psk_id(~id_r.1),
                 hash(<
                       wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                  wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                             wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                 >)), 
                       <psk_id(~id_r.1), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                         wrap(G_X.2), wrap(C_I.2), 
                                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.1)),
                                  'mac_2',
                                  <~id_r.1, ID_CRED_PSK_I.1, 
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >), 
                                   psk_cred(~psk.1), ~EAD_2.2>,
                                  edhoc_mac_length), 
                        ~EAD_2.2>, 
                       psk_cred(~psk.1)>)
  )
  ]->
   [
   Let_11111111111111211111111111121211111111( <m3.2, 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.2^~Y.1),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.1), 
                                                                                      ~id_r.1, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.2), 
                                                                                                 wrap(suitesI.2), 
                                                                                                 wrap(G_X.2), 
                                                                                                 wrap(C_I.2), 
                                                                                                 wrap(ID_CRED_PSK_I.1), 
                                                                                                 EAD_1.2>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.1)),
                                                          'k_3',
                                                          hash(<
                                                                wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                           wrap(hash(<wrap(method.2), 
                                                                                      wrap(suitesI.2), 
                                                                                      wrap(G_X.2), 
                                                                                      wrap(C_I.2), 
                                                                                      wrap(ID_CRED_PSK_I.1), 
                                                                                      EAD_1.2>))
                                                                          >)), 
                                                                <psk_id(~id_r.1), 
                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                             G_X.2^~Y.1),
                                                                                                 'salt_3e2m',
                                                                                                 hash(<
                                                                                                       wrap('g'^~Y.1), 
                                                                                                       ~id_r.1, 
                                                                                                       wrap(hash(<
                                                                                                                  wrap(method.2), 
                                                                                                                  wrap(suitesI.2), 
                                                                                                                  wrap(G_X.2), 
                                                                                                                  wrap(C_I.2), 
                                                                                                                  wrap(ID_CRED_PSK_I.1), 
                                                                                                                  EAD_1.2
                                                                                                                 >))
                                                                                                      >),
                                                                                                 hash_length),
                                                                                       psk_cred(~psk.1)),
                                                                           'mac_2',
                                                                           <~id_r.1, ID_CRED_PSK_I.1, 
                                                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                  wrap(hash(<wrap(method.2), 
                                                                                             wrap(suitesI.2), 
                                                                                             wrap(G_X.2), 
                                                                                             wrap(C_I.2), 
                                                                                             wrap(ID_CRED_PSK_I.1), 
                                                                                             EAD_1.2>))
                                                                                 >), 
                                                                            psk_cred(~psk.1), ~EAD_2.2>,
                                                                           edhoc_mac_length), 
                                                                 ~EAD_2.2>, 
                                                                psk_cred(~psk.1)>),
                                                          key_length), 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.2^~Y.1),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.1), 
                                                                                      ~id_r.1, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.2), 
                                                                                                 wrap(suitesI.2), 
                                                                                                 wrap(G_X.2), 
                                                                                                 wrap(C_I.2), 
                                                                                                 wrap(ID_CRED_PSK_I.1), 
                                                                                                 EAD_1.2>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.1)),
                                                          'iv_3',
                                                          hash(<
                                                                wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                           wrap(hash(<wrap(method.2), 
                                                                                      wrap(suitesI.2), 
                                                                                      wrap(G_X.2), 
                                                                                      wrap(C_I.2), 
                                                                                      wrap(ID_CRED_PSK_I.1), 
                                                                                      EAD_1.2>))
                                                                          >)), 
                                                                <psk_id(~id_r.1), 
                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                             G_X.2^~Y.1),
                                                                                                 'salt_3e2m',
                                                                                                 hash(<
                                                                                                       wrap('g'^~Y.1), 
                                                                                                       ~id_r.1, 
                                                                                                       wrap(hash(<
                                                                                                                  wrap(method.2), 
                                                                                                                  wrap(suitesI.2), 
                                                                                                                  wrap(G_X.2), 
                                                                                                                  wrap(C_I.2), 
                                                                                                                  wrap(ID_CRED_PSK_I.1), 
                                                                                                                  EAD_1.2
                                                                                                                 >))
                                                                                                      >),
                                                                                                 hash_length),
                                                                                       psk_cred(~psk.1)),
                                                                           'mac_2',
                                                                           <~id_r.1, ID_CRED_PSK_I.1, 
                                                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                  wrap(hash(<wrap(method.2), 
                                                                                             wrap(suitesI.2), 
                                                                                             wrap(G_X.2), 
                                                                                             wrap(C_I.2), 
                                                                                             wrap(ID_CRED_PSK_I.1), 
                                                                                             EAD_1.2>))
                                                                                 >), 
                                                                            psk_cred(~psk.1), ~EAD_2.2>,
                                                                           edhoc_mac_length), 
                                                                 ~EAD_2.2>, 
                                                                psk_cred(~psk.1)>),
                                                          iv_length)
                                               >,
                                               ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                                               ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                               suitesI.2
   )
   ]

  /*
  rule (modulo AC) inm_0_11111111111111211111111111121211111[color=#408048,
                                                             process="in(m3.2);"]:
     [
     State_11111111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method,
                                                suitesI
     ),
     In( m3 )
     ]
    --[
    THRShared_PSK( psk_id(~id_r),
                   hash(<
                         wrap(hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >)), 
                         <psk_id(~id_r), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                          hash(<wrap('g'^~Y), ~id_r, 
                                                                wrap(hash(<wrap(method), wrap(suitesI), 
                                                                           wrap(G_X), wrap(C_I), 
                                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk)),
                                    'mac_2',
                                    <~id_r, ID_CRED_PSK_I, 
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >), 
                                     psk_cred(~psk), ~EAD_2>,
                                    edhoc_mac_length), 
                          ~EAD_2>, 
                         psk_cred(~psk)>)
    )
    ]->
     [
     Let_11111111111111211111111111121211111111( <m3, 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'k_3',
                                                            hash(<
                                                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                             wrap(hash(<wrap(method), 
                                                                                        wrap(suitesI), 
                                                                                        wrap(G_X), wrap(C_I), 
                                                                                        wrap(ID_CRED_PSK_I), 
                                                                                        EAD_1>))
                                                                            >)), 
                                                                  <psk_id(~id_r), 
                                                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                               z),
                                                                                                   'salt_3e2m',
                                                                                                   hash(<
                                                                                                         wrap('g'^~Y), 
                                                                                                         ~id_r, 
                                                                                                         wrap(hash(<
                                                                                                                    wrap(method), 
                                                                                                                    wrap(suitesI), 
                                                                                                                    wrap(G_X), 
                                                                                                                    wrap(C_I), 
                                                                                                                    wrap(ID_CRED_PSK_I), 
                                                                                                                    EAD_1
                                                                                                                   >))
                                                                                                        >),
                                                                                                   hash_length),
                                                                                         psk_cred(~psk)),
                                                                             'mac_2',
                                                                             <~id_r, ID_CRED_PSK_I, 
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >), 
                                                                              psk_cred(~psk), ~EAD_2>,
                                                                             edhoc_mac_length), 
                                                                   ~EAD_2>, 
                                                                  psk_cred(~psk)>),
                                                            key_length), 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'iv_3',
                                                            hash(<
                                                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                             wrap(hash(<wrap(method), 
                                                                                        wrap(suitesI), 
                                                                                        wrap(G_X), wrap(C_I), 
                                                                                        wrap(ID_CRED_PSK_I), 
                                                                                        EAD_1>))
                                                                            >)), 
                                                                  <psk_id(~id_r), 
                                                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                               z),
                                                                                                   'salt_3e2m',
                                                                                                   hash(<
                                                                                                         wrap('g'^~Y), 
                                                                                                         ~id_r, 
                                                                                                         wrap(hash(<
                                                                                                                    wrap(method), 
                                                                                                                    wrap(suitesI), 
                                                                                                                    wrap(G_X), 
                                                                                                                    wrap(C_I), 
                                                                                                                    wrap(ID_CRED_PSK_I), 
                                                                                                                    EAD_1
                                                                                                                   >))
                                                                                                        >),
                                                                                                   hash_length),
                                                                                         psk_cred(~psk)),
                                                                             'mac_2',
                                                                             <~id_r, ID_CRED_PSK_I, 
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >), 
                                                                              psk_cred(~psk), ~EAD_2>,
                                                                             edhoc_mac_length), 
                                                                   ~EAD_2>, 
                                                                  psk_cred(~psk)>),
                                                            iv_length)
                                                 >,
                                                 ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                 EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.28
       G_X   = G_X.36
       z     = G_X.36^~Y.28
    
    2. ~Y    = ~Y.34
       G_X   = z.48^inv(~Y.34)
       z     = z.48
    
    3. ~Y    = ~Y.195
       G_X   = x.384^x.385
       z     = x.384^(~Y.195*x.385)
    
    4. ~Y    = ~Y.203
       G_X   = x.400^inv((~Y.203*x.401))
       z     = x.400^inv(x.401)
    
    5. ~Y    = ~Y.203
       G_X   = x.400^(x.401*inv(~Y.203))
       z     = x.400^x.401
    
    6. ~Y    = ~Y.204
       G_X   = x.401^(x.402*inv((~Y.204*x.403)))
       z     = x.401^(x.402*inv(x.403))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_1111111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     process="let plaintext_3.2=aeaddec(m3.2,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.1)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.1)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>),
                  iv_length))"]:
   [
   Let_11111111111111211111111111121211111111( <
                                                aeadenc(plaintext_3.2, r, k, ad), k, ad>,
                                               ~EAD_4.1, ~Y.1, ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1,
                                               ~EAD_2.2, C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                               suitesI.2
   )
   ]
  -->
   [
   State_11111111111111211111111111121211111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                 ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                 G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_1111111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        process="let plaintext_3.2=aeaddec(m3.2,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.1)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.1)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>),
                  iv_length))"]:
     [
     Let_11111111111111211111111111121211111111( <
                                                  aeadenc(plaintext_3, r, k, ad), k, ad>,
                                                 ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                 EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    -->
     [
     State_11111111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
  */

rule (modulo E) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_11111111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event AcceptR_PSK( ~id_r.1, method_psk_variant1, ID_CRED_PSK_I.1,
             psk_id(~id_r.1),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                              wrap(G_X.2), wrap(C_I.2), 
                                                              wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.1)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                              wrap(G_X.2), wrap(C_I.2), 
                                                              wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                  >)), 
                                        <psk_id(~id_r.1), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.2^~Y.1),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.1), 
                                                                               ~id_r.1, 
                                                                               wrap(hash(<
                                                                                          wrap(method.2), 
                                                                                          wrap(suitesI.2), 
                                                                                          wrap(G_X.2), 
                                                                                          wrap(C_I.2), 
                                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                                          EAD_1.2>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.1)),
                                                   'mac_2',
                                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                          wrap(hash(<wrap(method.2), 
                                                                     wrap(suitesI.2), wrap(G_X.2), 
                                                                     wrap(C_I.2), 
                                                                     wrap(ID_CRED_PSK_I.1), EAD_1.2
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.1), ~EAD_2.2>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.2>, 
                                        psk_cred(~psk.1)>)), 
                             plaintext_3.2, psk_cred(~psk.1)>),
                       hash_length)
);"]:
   [
   State_11111111111111211111111111121211111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                 ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                 G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]
  --[
  AcceptR_PSK( ~id_r.1, method_psk_variant1, ID_CRED_PSK_I.1,
               psk_id(~id_r.1),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                     hash(<wrap('g'^~Y.1), ~id_r.1, 
                                           wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                      wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.1)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                               'salt_3e2m',
                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                     wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                                wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.1)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                     wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                                wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                    >)), 
                                          <psk_id(~id_r.1), 
                                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                           'salt_3e2m',
                                                                           hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                 wrap(hash(<wrap(method.2), 
                                                                                            wrap(suitesI.2), 
                                                                                            wrap(G_X.2), 
                                                                                            wrap(C_I.2), 
                                                                                            wrap(ID_CRED_PSK_I.1), 
                                                                                            EAD_1.2>))
                                                                                >),
                                                                           hash_length),
                                                                 psk_cred(~psk.1)),
                                                     'mac_2',
                                                     <~id_r.1, ID_CRED_PSK_I.1, 
                                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                       wrap(G_X.2), wrap(C_I.2), 
                                                                       wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                           >), 
                                                      psk_cred(~psk.1), ~EAD_2.2>,
                                                     edhoc_mac_length), 
                                           ~EAD_2.2>, 
                                          psk_cred(~psk.1)>)), 
                               plaintext_3.2, psk_cred(~psk.1)>),
                         hash_length)
  )
  ]->
   [
   State_111111111111112111111111111212111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                  ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                  G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_11111111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event AcceptR_PSK( ~id_r.1, method_psk_variant1, ID_CRED_PSK_I.1,
             psk_id(~id_r.1),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.1)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                              wrap(G_X.2), wrap(C_I.2), 
                                                              wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.1)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                              wrap(G_X.2), wrap(C_I.2), 
                                                              wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                  >)), 
                                        <psk_id(~id_r.1), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.2^~Y.1),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.1), 
                                                                               ~id_r.1, 
                                                                               wrap(hash(<
                                                                                          wrap(method.2), 
                                                                                          wrap(suitesI.2), 
                                                                                          wrap(G_X.2), 
                                                                                          wrap(C_I.2), 
                                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                                          EAD_1.2>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.1)),
                                                   'mac_2',
                                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                          wrap(hash(<wrap(method.2), 
                                                                     wrap(suitesI.2), wrap(G_X.2), 
                                                                     wrap(C_I.2), 
                                                                     wrap(ID_CRED_PSK_I.1), EAD_1.2
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.1), ~EAD_2.2>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.2>, 
                                        psk_cred(~psk.1)>)), 
                             plaintext_3.2, psk_cred(~psk.1)>),
                       hash_length)
);"]:
     [
     State_11111111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptR_PSK( ~id_r, method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >)), 
                                            <psk_id(~id_r), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                                   wrap(hash(<wrap(method), 
                                                                                              wrap(suitesI), 
                                                                                              wrap(G_X), 
                                                                                              wrap(C_I), 
                                                                                              wrap(ID_CRED_PSK_I), 
                                                                                              EAD_1>))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk)),
                                                       'mac_2',
                                                       <~id_r, ID_CRED_PSK_I, 
                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap(G_X), wrap(C_I), 
                                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                                             >), 
                                                        psk_cred(~psk), ~EAD_2>,
                                                       edhoc_mac_length), 
                                             ~EAD_2>, 
                                            psk_cred(~psk)>)), 
                                 plaintext_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_111111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.29
       G_X   = G_X.37
       z     = G_X.37^~Y.29
    
    2. ~Y    = ~Y.36
       G_X   = z.51^inv(~Y.36)
       z     = z.51
    
    3. ~Y    = ~Y.175
       G_X   = x.344^x.345
       z     = x.344^(~Y.175*x.345)
    
    4. ~Y    = ~Y.183
       G_X   = x.360^inv((~Y.183*x.361))
       z     = x.360^inv(x.361)
    
    5. ~Y    = ~Y.183
       G_X   = x.360^(x.361*inv(~Y.183))
       z     = x.360^x.361
    
    6. ~Y    = ~Y.184
       G_X   = x.361^(x.362*inv((~Y.184*x.363)))
       z     = x.361^(x.362*inv(x.363))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_111111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event SessionSecrets_R( ~id_r.1, ~Y.1, G_X.2,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                        wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                   wrap(G_X.2), wrap(C_I.2), 
                                                                   wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.1)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                        wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                   wrap(G_X.2), wrap(C_I.2), 
                                                                   wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                       >)), 
                                             <psk_id(~id_r.1), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.2^~Y.1),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.1), 
                                                                                    ~id_r.1, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.2), 
                                                                                               wrap(suitesI.2), 
                                                                                               wrap(G_X.2), 
                                                                                               wrap(C_I.2), 
                                                                                               wrap(ID_CRED_PSK_I.1), 
                                                                                               EAD_1.2
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.1)),
                                                        'mac_2',
                                                        <~id_r.1, ID_CRED_PSK_I.1, 
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >), 
                                                         psk_cred(~psk.1), ~EAD_2.2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.2>, 
                                             psk_cred(~psk.1)>)), 
                                  plaintext_3.2, psk_cred(~psk.1)>),
                            hash_length)
);"]:
   [
   State_111111111111112111111111111212111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                  ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                  G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]
  --[
  SessionSecrets_R( ~id_r.1, ~Y.1, G_X.2,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                    'salt_3e2m',
                                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                     wrap(G_X.2), wrap(C_I.2), 
                                                                     wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.1)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                     wrap(G_X.2), wrap(C_I.2), 
                                                                     wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                         >)), 
                                               <psk_id(~id_r.1), 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.2^~Y.1),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.1), 
                                                                                      ~id_r.1, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.2), 
                                                                                                 wrap(suitesI.2), 
                                                                                                 wrap(G_X.2), 
                                                                                                 wrap(C_I.2), 
                                                                                                 wrap(ID_CRED_PSK_I.1), 
                                                                                                 EAD_1.2>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.1)),
                                                          'mac_2',
                                                          <~id_r.1, ID_CRED_PSK_I.1, 
                                                           hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                 wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                            wrap(G_X.2), wrap(C_I.2), 
                                                                            wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                                >), 
                                                           psk_cred(~psk.1), ~EAD_2.2>,
                                                          edhoc_mac_length), 
                                                ~EAD_2.2>, 
                                               psk_cred(~psk.1)>)), 
                                    plaintext_3.2, psk_cred(~psk.1)>),
                              hash_length)
  )
  ]->
   [
   State_1111111111111121111111111112121111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                   ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                   G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_111111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     process="event SessionSecrets_R( ~id_r.1, ~Y.1, G_X.2,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                        wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                   wrap(G_X.2), wrap(C_I.2), 
                                                                   wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.1)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                        wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                   wrap(G_X.2), wrap(C_I.2), 
                                                                   wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                       >)), 
                                             <psk_id(~id_r.1), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.2^~Y.1),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.1), 
                                                                                    ~id_r.1, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.2), 
                                                                                               wrap(suitesI.2), 
                                                                                               wrap(G_X.2), 
                                                                                               wrap(C_I.2), 
                                                                                               wrap(ID_CRED_PSK_I.1), 
                                                                                               EAD_1.2
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.1)),
                                                        'mac_2',
                                                        <~id_r.1, ID_CRED_PSK_I.1, 
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >), 
                                                         psk_cred(~psk.1), ~EAD_2.2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.2>, 
                                             psk_cred(~psk.1)>)), 
                                  plaintext_3.2, psk_cred(~psk.1)>),
                            hash_length)
);"]:
     [
     State_111111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    --[
    SessionSecrets_R( ~id_r, ~Y, G_X,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >)), 
                                                 <psk_id(~id_r), 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'mac_2',
                                                            <~id_r, ID_CRED_PSK_I, 
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >), 
                                                             psk_cred(~psk), ~EAD_2>,
                                                            edhoc_mac_length), 
                                                  ~EAD_2>, 
                                                 psk_cred(~psk)>)), 
                                      plaintext_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_1111111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.29
       G_X   = G_X.37
       z     = G_X.37^~Y.29
    
    2. ~Y    = ~Y.36
       G_X   = z.51^inv(~Y.36)
       z     = z.51
    
    3. ~Y    = ~Y.175
       G_X   = x.344^x.345
       z     = x.344^(~Y.175*x.345)
    
    4. ~Y    = ~Y.183
       G_X   = x.360^inv((~Y.183*x.361))
       z     = x.360^inv(x.361)
    
    5. ~Y    = ~Y.183
       G_X   = x.360^(x.361*inv(~Y.183))
       z     = x.360^x.361
    
    6. ~Y    = ~Y.184
       G_X   = x.361^(x.362*inv((~Y.184*x.363)))
       z     = x.361^(x.362*inv(x.363))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_1111111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event SecretsR_PSK( ~id_r.1, ID_CRED_PSK_I.1, psk_id(~id_r.1),
              hkdfextract('null', G_X.2^~Y.1),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >)), 
                                         <psk_id(~id_r.1), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.2^~Y.1),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.1), 
                                                                                ~id_r.1, 
                                                                                wrap(hash(<
                                                                                           wrap(method.2), 
                                                                                           wrap(suitesI.2), 
                                                                                           wrap(G_X.2), 
                                                                                           wrap(C_I.2), 
                                                                                           wrap(ID_CRED_PSK_I.1), 
                                                                                           EAD_1.2
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.1)),
                                                    'mac_2',
                                                    <~id_r.1, ID_CRED_PSK_I.1, 
                                                     hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                           wrap(hash(<wrap(method.2), 
                                                                      wrap(suitesI.2), wrap(G_X.2), 
                                                                      wrap(C_I.2), 
                                                                      wrap(ID_CRED_PSK_I.1), EAD_1.2
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.1), ~EAD_2.2>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.2>, 
                                         psk_cred(~psk.1)>)), 
                              plaintext_3.2, psk_cred(~psk.1)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                              wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                         wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >)), 
                              <psk_id(~id_r.1), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                     wrap(hash(<wrap(method.2), 
                                                                                wrap(suitesI.2), 
                                                                                wrap(G_X.2), 
                                                                                wrap(C_I.2), 
                                                                                wrap(ID_CRED_PSK_I.1), 
                                                                                EAD_1.2>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.1)),
                                         'mac_2',
                                         <~id_r.1, ID_CRED_PSK_I.1, 
                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                           wrap(G_X.2), wrap(C_I.2), 
                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                               >), 
                                          psk_cred(~psk.1), ~EAD_2.2>,
                                         edhoc_mac_length), 
                               ~EAD_2.2>, 
                              psk_cred(~psk.1)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >)), 
                              <psk_id(~id_r.1), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                     wrap(hash(<wrap(method.2), 
                                                                                wrap(suitesI.2), 
                                                                                wrap(G_X.2), 
                                                                                wrap(C_I.2), 
                                                                                wrap(ID_CRED_PSK_I.1), 
                                                                                EAD_1.2>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.1)),
                                         'mac_2',
                                         <~id_r.1, ID_CRED_PSK_I.1, 
                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                           wrap(G_X.2), wrap(C_I.2), 
                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                               >), 
                                          psk_cred(~psk.1), ~EAD_2.2>,
                                         edhoc_mac_length), 
                               ~EAD_2.2>, 
                              psk_cred(~psk.1)>),
                        iv_length),
              ~Y.1, G_X.2
);"]:
   [
   State_1111111111111121111111111112121111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                   ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2, EAD_1.2,
                                                   G_X.2, m1.2, m3.2, method.2, plaintext_3.2, suitesI.2
   )
   ]
  --[
  SecretsR_PSK( ~id_r.1, ID_CRED_PSK_I.1, psk_id(~id_r.1),
                hkdfextract('null', G_X.2^~Y.1),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                       wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                       wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.1)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >)), 
                                           <psk_id(~id_r.1), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                  wrap(hash(<wrap(method.2), 
                                                                                             wrap(suitesI.2), 
                                                                                             wrap(G_X.2), 
                                                                                             wrap(C_I.2), 
                                                                                             wrap(ID_CRED_PSK_I.1), 
                                                                                             EAD_1.2>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.1)),
                                                      'mac_2',
                                                      <~id_r.1, ID_CRED_PSK_I.1, 
                                                       hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                             wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                        wrap(G_X.2), wrap(C_I.2), 
                                                                        wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                            >), 
                                                       psk_cred(~psk.1), ~EAD_2.2>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.2>, 
                                           psk_cred(~psk.1)>)), 
                                plaintext_3.2, psk_cred(~psk.1)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                           wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                      wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                          >)), 
                                <psk_id(~id_r.1), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                       wrap(hash(<wrap(method.2), 
                                                                                  wrap(suitesI.2), 
                                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                                  wrap(ID_CRED_PSK_I.1), 
                                                                                  EAD_1.2>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.1)),
                                           'mac_2',
                                           <~id_r.1, ID_CRED_PSK_I.1, 
                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                  wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                             wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                 >), 
                                            psk_cred(~psk.1), ~EAD_2.2>,
                                           edhoc_mac_length), 
                                 ~EAD_2.2>, 
                                psk_cred(~psk.1)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                           wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                      wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                          >)), 
                                <psk_id(~id_r.1), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                       wrap(hash(<wrap(method.2), 
                                                                                  wrap(suitesI.2), 
                                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                                  wrap(ID_CRED_PSK_I.1), 
                                                                                  EAD_1.2>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.1)),
                                           'mac_2',
                                           <~id_r.1, ID_CRED_PSK_I.1, 
                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                  wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                             wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                 >), 
                                            psk_cred(~psk.1), ~EAD_2.2>,
                                           edhoc_mac_length), 
                                 ~EAD_2.2>, 
                                psk_cred(~psk.1)>),
                          iv_length),
                ~Y.1, G_X.2
  )
  ]->
   [
   State_11111111111111211111111111121211111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                    ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2,
                                                    EAD_1.2, G_X.2, m1.2, m3.2, method.2, plaintext_3.2,
                                                    suitesI.2
   )
   ]

  /*
  rule (modulo AC) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_1111111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SecretsR_PSK( ~id_r.1, ID_CRED_PSK_I.1, psk_id(~id_r.1),
              hkdfextract('null', G_X.2^~Y.1),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.1)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >)), 
                                         <psk_id(~id_r.1), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.2^~Y.1),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.1), 
                                                                                ~id_r.1, 
                                                                                wrap(hash(<
                                                                                           wrap(method.2), 
                                                                                           wrap(suitesI.2), 
                                                                                           wrap(G_X.2), 
                                                                                           wrap(C_I.2), 
                                                                                           wrap(ID_CRED_PSK_I.1), 
                                                                                           EAD_1.2
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.1)),
                                                    'mac_2',
                                                    <~id_r.1, ID_CRED_PSK_I.1, 
                                                     hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                           wrap(hash(<wrap(method.2), 
                                                                      wrap(suitesI.2), wrap(G_X.2), 
                                                                      wrap(C_I.2), 
                                                                      wrap(ID_CRED_PSK_I.1), EAD_1.2
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.1), ~EAD_2.2>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.2>, 
                                         psk_cred(~psk.1)>)), 
                              plaintext_3.2, psk_cred(~psk.1)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                              wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                         wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >)), 
                              <psk_id(~id_r.1), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                     wrap(hash(<wrap(method.2), 
                                                                                wrap(suitesI.2), 
                                                                                wrap(G_X.2), 
                                                                                wrap(C_I.2), 
                                                                                wrap(ID_CRED_PSK_I.1), 
                                                                                EAD_1.2>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.1)),
                                         'mac_2',
                                         <~id_r.1, ID_CRED_PSK_I.1, 
                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                           wrap(G_X.2), wrap(C_I.2), 
                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                               >), 
                                          psk_cred(~psk.1), ~EAD_2.2>,
                                         edhoc_mac_length), 
                               ~EAD_2.2>, 
                              psk_cred(~psk.1)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                    wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                               wrap(G_X.2), wrap(C_I.2), 
                                                               wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.1)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                    wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                        >)), 
                              <psk_id(~id_r.1), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                     wrap(hash(<wrap(method.2), 
                                                                                wrap(suitesI.2), 
                                                                                wrap(G_X.2), 
                                                                                wrap(C_I.2), 
                                                                                wrap(ID_CRED_PSK_I.1), 
                                                                                EAD_1.2>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.1)),
                                         'mac_2',
                                         <~id_r.1, ID_CRED_PSK_I.1, 
                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                           wrap(G_X.2), wrap(C_I.2), 
                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                               >), 
                                          psk_cred(~psk.1), ~EAD_2.2>,
                                         edhoc_mac_length), 
                               ~EAD_2.2>, 
                              psk_cred(~psk.1)>),
                        iv_length),
              ~Y.1, G_X.2
);"]:
     [
     State_1111111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    --[
    SecretsR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~Y, G_X
    )
    ]->
     [
     State_11111111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1,
                                                      m3, method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.29
       G_X   = G_X.37
       z     = G_X.37^~Y.29
    
    2. ~Y    = ~Y.36
       G_X   = z.51^inv(~Y.36)
       z     = z.51
    
    3. ~Y    = ~Y.268
       G_X   = x.530^x.531
       z     = x.530^(~Y.268*x.531)
    
    4. ~Y    = ~Y.276
       G_X   = x.546^inv((~Y.276*x.547))
       z     = x.546^inv(x.547)
    
    5. ~Y    = ~Y.276
       G_X   = x.546^(x.547*inv(~Y.276))
       z     = x.546^x.547
    
    6. ~Y    = ~Y.277
       G_X   = x.547^(x.548*inv((~Y.277*x.549)))
       z     = x.547^(x.548*inv(x.549))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_111111111111112111111111111212111111111111111[color=#408072,
                                                                                        process="event LeakSessionKey( 'null' );"]:
   [
   State_111111111111112111111111111212111111111111111( ~EAD_4.1, ~Y.1,
                                                        ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2,
                                                        C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                                        plaintext_3.2, suitesI.2
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_111111111111112111111111111212111111111111111[color=#408072,
                                                                                           process="event LeakSessionKey( 'null' );"]:
     [
     State_111111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                          ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                          m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_11111111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.2^~Y.1),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.1)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >)), 
                                            <psk_id(~id_r.1), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.2^~Y.1),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.1), 
                                                                                   ~id_r.1, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.2), 
                                                                                              wrap(suitesI.2), 
                                                                                              wrap(G_X.2), 
                                                                                              wrap(C_I.2), 
                                                                                              wrap(ID_CRED_PSK_I.1), 
                                                                                              EAD_1.2
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.1)),
                                                       'mac_2',
                                                       <~id_r.1, ID_CRED_PSK_I.1, 
                                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                              wrap(hash(<wrap(method.2), 
                                                                         wrap(suitesI.2), 
                                                                         wrap(G_X.2), wrap(C_I.2), 
                                                                         wrap(ID_CRED_PSK_I.1), 
                                                                         EAD_1.2>))
                                                             >), 
                                                        psk_cred(~psk.1), ~EAD_2.2>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.2>, 
                                            psk_cred(~psk.1)>)), 
                                 plaintext_3.2, psk_cred(~psk.1)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.1, psk_id(~id_r.1), ~Y.1, G_X.2,
                 <
                  hash(<wrap('g'^~Y.1), ~id_r.1, 
                        wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                   wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >)), 
                                   <psk_id(~id_r.1), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                          wrap(hash(<
                                                                                     wrap(method.2), 
                                                                                     wrap(suitesI.2), 
                                                                                     wrap(G_X.2), 
                                                                                     wrap(C_I.2), 
                                                                                     wrap(ID_CRED_PSK_I.1), 
                                                                                     EAD_1.2>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.1)),
                                              'mac_2',
                                              <~id_r.1, ID_CRED_PSK_I.1, 
                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                     wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                wrap(G_X.2), wrap(C_I.2), 
                                                                wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                    >), 
                                               psk_cred(~psk.1), ~EAD_2.2>,
                                              edhoc_mac_length), 
                                    ~EAD_2.2>, 
                                   psk_cred(~psk.1)>)), 
                        plaintext_3.2, psk_cred(~psk.1)>), 
                  suitesI.2, EAD_1.2, ~EAD_2.2, plaintext_3.2, m1.2, 
                  <'g'^~Y.1, 
                   decxor(<psk_id(~id_r.1), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                 wrap(hash(<wrap(method.2), 
                                                                            wrap(suitesI.2), 
                                                                            wrap(G_X.2), 
                                                                            wrap(C_I.2), 
                                                                            wrap(ID_CRED_PSK_I.1), 
                                                                            EAD_1.2>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.1)),
                                     'mac_2',
                                     <~id_r.1, ID_CRED_PSK_I.1, 
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                       wrap(G_X.2), wrap(C_I.2), 
                                                       wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >), 
                                      psk_cred(~psk.1), ~EAD_2.2>,
                                     edhoc_mac_length), 
                           ~EAD_2.2>,
                          edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.1>, 
                  m3.2>
);"]:
   [
   State_11111111111111211111111111121211111111111( ~EAD_4.1, ~Y.1, ~id_i.1,
                                                    ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2, C_I.2,
                                                    EAD_1.2, G_X.2, m1.2, m3.2, method.2, plaintext_3.2,
                                                    suitesI.2
   )
   ]
  --[
  AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_X.2^~Y.1),
                                                   'salt_3e2m',
                                                   hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                    wrap(G_X.2), wrap(C_I.2), 
                                                                    wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.1)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                         wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                    wrap(G_X.2), wrap(C_I.2), 
                                                                    wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                        >)), 
                                              <psk_id(~id_r.1), 
                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                           G_X.2^~Y.1),
                                                                               'salt_3e2m',
                                                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                     wrap(hash(<
                                                                                                wrap(method.2), 
                                                                                                wrap(suitesI.2), 
                                                                                                wrap(G_X.2), 
                                                                                                wrap(C_I.2), 
                                                                                                wrap(ID_CRED_PSK_I.1), 
                                                                                                EAD_1.2>))
                                                                                    >),
                                                                               hash_length),
                                                                     psk_cred(~psk.1)),
                                                         'mac_2',
                                                         <~id_r.1, ID_CRED_PSK_I.1, 
                                                          hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                           wrap(G_X.2), wrap(C_I.2), 
                                                                           wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                               >), 
                                                          psk_cred(~psk.1), ~EAD_2.2>,
                                                         edhoc_mac_length), 
                                               ~EAD_2.2>, 
                                              psk_cred(~psk.1)>)), 
                                   plaintext_3.2, psk_cred(~psk.1)>),
                             hash_length),
                   method_psk_variant1, ID_CRED_PSK_I.1, psk_id(~id_r.1), ~Y.1, G_X.2,
                   <
                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                     wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                         >), 
                    hash(<
                          wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                     wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), wrap(C_I.2), 
                                                wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                    >)), 
                          <psk_id(~id_r.1), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                 wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                            wrap(G_X.2), wrap(C_I.2), 
                                                                            wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.1)),
                                     'mac_2',
                                     <~id_r.1, ID_CRED_PSK_I.1, 
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                       wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >), 
                                      psk_cred(~psk.1), ~EAD_2.2>,
                                     edhoc_mac_length), 
                           ~EAD_2.2>, 
                          psk_cred(~psk.1)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                           wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                               >)), 
                                     <psk_id(~id_r.1), 
                                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                      'salt_3e2m',
                                                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                            wrap(hash(<wrap(method.2), 
                                                                                       wrap(suitesI.2), 
                                                                                       wrap(G_X.2), 
                                                                                       wrap(C_I.2), 
                                                                                       wrap(ID_CRED_PSK_I.1), 
                                                                                       EAD_1.2>))
                                                                           >),
                                                                      hash_length),
                                                            psk_cred(~psk.1)),
                                                'mac_2',
                                                <~id_r.1, ID_CRED_PSK_I.1, 
                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >), 
                                                 psk_cred(~psk.1), ~EAD_2.2>,
                                                edhoc_mac_length), 
                                      ~EAD_2.2>, 
                                     psk_cred(~psk.1)>)), 
                          plaintext_3.2, psk_cred(~psk.1)>), 
                    suitesI.2, EAD_1.2, ~EAD_2.2, plaintext_3.2, m1.2, 
                    <'g'^~Y.1, 
                     decxor(<psk_id(~id_r.1), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                             'salt_3e2m',
                                                             hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                   wrap(hash(<wrap(method.2), 
                                                                              wrap(suitesI.2), wrap(G_X.2), 
                                                                              wrap(C_I.2), 
                                                                              wrap(ID_CRED_PSK_I.1), EAD_1.2
                                                                             >))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk.1)),
                                       'mac_2',
                                       <~id_r.1, ID_CRED_PSK_I.1, 
                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                         wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >), 
                                        psk_cred(~psk.1), ~EAD_2.2>,
                                       edhoc_mac_length), 
                             ~EAD_2.2>,
                            edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                       wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >),
                                      plaintext_length)), 
                     ~id_r.1>, 
                    m3.2>
  )
  ]->
   [
   State_11111111111111211111111111121211111111111121( ~EAD_4.1, ~Y.1,
                                                       ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2,
                                                       C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                                       plaintext_3.2, suitesI.2
   ),
   State_111111111111112111111111111212111111111111111( ~EAD_4.1, ~Y.1,
                                                        ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2,
                                                        C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                                        plaintext_3.2, suitesI.2
   ),
   Out( aeadenc(~EAD_4.1, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'k_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >)), 
                                           <psk_id(~id_r.1), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                  wrap(hash(<wrap(method.2), 
                                                                                             wrap(suitesI.2), 
                                                                                             wrap(G_X.2), 
                                                                                             wrap(C_I.2), 
                                                                                             wrap(ID_CRED_PSK_I.1), 
                                                                                             EAD_1.2>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.1)),
                                                      'mac_2',
                                                      <~id_r.1, ID_CRED_PSK_I.1, 
                                                       hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                             wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                        wrap(G_X.2), wrap(C_I.2), 
                                                                        wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                            >), 
                                                       psk_cred(~psk.1), ~EAD_2.2>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.2>, 
                                           psk_cred(~psk.1)>)), 
                                plaintext_3.2, psk_cred(~psk.1)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.1)),
                          'iv_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                      wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                 wrap(G_X.2), wrap(C_I.2), 
                                                                 wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                     >)), 
                                           <psk_id(~id_r.1), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                                  wrap(hash(<wrap(method.2), 
                                                                                             wrap(suitesI.2), 
                                                                                             wrap(G_X.2), 
                                                                                             wrap(C_I.2), 
                                                                                             wrap(ID_CRED_PSK_I.1), 
                                                                                             EAD_1.2>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.1)),
                                                      'mac_2',
                                                      <~id_r.1, ID_CRED_PSK_I.1, 
                                                       hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                             wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                        wrap(G_X.2), wrap(C_I.2), 
                                                                        wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                            >), 
                                                       psk_cred(~psk.1), ~EAD_2.2>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.2>, 
                                           psk_cred(~psk.1)>)), 
                                plaintext_3.2, psk_cred(~psk.1)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_11111111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.2^~Y.1),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.1)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                       wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                  wrap(G_X.2), wrap(C_I.2), 
                                                                  wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                      >)), 
                                            <psk_id(~id_r.1), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.2^~Y.1),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.1), 
                                                                                   ~id_r.1, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.2), 
                                                                                              wrap(suitesI.2), 
                                                                                              wrap(G_X.2), 
                                                                                              wrap(C_I.2), 
                                                                                              wrap(ID_CRED_PSK_I.1), 
                                                                                              EAD_1.2
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.1)),
                                                       'mac_2',
                                                       <~id_r.1, ID_CRED_PSK_I.1, 
                                                        hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                              wrap(hash(<wrap(method.2), 
                                                                         wrap(suitesI.2), 
                                                                         wrap(G_X.2), wrap(C_I.2), 
                                                                         wrap(ID_CRED_PSK_I.1), 
                                                                         EAD_1.2>))
                                                             >), 
                                                        psk_cred(~psk.1), ~EAD_2.2>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.2>, 
                                            psk_cred(~psk.1)>)), 
                                 plaintext_3.2, psk_cred(~psk.1)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.1, psk_id(~id_r.1), ~Y.1, G_X.2,
                 <
                  hash(<wrap('g'^~Y.1), ~id_r.1, 
                        wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                   wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                   wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                              wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                  >)), 
                        <psk_id(~id_r.1), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                               wrap(hash(<wrap(method.2), 
                                                                          wrap(suitesI.2), 
                                                                          wrap(G_X.2), wrap(C_I.2), 
                                                                          wrap(ID_CRED_PSK_I.1), 
                                                                          EAD_1.2>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.1)),
                                   'mac_2',
                                   <~id_r.1, ID_CRED_PSK_I.1, 
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >), 
                                    psk_cred(~psk.1), ~EAD_2.2>,
                                   edhoc_mac_length), 
                         ~EAD_2.2>, 
                        psk_cred(~psk.1)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.1), ~id_r.1, 
                                              wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                         wrap(G_X.2), wrap(C_I.2), 
                                                         wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                             >)), 
                                   <psk_id(~id_r.1), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                          wrap(hash(<
                                                                                     wrap(method.2), 
                                                                                     wrap(suitesI.2), 
                                                                                     wrap(G_X.2), 
                                                                                     wrap(C_I.2), 
                                                                                     wrap(ID_CRED_PSK_I.1), 
                                                                                     EAD_1.2>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.1)),
                                              'mac_2',
                                              <~id_r.1, ID_CRED_PSK_I.1, 
                                               hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                     wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                                wrap(G_X.2), wrap(C_I.2), 
                                                                wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                                    >), 
                                               psk_cred(~psk.1), ~EAD_2.2>,
                                              edhoc_mac_length), 
                                    ~EAD_2.2>, 
                                   psk_cred(~psk.1)>)), 
                        plaintext_3.2, psk_cred(~psk.1)>), 
                  suitesI.2, EAD_1.2, ~EAD_2.2, plaintext_3.2, m1.2, 
                  <'g'^~Y.1, 
                   decxor(<psk_id(~id_r.1), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.2^~Y.1),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.1), ~id_r.1, 
                                                                 wrap(hash(<wrap(method.2), 
                                                                            wrap(suitesI.2), 
                                                                            wrap(G_X.2), 
                                                                            wrap(C_I.2), 
                                                                            wrap(ID_CRED_PSK_I.1), 
                                                                            EAD_1.2>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.1)),
                                     'mac_2',
                                     <~id_r.1, ID_CRED_PSK_I.1, 
                                      hash(<wrap('g'^~Y.1), ~id_r.1, 
                                            wrap(hash(<wrap(method.2), wrap(suitesI.2), 
                                                       wrap(G_X.2), wrap(C_I.2), 
                                                       wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                           >), 
                                      psk_cred(~psk.1), ~EAD_2.2>,
                                     edhoc_mac_length), 
                           ~EAD_2.2>,
                          edhoc_kdf(hkdfextract('null', G_X.2^~Y.1), 'keystream_2',
                                    hash(<wrap('g'^~Y.1), ~id_r.1, 
                                          wrap(hash(<wrap(method.2), wrap(suitesI.2), wrap(G_X.2), 
                                                     wrap(C_I.2), wrap(ID_CRED_PSK_I.1), EAD_1.2>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.1>, 
                  m3.2>
);"]:
     [
     State_11111111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1,
                                                      m3, method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >)), 
                                                <psk_id(~id_r), 
                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                 'salt_3e2m',
                                                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                                                       wrap(hash(<
                                                                                                  wrap(method), 
                                                                                                  wrap(suitesI), 
                                                                                                  wrap(G_X), 
                                                                                                  wrap(C_I), 
                                                                                                  wrap(ID_CRED_PSK_I), 
                                                                                                  EAD_1>))
                                                                                      >),
                                                                                 hash_length),
                                                                       psk_cred(~psk)),
                                                           'mac_2',
                                                           <~id_r, ID_CRED_PSK_I, 
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >), 
                                                            psk_cred(~psk), ~EAD_2>,
                                                           edhoc_mac_length), 
                                                 ~EAD_2>, 
                                                psk_cred(~psk)>)), 
                                     plaintext_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r), ~Y, G_X,
                     <
                      hash(<wrap('g'^~Y), ~id_r, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                       wrap(ID_CRED_PSK_I), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                  wrap(ID_CRED_PSK_I), EAD_1>))
                                      >)), 
                            <psk_id(~id_r), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk)),
                                       'mac_2',
                                       <~id_r, ID_CRED_PSK_I, 
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >), 
                                        psk_cred(~psk), ~EAD_2>,
                                       edhoc_mac_length), 
                             ~EAD_2>, 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                             wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                 >)), 
                                       <psk_id(~id_r), 
                                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                                              wrap(hash(<wrap(method), 
                                                                                         wrap(suitesI), 
                                                                                         wrap(G_X), 
                                                                                         wrap(C_I), 
                                                                                         wrap(ID_CRED_PSK_I), 
                                                                                         EAD_1>))
                                                                             >),
                                                                        hash_length),
                                                              psk_cred(~psk)),
                                                  'mac_2',
                                                  <~id_r, ID_CRED_PSK_I, 
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >), 
                                                   psk_cred(~psk), ~EAD_2>,
                                                  edhoc_mac_length), 
                                        ~EAD_2>, 
                                       psk_cred(~psk)>)), 
                            plaintext_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, ~EAD_2, plaintext_3, m1, 
                      <'g'^~Y, 
                       decxor(<psk_id(~id_r), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                               hash(<wrap('g'^~Y), ~id_r, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap(G_X), wrap(C_I), 
                                                                                wrap(ID_CRED_PSK_I), EAD_1>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk)),
                                         'mac_2',
                                         <~id_r, ID_CRED_PSK_I, 
                                          hash(<wrap('g'^~Y), ~id_r, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                               >), 
                                          psk_cred(~psk), ~EAD_2>,
                                         edhoc_mac_length), 
                               ~EAD_2>,
                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        plaintext_length)), 
                       ~id_r>, 
                      m3>
    )
    ]->
     [
     State_11111111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     ),
     State_111111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                          ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                          m1, m3, method, plaintext_3, suitesI
     ),
     Out( aeadenc(~EAD_4, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.30
       G_X   = G_X.38
       z     = G_X.38^~Y.30
    
    2. ~Y    = ~Y.38
       G_X   = z.54^inv(~Y.38)
       z     = z.54
    
    3. ~Y    = ~Y.304
       G_X   = x.602^x.603
       z     = x.602^(~Y.304*x.603)
    
    4. ~Y    = ~Y.312
       G_X   = x.618^inv((~Y.312*x.619))
       z     = x.618^inv(x.619)
    
    5. ~Y    = ~Y.312
       G_X   = x.618^(x.619*inv(~Y.312))
       z     = x.618^x.619
    
    6. ~Y    = ~Y.313
       G_X   = x.619^(x.620*inv((~Y.313*x.621)))
       z     = x.619^(x.620*inv(x.621))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_11111111111111211111111111121211111111111121[color=#408072,
                                                                                       process="event LeakSessionKey( 'null' );"]:
   [
   State_11111111111111211111111111121211111111111121( ~EAD_4.1, ~Y.1,
                                                       ~id_i.1, ~id_r.1, ~psk.1, ID_CRED_PSK_I.1, ~EAD_2.2,
                                                       C_I.2, EAD_1.2, G_X.2, m1.2, m3.2, method.2,
                                                       plaintext_3.2, suitesI.2
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_11111111111111211111111111121211111111111121[color=#408072,
                                                                                          process="event LeakSessionKey( 'null' );"]:
     [
     State_11111111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventPSKGeneratedpsk_0_111111111111[color=#638040,
                                                    process="event PSKGenerated( ~psk.1 );"]:
   [ State_111111111111( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ PSKGenerated( ~psk.1 ) ]->
   [
   State_1111111111111121( ~id_i.1, ~id_r.1, ~psk.1 ),
   State_1111111111111111( ~id_i.1, ~id_r.1, ~psk.1 ),
   State_11111111111112( ~id_i.1, ~id_r.1, ~psk.1 )
   ]

  /*
  rule (modulo AC) eventPSKGeneratedpsk_0_111111111111[color=#638040,
                                                       process="event PSKGenerated( ~psk.1 );"]:
     [ State_111111111111( ~id_i, ~id_r, ~psk ) ]
    --[ PSKGenerated( ~psk ) ]->
     [
     State_1111111111111121( ~id_i, ~id_r, ~psk ),
     State_1111111111111111( ~id_i, ~id_r, ~psk ),
     State_11111111111112( ~id_i, ~id_r, ~psk )
     ]
  */

rule (modulo E) eventCompromisePSKpsk_0_11111111111112[color=#638040,
                                                       process="event CompromisePSK( ~psk.1 );"]:
   [ State_11111111111112( ~id_i.1, ~id_r.1, ~psk.1 ) ]
  --[ CompromisePSK( ~psk.1 ) ]->
   [ Out( ~psk.1 ) ]

  /*
  rule (modulo AC) eventCompromisePSKpsk_0_11111111111112[color=#638040,
                                                          process="event CompromisePSK( ~psk.1 );"]:
     [ State_11111111111112( ~id_i, ~id_r, ~psk ) ]
    --[ CompromisePSK( ~psk ) ]->
     [ Out( ~psk ) ]
  */

rule (modulo E) newpsk_0_1121[color=#40804e, process="new ~psk.2;"]:
   [ State_1121( ), Fr( ~psk.2 ), Fr( ~id_i.2 ), Fr( ~id_r.2 ) ]
  --[ PSKEstablished( ~psk.2, ~id_i.2, ~id_r.2 ) ]->
   [ State_11211111( ~id_i.2, ~id_r.2, ~psk.2 ) ]

  /*
  rule (modulo AC) newpsk_0_1121[color=#40804e, process="new ~psk.2;"]:
     [ State_1121( ), Fr( ~psk ), Fr( ~id_i ), Fr( ~id_r ) ]
    --[ PSKEstablished( ~psk, ~id_i, ~id_r ) ]->
     [ State_11211111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididi_0_11211111[color=#638040,
                                                  process="event HonestPSK( psk_id(~id_i.2) );"]:
   [ State_11211111( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ HonestPSK( psk_id(~id_i.2) ) ]->
   [ State_112111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididi_0_11211111[color=#638040,
                                                     process="event HonestPSK( psk_id(~id_i.2) );"]:
     [ State_11211111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_i) ) ]->
     [ State_112111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididr_0_112111111[color=#638040,
                                                   process="event HonestPSK( psk_id(~id_r.2) );"]:
   [ State_112111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ HonestPSK( psk_id(~id_r.2) ) ]->
   [ State_1121111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididr_0_112111111[color=#638040,
                                                      process="event HonestPSK( psk_id(~id_r.2) );"]:
     [ State_112111111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_r) ) ]->
     [ State_1121111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididi_0_1121111111[color=#638040,
                                                 process="event Honest( psk_id(~id_i.2) );"]:
   [ State_1121111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ Honest( psk_id(~id_i.2) ) ]->
   [ State_11211111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]

  /*
  rule (modulo AC) eventHonestpskididi_0_1121111111[color=#638040,
                                                    process="event Honest( psk_id(~id_i.2) );"]:
     [ State_1121111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_i) ) ]->
     [ State_11211111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididr_0_11211111111[color=#638040,
                                                  process="event Honest( psk_id(~id_r.2) );"]:
   [ State_11211111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ Honest( psk_id(~id_r.2) ) ]->
   [ State_112111111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]

  /*
  rule (modulo AC) eventHonestpskididr_0_11211111111[color=#638040,
                                                     process="event Honest( psk_id(~id_r.2) );"]:
     [ State_11211111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_r) ) ]->
     [ State_112111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) inmethodsuitesICIEAD_0_1121111111111111[color=#40805e,
                                                        process="in(<method.3, suitesI.3, C_I.3, EAD_1.3>);"]:
   [
   State_1121111111111111( ~id_i.2, ~id_r.2, ~psk.2 ),
   In( <method.3, suitesI.3, C_I.3, EAD_1.3> )
   ]
  --[ MethodOk( method.3 ) ]->
   [
   State_112111111111111111( ~id_i.2, ~id_r.2, ~psk.2, C_I.3, EAD_1.3,
                             method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) inmethodsuitesICIEAD_0_1121111111111111[color=#40805e,
                                                           process="in(<method.3, suitesI.3, C_I.3, EAD_1.3>);"]:
     [
     State_1121111111111111( ~id_i, ~id_r, ~psk ),
     In( <method, suitesI, C_I, EAD_1> )
     ]
    --[ MethodOk( method ) ]->
     [
     State_112111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_112111111111111111[color=#408056,
                                                                   process="event Eq( method.3, method_psk_variant1 );"]:
   [
   State_112111111111111111( ~id_i.2, ~id_r.2, ~psk.2, C_I.3, EAD_1.3,
                             method.3, suitesI.3
   )
   ]
  --[ Eq( method.3, method_psk_variant1 ) ]->
   [
   State_1121111111111111111( ~id_i.2, ~id_r.2, ~psk.2, C_I.3, EAD_1.3,
                              method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_112111111111111111[color=#408056,
                                                                      process="event Eq( method.3, method_psk_variant1 );"]:
     [
     State_112111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_1121111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method,
                                suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_1121111111111111111111111[color=#408056,
                                                               process="event LeakShare( 'null' );"]:
   [
   State_1121111111111111111111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                    ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_1121111111111111111111111[color=#408056,
                                                                  process="event LeakShare( 'null' );"]:
     [
     State_1121111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifmethodmethodpskvariant_0_1121111111111111111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_1121111111111111111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_1121111111111111111[color=#408056,
                                                               process="if method.3 = method_psk_variant1"]:
   [
   State_1121111111111111111( ~id_i.2, ~id_r.2, ~psk.2, C_I.3, EAD_1.3,
                              method.3, suitesI.3
   ),
   Fr( ~X.2 ), Fr( ~EAD_3.2 )
   ]
  --[
  Share( ~X.2 ),
  Restr_ifmethodmethodpskvariant_0_1121111111111111111_1( method.3 )
  ]->
   [
   State_1121111111111111111111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                    ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   ),
   State_112111111111111111111112( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2, ~psk.2,
                                   C_I.3, EAD_1.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_1121111111111111111[color=#408056,
                                                                  process="if method.3 = method_psk_variant1"]:
     [
     State_1121111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method,
                                suitesI
     ),
     Fr( ~X ), Fr( ~EAD_3 )
     ]
    --[
    Share( ~X ),
    Restr_ifmethodmethodpskvariant_0_1121111111111111111_1( method )
    ]->
     [
     State_1121111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     ),
     State_112111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventInitiatorStartPSKidipskpskididi_0_112111111111111111111112[color=#408056,
                                                                                process="event InitiatorStart_PSK( ~id_i.2, ~psk.2, psk_id(~id_i.2) );"]:
   [
   State_112111111111111111111112( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2, ~psk.2,
                                   C_I.3, EAD_1.3, method.3, suitesI.3
   )
   ]
  --[ InitiatorStart_PSK( ~id_i.2, ~psk.2, psk_id(~id_i.2) ) ]->
   [
   State_1121111111111111111111121( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                    ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventInitiatorStartPSKidipskpskididi_0_112111111111111111111112[color=#408056,
                                                                                   process="event InitiatorStart_PSK( ~id_i.2, ~psk.2, psk_id(~id_i.2) );"]:
     [
     State_112111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
    --[ InitiatorStart_PSK( ~id_i, ~psk, psk_id(~id_i) ) ]->
     [
     State_1121111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididigrpid_0_1121111111111111111111121[color=#408056,
                                                                  process="event Neq( psk_id(~id_i.2), grpid );"]:
   [
   State_1121111111111111111111121( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                    ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   )
   ]
  --[ Neq( psk_id(~id_i.2), grpid ) ]->
   [
   State_112111111111111111111112111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                      ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   ),
   Out( <method.3, suitesI.3, 'g'^~X.2, C_I.3, psk_id(~id_i.2), EAD_1.3> )
   ]

  /*
  rule (modulo AC) eventNeqpskididigrpid_0_1121111111111111111111121[color=#408056,
                                                                     process="event Neq( psk_id(~id_i.2), grpid );"]:
     [
     State_1121111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                      EAD_1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_i), grpid ) ]->
     [
     State_112111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                        EAD_1, method, suitesI
     ),
     Out( <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1> )
     ]
  */

rule (modulo E) inm_0_112111111111111111111112111[color=#408056,
                                                  process="in(m2.3);"]:
   [
   State_112111111111111111111112111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                      ~psk.2, C_I.3, EAD_1.3, method.3, suitesI.3
   ),
   In( m2.3 )
   ]
  -->
   [
   Let_11211111111111111111111211111( m2.3, ~EAD_3.2, ~X.2, ~id_i.2,
                                      ~id_r.2, ~psk.2, C_I.3, EAD_1.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) inm_0_112111111111111111111112111[color=#408056,
                                                     process="in(m2.3);"]:
     [
     State_112111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                        EAD_1, method, suitesI
     ),
     In( m2 )
     ]
    -->
     [
     Let_11211111111111111111111211111( m2, ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                        C_I, EAD_1, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letGYCIPHERTEXTCRm_1_1121111111111111111111121111[color=#ffffff,
                                                                  process="let <G_Y.3, CIPHERTEXT_2.3, C_R.3>=m2.3"]:
   [
   Let_11211111111111111111111211111( <G_Y.3, CIPHERTEXT_2.3, C_R.3>,
                                      ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2, ~psk.2, C_I.3, EAD_1.3, m2.3,
                                      method.3, suitesI.3
   )
   ]
  -->
   [
   State_11211111111111111111111211111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3, G_Y.3, m2.3, method.3,
                                        suitesI.3
   )
   ]

  /*
  rule (modulo AC) letGYCIPHERTEXTCRm_1_1121111111111111111111121111[color=#ffffff,
                                                                     process="let <G_Y.3, CIPHERTEXT_2.3, C_R.3>=m2.3"]:
     [
     Let_11211111111111111111111211111( <G_Y, CIPHERTEXT_2, C_R>, ~EAD_3, ~X,
                                        ~id_i, ~id_r, ~psk, C_I, EAD_1, m2, method, suitesI
     )
     ]
    -->
     [
     State_11211111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_11211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                          process="let <ID_CRED_PSK_R.2, MAC_2.3, EAD_2.3>=decxor(CIPHERTEXT_2.3,
       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                 hash(<wrap(G_Y.3), C_R.3, 
                       wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                  wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                      >),
                 plaintext_length))"]:
   [
   State_11211111111111111111111211111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3, G_Y.3, m2.3, method.3,
                                        suitesI.3
   )
   ]
  -->
   [
   Let_112111111111111111111112111111( decxor(CIPHERTEXT_2.3,
                                              edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                        hash(<wrap(G_Y.3), C_R.3, 
                                                              wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                         wrap('g'^~X.2), wrap(C_I.3), 
                                                                         wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                             >),
                                                        plaintext_length)),
                                       ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2, ~psk.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                       EAD_1.3, G_Y.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_11211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                             process="let <ID_CRED_PSK_R.2, MAC_2.3, EAD_2.3>=decxor(CIPHERTEXT_2.3,
       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                 hash(<wrap(G_Y.3), C_R.3, 
                       wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                  wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                      >),
                 plaintext_length))"]:
     [
     State_11211111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
    -->
     [
     Let_112111111111111111111112111111( decxor(CIPHERTEXT_2,
                                                edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                          hash(<wrap(G_Y), C_R, 
                                                                wrap(hash(<wrap(method), wrap(suitesI), 
                                                                           wrap('g'^~X), wrap(C_I), 
                                                                           wrap(psk_id(~id_i)), EAD_1>))
                                                               >),
                                                          plaintext_length)),
                                         ~EAD_3, ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y,
                                         m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.28
       G_Y   = G_Y.36
       z     = G_Y.36^~X.28
    
    2. ~X    = ~X.33
       G_Y   = z.46^inv(~X.33)
       z     = z.46
    
    3. ~X    = ~X.112
       G_Y   = x.217^x.218
       z     = x.217^(~X.112*x.218)
    
    4. ~X    = ~X.120
       G_Y   = x.233^inv((~X.120*x.234))
       z     = x.233^inv(x.234)
    
    5. ~X    = ~X.120
       G_Y   = x.233^(x.234*inv(~X.120))
       z     = x.233^x.234
    
    6. ~X    = ~X.121
       G_Y   = x.234^(x.235*inv((~X.121*x.236)))
       z     = x.234^(x.235*inv(x.236))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_11211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                          process="let <ID_CRED_PSK_R.2, MAC_2.3, EAD_2.3>=decxor(CIPHERTEXT_2.3,
       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                 hash(<wrap(G_Y.3), C_R.3, 
                       wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                  wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                      >),
                 plaintext_length))"]:
   [
   Let_112111111111111111111112111111( <ID_CRED_PSK_R.2, MAC_2.3, EAD_2.3>,
                                       ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2, ~psk.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                       EAD_1.3, G_Y.3, m2.3, method.3, suitesI.3
   )
   ]
  -->
   [
   State_112111111111111111111112111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                         ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3,
                                         EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_11211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                             process="let <ID_CRED_PSK_R.2, MAC_2.3, EAD_2.3>=decxor(CIPHERTEXT_2.3,
       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                 hash(<wrap(G_Y.3), C_R.3, 
                       wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                  wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                      >),
                 plaintext_length))"]:
     [
     Let_112111111111111111111112111111( <ID_CRED_PSK_R, MAC_2, EAD_2>,
                                         ~EAD_3, ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y,
                                         m2, method, suitesI
     )
     ]
    -->
     [
     State_112111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                           m2, method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGY_0_112111111111111111111112111111[color=#408056,
                                                                   process="event GroupCheck( G_Y.3 );"]:
   [
   State_112111111111111111111112111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                         ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3,
                                         EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[ GroupCheck( G_Y.3 ) ]->
   [
   State_1121111111111111111111121111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                          ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3,
                                          EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGY_0_112111111111111111111112111111[color=#408056,
                                                                      process="event GroupCheck( G_Y.3 );"]:
     [
     State_112111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                           m2, method, suitesI
     )
     ]
    --[ GroupCheck( G_Y ) ]->
     [
     State_1121111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                            m2, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGYgrpid_1_1121111111111111111111121111111_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGYgrpid_1_1121111111111111111111121111111_1( x
     ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGYgrpid_1_1121111111111111111111121111111[color=#408056,
                                                                    process="if check_grp(G_Y.3) = grpid"]:
   [
   State_1121111111111111111111121111111( ~EAD_3.2, ~X.2, ~id_i.2, ~id_r.2,
                                          ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3,
                                          EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[
  Eq( ID_CRED_PSK_R.2, ~id_r.2 ),
  Restr_ifcheckgrpGYgrpid_1_1121111111111111111111121111111_1( check_grp(G_Y.3)
  )
  ]->
   [
   State_112111111111111111111112111111121( ~EAD_3.2, ~X.2, ~id_i.2,
                                            ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                            EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGYgrpid_1_1121111111111111111111121111111[color=#408056,
                                                                       process="if check_grp(G_Y.3) = grpid"]:
     [
     State_1121111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                            m2, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_R, ~id_r ),
    Restr_ifcheckgrpGYgrpid_1_1121111111111111111111121111111_1( check_grp(G_Y)
    )
    ]->
     [
     State_112111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                              m2, method, suitesI
     )
     ]
  */

restriction Restr_ifIDCREDPSKRidr_0_112111111111111111111112111111121_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKRidr_0_112111111111111111111112111111121_1( x, x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKRidr_0_112111111111111111111112111111121[color=#408056,
                                                                    process="if ID_CRED_PSK_R.2 = ~id_r.2"]:
   [
   State_112111111111111111111112111111121( ~EAD_3.2, ~X.2, ~id_i.2,
                                            ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                            EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[
  DerivedIShared_PSK( ~id_i.2, psk_id(~id_i.2), ID_CRED_PSK_R.2,
                      hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                            hash(<wrap(G_Y.3), C_R.3, 
                                                  wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                             wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                 >),
                                            hash_length),
                                  psk_cred(~psk.2)),
                      ~X.2, G_Y.3
  ),
  Restr_ifIDCREDPSKRidr_0_112111111111111111111112111111121_1( ID_CRED_PSK_R.2,
                                                               ~id_r.2
  )
  ]->
   [
   State_11211111111111111111111211111112111( ~EAD_3.2, ~X.2, ~id_i.2,
                                              ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                              EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKRidr_0_112111111111111111111112111111121[color=#408056,
                                                                       process="if ID_CRED_PSK_R.2 = ~id_r.2"]:
     [
     State_112111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                              m2, method, suitesI
     )
     ]
    --[
    DerivedIShared_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                        hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                              hash(<wrap(G_Y), C_R, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                               wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk)),
                        ~X, G_Y
    ),
    Restr_ifIDCREDPSKRidr_0_112111111111111111111112111111121_1( ID_CRED_PSK_R,
                                                                 ~id_r
    )
    ]->
     [
     State_11211111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.33
       G_Y   = G_Y.43
       z     = G_Y.43^~X.33
    
    2. ~X    = ~X.39
       G_Y   = z.55^inv(~X.39)
       z     = z.55
    
    3. ~X    = ~X.130
       G_Y   = x.253^x.254
       z     = x.253^(~X.130*x.254)
    
    4. ~X    = ~X.140
       G_Y   = x.273^inv((~X.140*x.274))
       z     = x.273^inv(x.274)
    
    5. ~X    = ~X.140
       G_Y   = x.273^(x.274*inv(~X.140))
       z     = x.273^x.274
    
    6. ~X    = ~X.141
       G_Y   = x.274^(x.275*inv((~X.141*x.276)))
       z     = x.274^(x.275*inv(x.276))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_11211111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                        process="event Eq( MAC_2.3,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              'mac_2',
              <C_R.3, psk_id(~id_i.2), 
               hash(<wrap(G_Y.3), C_R.3, 
                     wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                    >), 
               psk_cred(~psk.2), EAD_2.3>,
              edhoc_mac_length)
);"]:
   [
   State_11211111111111111111111211111112111( ~EAD_3.2, ~X.2, ~id_i.2,
                                              ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                              EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[
  Eq( MAC_2.3,
      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                      'salt_3e2m',
                                      hash(<wrap(G_Y.3), C_R.3, 
                                            wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                       wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                'mac_2',
                <C_R.3, psk_id(~id_i.2), 
                 hash(<wrap(G_Y.3), C_R.3, 
                       wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), wrap(C_I.3), 
                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                      >), 
                 psk_cred(~psk.2), EAD_2.3>,
                edhoc_mac_length)
  )
  ]->
   [
   State_112111111111111111111112111111121111( ~EAD_3.2, ~X.2, ~id_i.2,
                                               ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                               EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_11211111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                           process="event Eq( MAC_2.3,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              'mac_2',
              <C_R.3, psk_id(~id_i.2), 
               hash(<wrap(G_Y.3), C_R.3, 
                     wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                    >), 
               psk_cred(~psk.2), EAD_2.3>,
              edhoc_mac_length)
);"]:
     [
     State_11211111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    Eq( MAC_2,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  'mac_2',
                  <C_R, psk_id(~id_i), 
                   hash(<wrap(G_Y), C_R, 
                         wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                    wrap(psk_id(~id_i)), EAD_1>))
                        >), 
                   psk_cred(~psk), EAD_2>,
                  edhoc_mac_length)
    )
    ]->
     [
     State_112111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                 ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                 G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.33
       G_Y   = G_Y.43
       z     = G_Y.43^~X.33
    
    2. ~X    = ~X.39
       G_Y   = z.55^inv(~X.39)
       z     = z.55
    
    3. ~X    = ~X.156
       G_Y   = x.305^x.306
       z     = x.305^(~X.156*x.306)
    
    4. ~X    = ~X.166
       G_Y   = x.325^inv((~X.166*x.326))
       z     = x.325^inv(x.326)
    
    5. ~X    = ~X.166
       G_Y   = x.325^(x.326*inv(~X.166))
       z     = x.325^x.326
    
    6. ~X    = ~X.167
       G_Y   = x.326^(x.327*inv((~X.167*x.328)))
       z     = x.326^(x.327*inv(x.328))
    
    7. G_Y   = grpid
       z     = grpid
  */

restriction Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111_1:
  "∀ x #NOW x.1.
    (Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111_1( x,
                                                                                                                                                                                                                                                                                                                  x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                    process="if MAC_2.3 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                'salt_3e2m',
                                hash(<wrap(G_Y.3), C_R.3, 
                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                 wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                     >),
                                hash_length),
                      psk_cred(~psk.2)),
          'mac_2',
          <C_R.3, psk_id(~id_i.2), 
           hash(<wrap(G_Y.3), C_R.3, 
                 wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                            wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                >), 
           psk_cred(~psk.2), EAD_2.3>,
          edhoc_mac_length)"]:
   [
   State_112111111111111111111112111111121111( ~EAD_3.2, ~X.2, ~id_i.2,
                                               ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3, C_R.3,
                                               EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[
  THIShared_PSK( psk_id(~id_i.2),
                 hash(<
                       wrap(hash(<wrap(G_Y.3), C_R.3, 
                                  wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), wrap(C_I.3), 
                                             wrap(psk_id(~id_i.2)), EAD_1.3>))
                                 >)), 
                       decxor(CIPHERTEXT_2.3,
                              edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                        hash(<wrap(G_Y.3), C_R.3, 
                                              wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                         wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                             >),
                                        plaintext_length)), 
                       psk_cred(~psk.2)>)
  ),
  Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111_1( MAC_2.3,
                                                                                                                                                                                                                                                                                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                           G_Y.3^~X.2),
                                                                                                                                                                                                                                                                                                                                               'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                               hash(<
                                                                                                                                                                                                                                                                                                                                                     wrap(G_Y.3), 
                                                                                                                                                                                                                                                                                                                                                     C_R.3, 
                                                                                                                                                                                                                                                                                                                                                     wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                                wrap(method.3), 
                                                                                                                                                                                                                                                                                                                                                                wrap(suitesI.3), 
                                                                                                                                                                                                                                                                                                                                                                wrap('g'^~X.2), 
                                                                                                                                                                                                                                                                                                                                                                wrap(C_I.3), 
                                                                                                                                                                                                                                                                                                                                                                wrap(psk_id(~id_i.2)), 
                                                                                                                                                                                                                                                                                                                                                                EAD_1.3
                                                                                                                                                                                                                                                                                                                                                               >))
                                                                                                                                                                                                                                                                                                                                                    >),
                                                                                                                                                                                                                                                                                                                                               hash_length),
                                                                                                                                                                                                                                                                                                                                     psk_cred(~psk.2)),
                                                                                                                                                                                                                                                                                                                         'mac_2',
                                                                                                                                                                                                                                                                                                                         <
                                                                                                                                                                                                                                                                                                                          C_R.3, 
                                                                                                                                                                                                                                                                                                                          psk_id(~id_i.2), 
                                                                                                                                                                                                                                                                                                                          hash(<
                                                                                                                                                                                                                                                                                                                                wrap(G_Y.3), 
                                                                                                                                                                                                                                                                                                                                C_R.3, 
                                                                                                                                                                                                                                                                                                                                wrap(hash(<
                                                                                                                                                                                                                                                                                                                                           wrap(method.3), 
                                                                                                                                                                                                                                                                                                                                           wrap(suitesI.3), 
                                                                                                                                                                                                                                                                                                                                           wrap('g'^~X.2), 
                                                                                                                                                                                                                                                                                                                                           wrap(C_I.3), 
                                                                                                                                                                                                                                                                                                                                           wrap(psk_id(~id_i.2)), 
                                                                                                                                                                                                                                                                                                                                           EAD_1.3
                                                                                                                                                                                                                                                                                                                                          >))
                                                                                                                                                                                                                                                                                                                               >), 
                                                                                                                                                                                                                                                                                                                          psk_cred(~psk.2), 
                                                                                                                                                                                                                                                                                                                          EAD_2.3
                                                                                                                                                                                                                                                                                                                         >,
                                                                                                                                                                                                                                                                                                                         edhoc_mac_length)
  )
  ]->
   [
   State_11211111111111111111111211111112111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                 ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                 C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                 suitesI.3
   )
   ]

  /*
  rule (modulo AC) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                       process="if MAC_2.3 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                'salt_3e2m',
                                hash(<wrap(G_Y.3), C_R.3, 
                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                 wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                     >),
                                hash_length),
                      psk_cred(~psk.2)),
          'mac_2',
          <C_R.3, psk_id(~id_i.2), 
           hash(<wrap(G_Y.3), C_R.3, 
                 wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                            wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                >), 
           psk_cred(~psk.2), EAD_2.3>,
          edhoc_mac_length)"]:
     [
     State_112111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                 ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                 G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    THIShared_PSK( psk_id(~id_i),
                   hash(<
                         wrap(hash(<wrap(G_Y), C_R, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                               wrap(psk_id(~id_i)), EAD_1>))
                                   >)), 
                         decxor(CIPHERTEXT_2,
                                edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                          hash(<wrap(G_Y), C_R, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                           wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                               >),
                                          plaintext_length)), 
                         psk_cred(~psk)>)
    ),
    Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_112111111111111111111112111111121111_1( MAC_2,
                                                                                                                                                                                                                                                                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                             z),
                                                                                                                                                                                                                                                                                                                                                 'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                                 hash(<
                                                                                                                                                                                                                                                                                                                                                       wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                                       C_R, 
                                                                                                                                                                                                                                                                                                                                                       wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                                  wrap(method), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                                                  wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                                                  wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                                                  EAD_1
                                                                                                                                                                                                                                                                                                                                                                 >))
                                                                                                                                                                                                                                                                                                                                                      >),
                                                                                                                                                                                                                                                                                                                                                 hash_length),
                                                                                                                                                                                                                                                                                                                                       psk_cred(~psk)),
                                                                                                                                                                                                                                                                                                                           'mac_2',
                                                                                                                                                                                                                                                                                                                           <
                                                                                                                                                                                                                                                                                                                            C_R, 
                                                                                                                                                                                                                                                                                                                            psk_id(~id_i), 
                                                                                                                                                                                                                                                                                                                            hash(<
                                                                                                                                                                                                                                                                                                                                  wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                  C_R, 
                                                                                                                                                                                                                                                                                                                                  wrap(hash(<
                                                                                                                                                                                                                                                                                                                                             wrap(method), 
                                                                                                                                                                                                                                                                                                                                             wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                             wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                             wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                             wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                             EAD_1
                                                                                                                                                                                                                                                                                                                                            >))
                                                                                                                                                                                                                                                                                                                                 >), 
                                                                                                                                                                                                                                                                                                                            psk_cred(~psk), 
                                                                                                                                                                                                                                                                                                                            EAD_2
                                                                                                                                                                                                                                                                                                                           >,
                                                                                                                                                                                                                                                                                                                           edhoc_mac_length)
    )
    ]->
     [
     State_11211111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                   G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.34
       G_Y   = G_Y.44
       z     = G_Y.44^~X.34
    
    2. ~X    = ~X.41
       G_Y   = z.58^inv(~X.41)
       z     = z.58
    
    3. ~X    = ~X.185
       G_Y   = x.363^x.364
       z     = x.363^(~X.185*x.364)
    
    4. ~X    = ~X.195
       G_Y   = x.383^inv((~X.195*x.384))
       z     = x.383^inv(x.384)
    
    5. ~X    = ~X.195
       G_Y   = x.383^(x.384*inv(~X.195))
       z     = x.383^x.384
    
    6. ~X    = ~X.196
       G_Y   = x.384^(x.385*inv((~X.196*x.386)))
       z     = x.384^(x.385*inv(x.386))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_11211111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event AcceptI_PSK( ~id_i.2, method_psk_variant1, psk_id(~id_i.2),
             ID_CRED_PSK_R.2,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                   hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                   hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.3), C_R.3, 
                                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                              wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.2)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                              wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.3,
                                               edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.3), C_R.3, 
                                                               wrap(hash(<wrap(method.3), 
                                                                          wrap(suitesI.3), 
                                                                          wrap('g'^~X.2), 
                                                                          wrap(C_I.3), 
                                                                          wrap(psk_id(~id_i.2)), 
                                                                          EAD_1.3>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.2)>)), 
                             ~EAD_3.2, psk_cred(~psk.2)>),
                       hash_length)
);"]:
   [
   State_11211111111111111111111211111112111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                 ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                 C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                 suitesI.3
   )
   ]
  --[
  AcceptI_PSK( ~id_i.2, method_psk_variant1, psk_id(~id_i.2),
               ID_CRED_PSK_R.2,
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                     hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.2)),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                     hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.2)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                               'salt_3e2m',
                                               hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.2)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.3,
                                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                           hash(<wrap(G_Y.3), C_R.3, 
                                                                 wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                            wrap('g'^~X.2), wrap(C_I.3), 
                                                                            wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.2)>)), 
                               ~EAD_3.2, psk_cred(~psk.2)>),
                         hash_length)
  )
  ]->
   [
   State_112111111111111111111112111111121111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                  ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                  C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                  suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_11211111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event AcceptI_PSK( ~id_i.2, method_psk_variant1, psk_id(~id_i.2),
             ID_CRED_PSK_R.2,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                   hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                   hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.3), C_R.3, 
                                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                              wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.2)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                              wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.3,
                                               edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.3), C_R.3, 
                                                               wrap(hash(<wrap(method.3), 
                                                                          wrap(suitesI.3), 
                                                                          wrap('g'^~X.2), 
                                                                          wrap(C_I.3), 
                                                                          wrap(psk_id(~id_i.2)), 
                                                                          EAD_1.3>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.2)>)), 
                             ~EAD_3.2, psk_cred(~psk.2)>),
                       hash_length)
);"]:
     [
     State_11211111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                   G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptI_PSK( ~id_i, method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R,
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2,
                                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                             hash(<wrap(G_Y), C_R, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap('g'^~X), wrap(C_I), 
                                                                              wrap(psk_id(~id_i)), EAD_1>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk)>)), 
                                 ~EAD_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_112111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                    G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.33
       G_Y   = G_Y.43
       z     = G_Y.43^~X.33
    
    2. ~X    = ~X.39
       G_Y   = z.55^inv(~X.39)
       z     = z.55
    
    3. ~X    = ~X.184
       G_Y   = x.361^x.362
       z     = x.361^(~X.184*x.362)
    
    4. ~X    = ~X.194
       G_Y   = x.381^inv((~X.194*x.382))
       z     = x.381^inv(x.382)
    
    5. ~X    = ~X.194
       G_Y   = x.381^(x.382*inv(~X.194))
       z     = x.381^x.382
    
    6. ~X    = ~X.195
       G_Y   = x.382^(x.383*inv((~X.195*x.384)))
       z     = x.382^(x.383*inv(x.384))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_112111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event SessionSecrets_I( ~id_i.2, ~X.2, G_Y.3,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.3), C_R.3, 
                                                        wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                   wrap('g'^~X.2), wrap(C_I.3), 
                                                                   wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.2)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                        wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                   wrap('g'^~X.2), wrap(C_I.3), 
                                                                   wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.3,
                                                    edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.3), C_R.3, 
                                                                    wrap(hash(<wrap(method.3), 
                                                                               wrap(suitesI.3), 
                                                                               wrap('g'^~X.2), 
                                                                               wrap(C_I.3), 
                                                                               wrap(psk_id(~id_i.2)), 
                                                                               EAD_1.3>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.2)>)), 
                                  ~EAD_3.2, psk_cred(~psk.2)>),
                            hash_length)
);"]:
   [
   State_112111111111111111111112111111121111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                  ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                  C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                  suitesI.3
   )
   ]
  --[
  SessionSecrets_I( ~id_i.2, ~X.2, G_Y.3,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                    'salt_3e2m',
                                                    hash(<wrap(G_Y.3), C_R.3, 
                                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.2)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                         >)), 
                                               decxor(CIPHERTEXT_2.3,
                                                      edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                                'keystream_2',
                                                                hash(<wrap(G_Y.3), C_R.3, 
                                                                      wrap(hash(<wrap(method.3), 
                                                                                 wrap(suitesI.3), 
                                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                                 wrap(psk_id(~id_i.2)), 
                                                                                 EAD_1.3>))
                                                                     >),
                                                                plaintext_length)), 
                                               psk_cred(~psk.2)>)), 
                                    ~EAD_3.2, psk_cred(~psk.2)>),
                              hash_length)
  )
  ]->
   [
   State_1121111111111111111111121111111211111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                   ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                   C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                   suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_112111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event SessionSecrets_I( ~id_i.2, ~X.2, G_Y.3,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.3), C_R.3, 
                                                        wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                   wrap('g'^~X.2), wrap(C_I.3), 
                                                                   wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.2)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                        wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                   wrap('g'^~X.2), wrap(C_I.3), 
                                                                   wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.3,
                                                    edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.3), C_R.3, 
                                                                    wrap(hash(<wrap(method.3), 
                                                                               wrap(suitesI.3), 
                                                                               wrap('g'^~X.2), 
                                                                               wrap(C_I.3), 
                                                                               wrap(psk_id(~id_i.2)), 
                                                                               EAD_1.3>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.2)>)), 
                                  ~EAD_3.2, psk_cred(~psk.2)>),
                            hash_length)
);"]:
     [
     State_112111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                    G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SessionSecrets_I( ~id_i, ~X, G_Y,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >)), 
                                                 decxor(CIPHERTEXT_2,
                                                        edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                  hash(<wrap(G_Y), C_R, 
                                                                        wrap(hash(<wrap(method), 
                                                                                   wrap(suitesI), 
                                                                                   wrap('g'^~X), wrap(C_I), 
                                                                                   wrap(psk_id(~id_i)), EAD_1
                                                                                  >))
                                                                       >),
                                                                  plaintext_length)), 
                                                 psk_cred(~psk)>)), 
                                      ~EAD_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_1121111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1,
                                                     EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.33
       G_Y   = G_Y.43
       z     = G_Y.43^~X.33
    
    2. ~X    = ~X.39
       G_Y   = z.55^inv(~X.39)
       z     = z.55
    
    3. ~X    = ~X.184
       G_Y   = x.361^x.362
       z     = x.361^(~X.184*x.362)
    
    4. ~X    = ~X.194
       G_Y   = x.381^inv((~X.194*x.382))
       z     = x.381^inv(x.382)
    
    5. ~X    = ~X.194
       G_Y   = x.381^(x.382*inv(~X.194))
       z     = x.381^x.382
    
    6. ~X    = ~X.195
       G_Y   = x.382^(x.383*inv((~X.195*x.384)))
       z     = x.382^(x.383*inv(x.384))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_1121111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event SecretsI_PSK( ~id_i.2, psk_id(~id_i.2), ID_CRED_PSK_R.2,
              hkdfextract('null', G_Y.3^~X.2),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.3,
                                                edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.2)>)), 
                              ~EAD_3.2, psk_cred(~psk.2)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                        hash(<wrap(G_Y.3), C_R.3, 
                              wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                         wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >)), 
                              decxor(CIPHERTEXT_2.3,
                                     edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                               hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.2)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >)), 
                              decxor(CIPHERTEXT_2.3,
                                     edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                               hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.2)>),
                        iv_length),
              ~X.2, G_Y.3
);"]:
   [
   State_1121111111111111111111121111111211111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                   ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                   C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                   suitesI.3
   )
   ]
  --[
  SecretsI_PSK( ~id_i.2, psk_id(~id_i.2), ID_CRED_PSK_R.2,
                hkdfextract('null', G_Y.3^~X.2),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                      hash(<wrap(G_Y.3), C_R.3, 
                                            wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                       wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                      hash(<wrap(G_Y.3), C_R.3, 
                                            wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                       wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >)), 
                                           decxor(CIPHERTEXT_2.3,
                                                  edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                            hash(<wrap(G_Y.3), C_R.3, 
                                                                  wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                             wrap('g'^~X.2), wrap(C_I.3), 
                                                                             wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                                 >),
                                                            plaintext_length)), 
                                           psk_cred(~psk.2)>)), 
                                ~EAD_3.2, psk_cred(~psk.2)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                          hash(<wrap(G_Y.3), C_R.3, 
                                wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), wrap(C_I.3), 
                                           wrap(psk_id(~id_i.2)), EAD_1.3>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >)), 
                                decxor(CIPHERTEXT_2.3,
                                       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.2)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >)), 
                                decxor(CIPHERTEXT_2.3,
                                       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.2)>),
                          iv_length),
                ~X.2, G_Y.3
  )
  ]->
   [
   State_11211111111111111111111211111112111111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                    ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                    C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                    suitesI.3
   )
   ]

  /*
  rule (modulo AC) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_1121111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SecretsI_PSK( ~id_i.2, psk_id(~id_i.2), ID_CRED_PSK_R.2,
              hkdfextract('null', G_Y.3^~X.2),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'salt_3e2m',
                                    hash(<wrap(G_Y.3), C_R.3, 
                                          wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.3,
                                                edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.2)>)), 
                              ~EAD_3.2, psk_cred(~psk.2)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                        hash(<wrap(G_Y.3), C_R.3, 
                              wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                         wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >)), 
                              decxor(CIPHERTEXT_2.3,
                                     edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                               hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.2)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.3), C_R.3, 
                                                    wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                               wrap('g'^~X.2), wrap(C_I.3), 
                                                               wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.3), C_R.3, 
                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                        >)), 
                              decxor(CIPHERTEXT_2.3,
                                     edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                               hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.2)>),
                        iv_length),
              ~X.2, G_Y.3
);"]:
     [
     State_1121111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1,
                                                     EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SecretsI_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2,
                                                    edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk)>)), 
                                  ~EAD_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap(G_Y), C_R, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                             wrap(psk_id(~id_i)), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~X, G_Y
    )
    ]->
     [
     State_11211111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                      EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.33
       G_Y   = G_Y.43
       z     = G_Y.43^~X.33
    
    2. ~X    = ~X.39
       G_Y   = z.55^inv(~X.39)
       z     = z.55
    
    3. ~X    = ~X.246
       G_Y   = x.485^x.486
       z     = x.485^(~X.246*x.486)
    
    4. ~X    = ~X.256
       G_Y   = x.505^inv((~X.256*x.506))
       z     = x.505^inv(x.506)
    
    5. ~X    = ~X.256
       G_Y   = x.505^(x.506*inv(~X.256))
       z     = x.505^x.506
    
    6. ~X    = ~X.257
       G_Y   = x.506^(x.507*inv((~X.257*x.508)))
       z     = x.506^(x.507*inv(x.508))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_11211111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.3^~X.2),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.2)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.3,
                                                   edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.3), C_R.3, 
                                                                   wrap(hash(<wrap(method.3), 
                                                                              wrap(suitesI.3), 
                                                                              wrap('g'^~X.2), 
                                                                              wrap(C_I.3), 
                                                                              wrap(psk_id(~id_i.2)), 
                                                                              EAD_1.3>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.2)>)), 
                                 ~EAD_3.2, psk_cred(~psk.2)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.2), ID_CRED_PSK_R.2, ~X.2, G_Y.3,
                 <
                  hash(<wrap(G_Y.3), C_R.3, 
                        wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                   wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.3), C_R.3, 
                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                              wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                  >)), 
                        decxor(CIPHERTEXT_2.3,
                               edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                         hash(<wrap(G_Y.3), C_R.3, 
                                               wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                          wrap('g'^~X.2), wrap(C_I.3), 
                                                          wrap(psk_id(~id_i.2)), EAD_1.3>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.2)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.3), C_R.3, 
                                              wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                         wrap('g'^~X.2), wrap(C_I.3), 
                                                         wrap(psk_id(~id_i.2)), EAD_1.3>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.3,
                                          edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                    hash(<wrap(G_Y.3), C_R.3, 
                                                          wrap(hash(<wrap(method.3), 
                                                                     wrap(suitesI.3), 
                                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                                     wrap(psk_id(~id_i.2)), EAD_1.3
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.2)>)), 
                        ~EAD_3.2, psk_cred(~psk.2)>), 
                  suitesI.3, EAD_1.3, EAD_2.3, ~EAD_3.2, 
                  <method.3, suitesI.3, 'g'^~X.2, C_I.3, psk_id(~id_i.2), EAD_1.3>, 
                  m2.3, 
                  aeadenc(~EAD_3.2, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.2)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.3,
                                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.3), C_R.3, 
                                                                 wrap(hash(<wrap(method.3), 
                                                                            wrap(suitesI.3), 
                                                                            wrap('g'^~X.2), 
                                                                            wrap(C_I.3), 
                                                                            wrap(psk_id(~id_i.2)), 
                                                                            EAD_1.3>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.2)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.2)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.3,
                                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.3), C_R.3, 
                                                                 wrap(hash(<wrap(method.3), 
                                                                            wrap(suitesI.3), 
                                                                            wrap('g'^~X.2), 
                                                                            wrap(C_I.3), 
                                                                            wrap(psk_id(~id_i.2)), 
                                                                            EAD_1.3>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.2)>),
                                    iv_length))
                 >
);"]:
   [
   State_11211111111111111111111211111112111111111( ~EAD_3.2, ~X.2, ~id_i.2,
                                                    ~id_r.2, ~psk.2, ID_CRED_PSK_R.2, CIPHERTEXT_2.3, C_I.3,
                                                    C_R.3, EAD_1.3, EAD_2.3, G_Y.3, MAC_2.3, m2.3, method.3,
                                                    suitesI.3
   )
   ]
  --[
  AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_Y.3^~X.2),
                                                   'salt_3e2m',
                                                   hash(<wrap(G_Y.3), C_R.3, 
                                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.2)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                         wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                    wrap('g'^~X.2), wrap(C_I.3), 
                                                                    wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2.3,
                                                     edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                               hash(<wrap(G_Y.3), C_R.3, 
                                                                     wrap(hash(<wrap(method.3), 
                                                                                wrap(suitesI.3), 
                                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                                wrap(psk_id(~id_i.2)), EAD_1.3
                                                                               >))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk.2)>)), 
                                   ~EAD_3.2, psk_cred(~psk.2)>),
                             hash_length),
                   method_psk_variant1, psk_id(~id_i.2), ID_CRED_PSK_R.2, ~X.2, G_Y.3,
                   <
                    hash(<wrap(G_Y.3), C_R.3, 
                          wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), wrap(C_I.3), 
                                     wrap(psk_id(~id_i.2)), EAD_1.3>))
                         >), 
                    hash(<
                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), wrap(C_I.3), 
                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                    >)), 
                          decxor(CIPHERTEXT_2.3,
                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                           hash(<wrap(G_Y.3), C_R.3, 
                                                 wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                            wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                >),
                                           plaintext_length)), 
                          psk_cred(~psk.2)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                           wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                               >)), 
                                     decxor(CIPHERTEXT_2.3,
                                            edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                      hash(<wrap(G_Y.3), C_R.3, 
                                                            wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                       wrap('g'^~X.2), wrap(C_I.3), 
                                                                       wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                           >),
                                                      plaintext_length)), 
                                     psk_cred(~psk.2)>)), 
                          ~EAD_3.2, psk_cred(~psk.2)>), 
                    suitesI.3, EAD_1.3, EAD_2.3, ~EAD_3.2, 
                    <method.3, suitesI.3, 'g'^~X.2, C_I.3, psk_id(~id_i.2), EAD_1.3>, m2.3, 
                    aeadenc(~EAD_3.2, 'rep',
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.3), C_R.3, 
                                                                  wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                             wrap('g'^~X.2), wrap(C_I.3), 
                                                                             wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.2)),
                                      'k_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.3,
                                                   edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                             hash(<wrap(G_Y.3), C_R.3, 
                                                                   wrap(hash(<wrap(method.3), 
                                                                              wrap(suitesI.3), 
                                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                                              wrap(psk_id(~id_i.2)), EAD_1.3
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.2)>),
                                      key_length),
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.3), C_R.3, 
                                                                  wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                             wrap('g'^~X.2), wrap(C_I.3), 
                                                                             wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.2)),
                                      'iv_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.3,
                                                   edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                             hash(<wrap(G_Y.3), C_R.3, 
                                                                   wrap(hash(<wrap(method.3), 
                                                                              wrap(suitesI.3), 
                                                                              wrap('g'^~X.2), wrap(C_I.3), 
                                                                              wrap(psk_id(~id_i.2)), EAD_1.3
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.2)>),
                                      iv_length))
                   >
  )
  ]->
   [
   State_11211111111111111111111211111112111111111111( ~EAD_3.2, ~X.2,
                                                       ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_R.2,
                                                       CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3, EAD_2.3, G_Y.3,
                                                       MAC_2.3, m2.3, method.3, suitesI.3
   ),
   Out( aeadenc(~EAD_3.2, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >)), 
                                decxor(CIPHERTEXT_2.3,
                                       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.2)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.3), C_R.3, 
                                                      wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                 wrap('g'^~X.2), wrap(C_I.3), 
                                                                 wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.3), C_R.3, 
                                           wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                                      wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                          >)), 
                                decxor(CIPHERTEXT_2.3,
                                       edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.2)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_11211111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.3^~X.2),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.2)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                       wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                  wrap('g'^~X.2), wrap(C_I.3), 
                                                                  wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.3,
                                                   edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.3), C_R.3, 
                                                                   wrap(hash(<wrap(method.3), 
                                                                              wrap(suitesI.3), 
                                                                              wrap('g'^~X.2), 
                                                                              wrap(C_I.3), 
                                                                              wrap(psk_id(~id_i.2)), 
                                                                              EAD_1.3>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.2)>)), 
                                 ~EAD_3.2, psk_cred(~psk.2)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.2), ID_CRED_PSK_R.2, ~X.2, G_Y.3,
                 <
                  hash(<wrap(G_Y.3), C_R.3, 
                        wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                   wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.3), C_R.3, 
                                   wrap(hash(<wrap(method.3), wrap(suitesI.3), wrap('g'^~X.2), 
                                              wrap(C_I.3), wrap(psk_id(~id_i.2)), EAD_1.3>))
                                  >)), 
                        decxor(CIPHERTEXT_2.3,
                               edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                         hash(<wrap(G_Y.3), C_R.3, 
                                               wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                          wrap('g'^~X.2), wrap(C_I.3), 
                                                          wrap(psk_id(~id_i.2)), EAD_1.3>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.2)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.3), C_R.3, 
                                              wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                         wrap('g'^~X.2), wrap(C_I.3), 
                                                         wrap(psk_id(~id_i.2)), EAD_1.3>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.3,
                                          edhoc_kdf(hkdfextract('null', G_Y.3^~X.2), 'keystream_2',
                                                    hash(<wrap(G_Y.3), C_R.3, 
                                                          wrap(hash(<wrap(method.3), 
                                                                     wrap(suitesI.3), 
                                                                     wrap('g'^~X.2), wrap(C_I.3), 
                                                                     wrap(psk_id(~id_i.2)), EAD_1.3
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.2)>)), 
                        ~EAD_3.2, psk_cred(~psk.2)>), 
                  suitesI.3, EAD_1.3, EAD_2.3, ~EAD_3.2, 
                  <method.3, suitesI.3, 'g'^~X.2, C_I.3, psk_id(~id_i.2), EAD_1.3>, 
                  m2.3, 
                  aeadenc(~EAD_3.2, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.2)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.3,
                                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.3), C_R.3, 
                                                                 wrap(hash(<wrap(method.3), 
                                                                            wrap(suitesI.3), 
                                                                            wrap('g'^~X.2), 
                                                                            wrap(C_I.3), 
                                                                            wrap(psk_id(~id_i.2)), 
                                                                            EAD_1.3>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.2)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.3), C_R.3, 
                                                                wrap(hash(<wrap(method.3), 
                                                                           wrap(suitesI.3), 
                                                                           wrap('g'^~X.2), 
                                                                           wrap(C_I.3), 
                                                                           wrap(psk_id(~id_i.2)), 
                                                                           EAD_1.3>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.2)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.3), C_R.3, 
                                                     wrap(hash(<wrap(method.3), wrap(suitesI.3), 
                                                                wrap('g'^~X.2), wrap(C_I.3), 
                                                                wrap(psk_id(~id_i.2)), EAD_1.3>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.3,
                                                 edhoc_kdf(hkdfextract('null', G_Y.3^~X.2),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.3), C_R.3, 
                                                                 wrap(hash(<wrap(method.3), 
                                                                            wrap(suitesI.3), 
                                                                            wrap('g'^~X.2), 
                                                                            wrap(C_I.3), 
                                                                            wrap(psk_id(~id_i.2)), 
                                                                            EAD_1.3>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.2)>),
                                    iv_length))
                 >
);"]:
     [
     State_11211111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                      EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >)), 
                                                decxor(CIPHERTEXT_2,
                                                       edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                 hash(<wrap(G_Y), C_R, 
                                                                       wrap(hash(<wrap(method), 
                                                                                  wrap(suitesI), 
                                                                                  wrap('g'^~X), wrap(C_I), 
                                                                                  wrap(psk_id(~id_i)), EAD_1
                                                                                 >))
                                                                      >),
                                                                 plaintext_length)), 
                                                psk_cred(~psk)>)), 
                                     ~EAD_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R, ~X, G_Y,
                     <
                      hash(<wrap(G_Y), C_R, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                       wrap(psk_id(~id_i)), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap(G_Y), C_R, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                  wrap(psk_id(~id_i)), EAD_1>))
                                      >)), 
                            decxor(CIPHERTEXT_2,
                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                             hash(<wrap(G_Y), C_R, 
                                                   wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                              wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                  >),
                                             plaintext_length)), 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap(G_Y), C_R, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                             wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                 >)), 
                                       decxor(CIPHERTEXT_2,
                                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                        hash(<wrap(G_Y), C_R, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap('g'^~X), wrap(C_I), 
                                                                         wrap(psk_id(~id_i)), EAD_1>))
                                                             >),
                                                        plaintext_length)), 
                                       psk_cred(~psk)>)), 
                            ~EAD_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, EAD_2, ~EAD_3, 
                      <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1>, m2, 
                      aeadenc(~EAD_3, 'rep',
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'k_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        key_length),
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'iv_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        iv_length))
                     >
    )
    ]->
     [
     State_11211111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                         EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     ),
     Out( aeadenc(~EAD_3, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.34
       G_Y   = G_Y.44
       z     = G_Y.44^~X.34
    
    2. ~X    = ~X.41
       G_Y   = z.58^inv(~X.41)
       z     = z.58
    
    3. ~X    = ~X.281
       G_Y   = x.555^x.556
       z     = x.555^(~X.281*x.556)
    
    4. ~X    = ~X.291
       G_Y   = x.575^inv((~X.291*x.576))
       z     = x.575^inv(x.576)
    
    5. ~X    = ~X.291
       G_Y   = x.575^(x.576*inv(~X.291))
       z     = x.575^x.576
    
    6. ~X    = ~X.292
       G_Y   = x.576^(x.577*inv((~X.292*x.578)))
       z     = x.576^(x.577*inv(x.578))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_11211111111111111111111211111112111111111111[color=#408079,
                                                                                       process="event LeakSessionKey( 'null' );"]:
   [
   State_11211111111111111111111211111112111111111111( ~EAD_3.2, ~X.2,
                                                       ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_R.2,
                                                       CIPHERTEXT_2.3, C_I.3, C_R.3, EAD_1.3, EAD_2.3, G_Y.3,
                                                       MAC_2.3, m2.3, method.3, suitesI.3
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_11211111111111111111111211111112111111111111[color=#408079,
                                                                                          process="event LeakSessionKey( 'null' );"]:
     [
     State_11211111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                         EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) inm_0_1121111111111121[color=#408057,
                                       process="in(m1.4);"]:
   [ State_1121111111111121( ~id_i.2, ~id_r.2, ~psk.2 ), In( m1.4 ) ]
  -->
   [ Let_112111111111112111( m1.4, ~id_i.2, ~id_r.2, ~psk.2, m1.4 ) ]

  /*
  rule (modulo AC) inm_0_1121111111111121[color=#408057,
                                          process="in(m1.4);"]:
     [ State_1121111111111121( ~id_i, ~id_r, ~psk ), In( m1 ) ]
    -->
     [ Let_112111111111112111( m1, ~id_i, ~id_r, ~psk, m1 ) ]
  */

rule (modulo E) letmethodsuitesIGXCIIDCREDPSKIEADm_1_11211111111111211[color=#ffffff,
                                                                       process="let <method.4, suitesI.4, G_X.4, C_I.4, ID_CRED_PSK_I.2, EAD_1.4>=m1.4"]:
   [
   Let_112111111111112111( <method.4, suitesI.4, G_X.4, C_I.4, 
                            ID_CRED_PSK_I.2, EAD_1.4>,
                           ~id_i.2, ~id_r.2, ~psk.2, m1.4
   )
   ]
  -->
   [
   State_112111111111112111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                             C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) letmethodsuitesIGXCIIDCREDPSKIEADm_1_11211111111111211[color=#ffffff,
                                                                          process="let <method.4, suitesI.4, G_X.4, C_I.4, ID_CRED_PSK_I.2, EAD_1.4>=m1.4"]:
     [
     Let_112111111111112111( <method, suitesI, G_X, C_I, ID_CRED_PSK_I, EAD_1
                             >,
                             ~id_i, ~id_r, ~psk, m1
     )
     ]
    -->
     [
     State_112111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventMethodOkmethod_0_112111111111112111[color=#408048,
                                                         process="event MethodOk( method.4 );"]:
   [
   State_112111111111112111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                             C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]
  --[ MethodOk( method.4 ) ]->
   [
   State_1121111111111121111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                              C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventMethodOkmethod_0_112111111111112111[color=#408048,
                                                            process="event MethodOk( method.4 );"]:
     [
     State_112111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
    --[ MethodOk( method ) ]->
     [
     State_1121111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_1121111111111121111[color=#408048,
                                                                    process="event Eq( method.4, method_psk_variant1 );"]:
   [
   State_1121111111111121111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                              C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]
  --[ Eq( method.4, method_psk_variant1 ) ]->
   [
   State_11211111111111211111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                               C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_1121111111111121111[color=#408048,
                                                                       process="event Eq( method.4, method_psk_variant1 );"]:
     [
     State_1121111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_11211111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                 EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifmethodmethodpskvariant_0_11211111111111211111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_11211111111111211111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_11211111111111211111[color=#408048,
                                                                process="if method.4 = method_psk_variant1"]:
   [
   State_11211111111111211111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                               C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]
  --[
  Eq( ID_CRED_PSK_I.2, ~id_i.2 ),
  Restr_ifmethodmethodpskvariant_0_11211111111111211111_1( method.4 )
  ]->
   [
   State_1121111111111121111111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                                 C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_11211111111111211111[color=#408048,
                                                                   process="if method.4 = method_psk_variant1"]:
     [
     State_11211111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                 EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_I, ~id_i ),
    Restr_ifmethodmethodpskvariant_0_11211111111111211111_1( method )
    ]->
     [
     State_1121111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                   EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_11211111111111211111111111111[color=#40804f,
                                                                   process="event LeakShare( 'null' );"]:
   [
   State_11211111111111211111111111111( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                        method.4, suitesI.4
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_11211111111111211111111111111[color=#40804f,
                                                                      process="event LeakShare( 'null' );"]:
     [
     State_11211111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifIDCREDPSKIidi_0_1121111111111121111111_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKIidi_0_1121111111111121111111_1( x, x.1 ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKIidi_0_1121111111111121111111[color=#408048,
                                                         process="if ID_CRED_PSK_I.2 = ~id_i.2"]:
   [
   State_1121111111111121111111( ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                                 C_I.4, EAD_1.4, G_X.4, m1.4, method.4, suitesI.4
   ),
   Fr( ~Y.2 ), Fr( ~EAD_2.4 ), Fr( ~EAD_4.2 )
   ]
  --[
  Share( ~Y.2 ),
  Restr_ifIDCREDPSKIidi_0_1121111111111121111111_1( ID_CRED_PSK_I.2,
                                                    ~id_i.2
  )
  ]->
   [
   State_11211111111111211111111111111( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                        method.4, suitesI.4
   ),
   State_1121111111111121111111111112( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                       ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                       method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKIidi_0_1121111111111121111111[color=#408048,
                                                            process="if ID_CRED_PSK_I.2 = ~id_i.2"]:
     [
     State_1121111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                   EAD_1, G_X, m1, method, suitesI
     ),
     Fr( ~Y ), Fr( ~EAD_2 ), Fr( ~EAD_4 )
     ]
    --[
    Share( ~Y ),
    Restr_ifIDCREDPSKIidi_0_1121111111111121111111_1( ID_CRED_PSK_I, ~id_i )
    ]->
     [
     State_11211111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     ),
     State_1121111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGX_0_1121111111111121111111111112[color=#408048,
                                                                 process="event GroupCheck( G_X.4 );"]:
   [
   State_1121111111111121111111111112( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                       ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                       method.4, suitesI.4
   )
   ]
  --[ GroupCheck( G_X.4 ) ]->
   [
   State_11211111111111211111111111121( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                        method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGX_0_1121111111111121111111111112[color=#408048,
                                                                    process="event GroupCheck( G_X.4 );"]:
     [
     State_1121111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ GroupCheck( G_X ) ]->
     [
     State_11211111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGXgrpid_1_11211111111111211111111111121_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGXgrpid_1_11211111111111211111111111121_1( x ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGXgrpid_1_11211111111111211111111111121[color=#408048,
                                                                  process="if check_grp(G_X.4) = grpid"]:
   [
   State_11211111111111211111111111121( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                        ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                        method.4, suitesI.4
   )
   ]
  --[
  DerivedR_PSK( ~id_r.2, ID_CRED_PSK_I.2, psk_id(~id_r.2),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                       wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                ~Y.2, G_X.4
  ),
  Restr_ifcheckgrpGXgrpid_1_11211111111111211111111111121_1( check_grp(G_X.4)
  )
  ]->
   [
   State_1121111111111121111111111112121( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                          ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                          method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGXgrpid_1_11211111111111211111111111121[color=#408048,
                                                                     process="if check_grp(G_X.4) = grpid"]:
     [
     State_11211111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    DerivedR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  ~Y, G_X
    ),
    Restr_ifcheckgrpGXgrpid_1_11211111111111211111111111121_1( check_grp(G_X)
    )
    ]->
     [
     State_1121111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.29
       G_X   = G_X.37
       z     = G_X.37^~Y.29
    
    2. ~Y    = ~Y.34
       G_X   = z.47^inv(~Y.34)
       z     = z.47
    
    3. ~Y    = ~Y.113
       G_X   = x.218^x.219
       z     = x.218^(~Y.113*x.219)
    
    4. ~Y    = ~Y.121
       G_X   = x.234^inv((~Y.121*x.235))
       z     = x.234^inv(x.235)
    
    5. ~Y    = ~Y.121
       G_X   = x.234^(x.235*inv(~Y.121))
       z     = x.234^x.235
    
    6. ~Y    = ~Y.122
       G_X   = x.235^(x.236*inv((~Y.122*x.237)))
       z     = x.235^(x.236*inv(x.237))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventResponderStartPSKidrpskIDCREDPSKI_0_1121111111111121111111111112121[color=#408048,
                                                                                         process="event ResponderStart_PSK( ~id_r.2, ~psk.2, ID_CRED_PSK_I.2 );"]:
   [
   State_1121111111111121111111111112121( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                          ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                          method.4, suitesI.4
   )
   ]
  --[ ResponderStart_PSK( ~id_r.2, ~psk.2, ID_CRED_PSK_I.2 ) ]->
   [
   State_11211111111111211111111111121211( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                           ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                           method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventResponderStartPSKidrpskIDCREDPSKI_0_1121111111111121111111111112121[color=#408048,
                                                                                            process="event ResponderStart_PSK( ~id_r.2, ~psk.2, ID_CRED_PSK_I.2 );"]:
     [
     State_1121111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ ResponderStart_PSK( ~id_r, ~psk, ID_CRED_PSK_I ) ]->
     [
     State_11211111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididrgrpid_0_11211111111111211111111111121211[color=#408048,
                                                                         process="event Neq( psk_id(~id_r.2), grpid );"]:
   [
   State_11211111111111211111111111121211( ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2,
                                           ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4,
                                           method.4, suitesI.4
   )
   ]
  --[ Neq( psk_id(~id_r.2), grpid ) ]->
   [
   State_112111111111112111111111111212111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                            ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4,
                                            m1.4, method.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventNeqpskididrgrpid_0_11211111111111211111111111121211[color=#408048,
                                                                            process="event Neq( psk_id(~id_r.2), grpid );"]:
     [
     State_11211111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_r), grpid ) ]->
     [
     State_112111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_112111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.2,
               <
                hash(<wrap('g'^~Y.2), ~id_r.2, 
                      wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                 wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                     >), 
                suitesI.4, EAD_1.4, ~EAD_2.4, m1.4, 'g'^~Y.2, 
                decxor(<psk_id(~id_r.2), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                              wrap(hash(<wrap(method.4), 
                                                                         wrap(suitesI.4), 
                                                                         wrap(G_X.4), wrap(C_I.4), 
                                                                         wrap(ID_CRED_PSK_I.2), 
                                                                         EAD_1.4>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.2)),
                                  'mac_2',
                                  <~id_r.2, ID_CRED_PSK_I.2, 
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >), 
                                   psk_cred(~psk.2), ~EAD_2.4>,
                                  edhoc_mac_length), 
                        ~EAD_2.4>,
                       edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                  wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                      >),
                                 plaintext_length)), 
                ~id_r.2>
);"]:
   [
   State_112111111111112111111111111212111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                            ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4, G_X.4,
                                            m1.4, method.4, suitesI.4
   )
   ]
  --[
  SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.2,
                 <
                  hash(<wrap('g'^~Y.2), ~id_r.2, 
                        wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                   wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                       >), 
                  suitesI.4, EAD_1.4, ~EAD_2.4, m1.4, 'g'^~Y.2, 
                  decxor(<psk_id(~id_r.2), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                          'salt_3e2m',
                                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                           wrap(G_X.4), wrap(C_I.4), 
                                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.2)),
                                    'mac_2',
                                    <~id_r.2, ID_CRED_PSK_I.2, 
                                     hash(<wrap('g'^~Y.2), ~id_r.2, 
                                           wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                      wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                          >), 
                                     psk_cred(~psk.2), ~EAD_2.4>,
                                    edhoc_mac_length), 
                          ~EAD_2.4>,
                         edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >),
                                   plaintext_length)), 
                  ~id_r.2>
  )
  ]->
   [
   State_11211111111111211111111111121211111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                              ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                              G_X.4, m1.4, method.4, suitesI.4
   ),
   Out( <'g'^~Y.2, 
         decxor(<psk_id(~id_r.2), 
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.2)),
                           'mac_2',
                           <~id_r.2, ID_CRED_PSK_I.2, 
                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                  wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                             wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                 >), 
                            psk_cred(~psk.2), ~EAD_2.4>,
                           edhoc_mac_length), 
                 ~EAD_2.4>,
                edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                               >),
                          plaintext_length)), 
         ~id_r.2>
   )
   ]

  /*
  rule (modulo AC) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_112111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.2,
               <
                hash(<wrap('g'^~Y.2), ~id_r.2, 
                      wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                 wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                     >), 
                suitesI.4, EAD_1.4, ~EAD_2.4, m1.4, 'g'^~Y.2, 
                decxor(<psk_id(~id_r.2), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                              wrap(hash(<wrap(method.4), 
                                                                         wrap(suitesI.4), 
                                                                         wrap(G_X.4), wrap(C_I.4), 
                                                                         wrap(ID_CRED_PSK_I.2), 
                                                                         EAD_1.4>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.2)),
                                  'mac_2',
                                  <~id_r.2, ID_CRED_PSK_I.2, 
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >), 
                                   psk_cred(~psk.2), ~EAD_2.4>,
                                  edhoc_mac_length), 
                        ~EAD_2.4>,
                       edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                  wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                      >),
                                 plaintext_length)), 
                ~id_r.2>
);"]:
     [
     State_112111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                              ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I,
                   <
                    hash(<wrap('g'^~Y), ~id_r, 
                          wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                     wrap(ID_CRED_PSK_I), EAD_1>))
                         >), 
                    suitesI, EAD_1, ~EAD_2, m1, 'g'^~Y, 
                    decxor(<psk_id(~id_r), 
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk)),
                                      'mac_2',
                                      <~id_r, ID_CRED_PSK_I, 
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >), 
                                       psk_cred(~psk), ~EAD_2>,
                                      edhoc_mac_length), 
                            ~EAD_2>,
                           edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >),
                                     plaintext_length)), 
                    ~id_r>
    )
    ]->
     [
     State_11211111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method,
                                                suitesI
     ),
     Out( <'g'^~Y, 
           decxor(<psk_id(~id_r), 
                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk)),
                             'mac_2',
                             <~id_r, ID_CRED_PSK_I, 
                              hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >), 
                              psk_cred(~psk), ~EAD_2>,
                             edhoc_mac_length), 
                   ~EAD_2>,
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length)), 
           ~id_r>
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.30
       G_X   = G_X.38
       z     = G_X.38^~Y.30
    
    2. ~Y    = ~Y.36
       G_X   = z.50^inv(~Y.36)
       z     = z.50
    
    3. ~Y    = ~Y.162
       G_X   = x.316^x.317
       z     = x.316^(~Y.162*x.317)
    
    4. ~Y    = ~Y.170
       G_X   = x.332^inv((~Y.170*x.333))
       z     = x.332^inv(x.333)
    
    5. ~Y    = ~Y.170
       G_X   = x.332^(x.333*inv(~Y.170))
       z     = x.332^x.333
    
    6. ~Y    = ~Y.171
       G_X   = x.333^(x.334*inv((~Y.171*x.335)))
       z     = x.333^(x.334*inv(x.335))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) inm_0_11211111111111211111111111121211111[color=#408048,
                                                          process="in(m3.4);"]:
   [
   State_11211111111111211111111111121211111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                              ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                              G_X.4, m1.4, method.4, suitesI.4
   ),
   In( m3.4 )
   ]
  --[
  THRShared_PSK( psk_id(~id_r.2),
                 hash(<
                       wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                  wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                             wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                 >)), 
                       <psk_id(~id_r.2), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                         wrap(G_X.4), wrap(C_I.4), 
                                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.2)),
                                  'mac_2',
                                  <~id_r.2, ID_CRED_PSK_I.2, 
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >), 
                                   psk_cred(~psk.2), ~EAD_2.4>,
                                  edhoc_mac_length), 
                        ~EAD_2.4>, 
                       psk_cred(~psk.2)>)
  )
  ]->
   [
   Let_11211111111111211111111111121211111111( <m3.4, 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.4^~Y.2),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.2), 
                                                                                      ~id_r.2, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.4), 
                                                                                                 wrap(suitesI.4), 
                                                                                                 wrap(G_X.4), 
                                                                                                 wrap(C_I.4), 
                                                                                                 wrap(ID_CRED_PSK_I.2), 
                                                                                                 EAD_1.4>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.2)),
                                                          'k_3',
                                                          hash(<
                                                                wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                           wrap(hash(<wrap(method.4), 
                                                                                      wrap(suitesI.4), 
                                                                                      wrap(G_X.4), 
                                                                                      wrap(C_I.4), 
                                                                                      wrap(ID_CRED_PSK_I.2), 
                                                                                      EAD_1.4>))
                                                                          >)), 
                                                                <psk_id(~id_r.2), 
                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                             G_X.4^~Y.2),
                                                                                                 'salt_3e2m',
                                                                                                 hash(<
                                                                                                       wrap('g'^~Y.2), 
                                                                                                       ~id_r.2, 
                                                                                                       wrap(hash(<
                                                                                                                  wrap(method.4), 
                                                                                                                  wrap(suitesI.4), 
                                                                                                                  wrap(G_X.4), 
                                                                                                                  wrap(C_I.4), 
                                                                                                                  wrap(ID_CRED_PSK_I.2), 
                                                                                                                  EAD_1.4
                                                                                                                 >))
                                                                                                      >),
                                                                                                 hash_length),
                                                                                       psk_cred(~psk.2)),
                                                                           'mac_2',
                                                                           <~id_r.2, ID_CRED_PSK_I.2, 
                                                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                  wrap(hash(<wrap(method.4), 
                                                                                             wrap(suitesI.4), 
                                                                                             wrap(G_X.4), 
                                                                                             wrap(C_I.4), 
                                                                                             wrap(ID_CRED_PSK_I.2), 
                                                                                             EAD_1.4>))
                                                                                 >), 
                                                                            psk_cred(~psk.2), ~EAD_2.4>,
                                                                           edhoc_mac_length), 
                                                                 ~EAD_2.4>, 
                                                                psk_cred(~psk.2)>),
                                                          key_length), 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.4^~Y.2),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.2), 
                                                                                      ~id_r.2, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.4), 
                                                                                                 wrap(suitesI.4), 
                                                                                                 wrap(G_X.4), 
                                                                                                 wrap(C_I.4), 
                                                                                                 wrap(ID_CRED_PSK_I.2), 
                                                                                                 EAD_1.4>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.2)),
                                                          'iv_3',
                                                          hash(<
                                                                wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                           wrap(hash(<wrap(method.4), 
                                                                                      wrap(suitesI.4), 
                                                                                      wrap(G_X.4), 
                                                                                      wrap(C_I.4), 
                                                                                      wrap(ID_CRED_PSK_I.2), 
                                                                                      EAD_1.4>))
                                                                          >)), 
                                                                <psk_id(~id_r.2), 
                                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                             G_X.4^~Y.2),
                                                                                                 'salt_3e2m',
                                                                                                 hash(<
                                                                                                       wrap('g'^~Y.2), 
                                                                                                       ~id_r.2, 
                                                                                                       wrap(hash(<
                                                                                                                  wrap(method.4), 
                                                                                                                  wrap(suitesI.4), 
                                                                                                                  wrap(G_X.4), 
                                                                                                                  wrap(C_I.4), 
                                                                                                                  wrap(ID_CRED_PSK_I.2), 
                                                                                                                  EAD_1.4
                                                                                                                 >))
                                                                                                      >),
                                                                                                 hash_length),
                                                                                       psk_cred(~psk.2)),
                                                                           'mac_2',
                                                                           <~id_r.2, ID_CRED_PSK_I.2, 
                                                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                  wrap(hash(<wrap(method.4), 
                                                                                             wrap(suitesI.4), 
                                                                                             wrap(G_X.4), 
                                                                                             wrap(C_I.4), 
                                                                                             wrap(ID_CRED_PSK_I.2), 
                                                                                             EAD_1.4>))
                                                                                 >), 
                                                                            psk_cred(~psk.2), ~EAD_2.4>,
                                                                           edhoc_mac_length), 
                                                                 ~EAD_2.4>, 
                                                                psk_cred(~psk.2)>),
                                                          iv_length)
                                               >,
                                               ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                                               ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                               suitesI.4
   )
   ]

  /*
  rule (modulo AC) inm_0_11211111111111211111111111121211111[color=#408048,
                                                             process="in(m3.4);"]:
     [
     State_11211111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method,
                                                suitesI
     ),
     In( m3 )
     ]
    --[
    THRShared_PSK( psk_id(~id_r),
                   hash(<
                         wrap(hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >)), 
                         <psk_id(~id_r), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                          hash(<wrap('g'^~Y), ~id_r, 
                                                                wrap(hash(<wrap(method), wrap(suitesI), 
                                                                           wrap(G_X), wrap(C_I), 
                                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk)),
                                    'mac_2',
                                    <~id_r, ID_CRED_PSK_I, 
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >), 
                                     psk_cred(~psk), ~EAD_2>,
                                    edhoc_mac_length), 
                          ~EAD_2>, 
                         psk_cred(~psk)>)
    )
    ]->
     [
     Let_11211111111111211111111111121211111111( <m3, 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'k_3',
                                                            hash(<
                                                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                             wrap(hash(<wrap(method), 
                                                                                        wrap(suitesI), 
                                                                                        wrap(G_X), wrap(C_I), 
                                                                                        wrap(ID_CRED_PSK_I), 
                                                                                        EAD_1>))
                                                                            >)), 
                                                                  <psk_id(~id_r), 
                                                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                               z),
                                                                                                   'salt_3e2m',
                                                                                                   hash(<
                                                                                                         wrap('g'^~Y), 
                                                                                                         ~id_r, 
                                                                                                         wrap(hash(<
                                                                                                                    wrap(method), 
                                                                                                                    wrap(suitesI), 
                                                                                                                    wrap(G_X), 
                                                                                                                    wrap(C_I), 
                                                                                                                    wrap(ID_CRED_PSK_I), 
                                                                                                                    EAD_1
                                                                                                                   >))
                                                                                                        >),
                                                                                                   hash_length),
                                                                                         psk_cred(~psk)),
                                                                             'mac_2',
                                                                             <~id_r, ID_CRED_PSK_I, 
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >), 
                                                                              psk_cred(~psk), ~EAD_2>,
                                                                             edhoc_mac_length), 
                                                                   ~EAD_2>, 
                                                                  psk_cred(~psk)>),
                                                            key_length), 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'iv_3',
                                                            hash(<
                                                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                             wrap(hash(<wrap(method), 
                                                                                        wrap(suitesI), 
                                                                                        wrap(G_X), wrap(C_I), 
                                                                                        wrap(ID_CRED_PSK_I), 
                                                                                        EAD_1>))
                                                                            >)), 
                                                                  <psk_id(~id_r), 
                                                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                               z),
                                                                                                   'salt_3e2m',
                                                                                                   hash(<
                                                                                                         wrap('g'^~Y), 
                                                                                                         ~id_r, 
                                                                                                         wrap(hash(<
                                                                                                                    wrap(method), 
                                                                                                                    wrap(suitesI), 
                                                                                                                    wrap(G_X), 
                                                                                                                    wrap(C_I), 
                                                                                                                    wrap(ID_CRED_PSK_I), 
                                                                                                                    EAD_1
                                                                                                                   >))
                                                                                                        >),
                                                                                                   hash_length),
                                                                                         psk_cred(~psk)),
                                                                             'mac_2',
                                                                             <~id_r, ID_CRED_PSK_I, 
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >), 
                                                                              psk_cred(~psk), ~EAD_2>,
                                                                             edhoc_mac_length), 
                                                                   ~EAD_2>, 
                                                                  psk_cred(~psk)>),
                                                            iv_length)
                                                 >,
                                                 ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                 EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.30
       G_X   = G_X.38
       z     = G_X.38^~Y.30
    
    2. ~Y    = ~Y.36
       G_X   = z.50^inv(~Y.36)
       z     = z.50
    
    3. ~Y    = ~Y.197
       G_X   = x.386^x.387
       z     = x.386^(~Y.197*x.387)
    
    4. ~Y    = ~Y.205
       G_X   = x.402^inv((~Y.205*x.403))
       z     = x.402^inv(x.403)
    
    5. ~Y    = ~Y.205
       G_X   = x.402^(x.403*inv(~Y.205))
       z     = x.402^x.403
    
    6. ~Y    = ~Y.206
       G_X   = x.403^(x.404*inv((~Y.206*x.405)))
       z     = x.403^(x.404*inv(x.405))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_1121111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     process="let plaintext_3.4=aeaddec(m3.4,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.2)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.2)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>),
                  iv_length))"]:
   [
   Let_11211111111111211111111111121211111111( <
                                                aeadenc(plaintext_3.4, r, k, ad), k, ad>,
                                               ~EAD_4.2, ~Y.2, ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2,
                                               ~EAD_2.4, C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                               suitesI.4
   )
   ]
  -->
   [
   State_11211111111111211111111111121211111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                 ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                 G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_1121111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        process="let plaintext_3.4=aeaddec(m3.4,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.2)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.2)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>),
                  iv_length))"]:
     [
     Let_11211111111111211111111111121211111111( <
                                                  aeadenc(plaintext_3, r, k, ad), k, ad>,
                                                 ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                 EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    -->
     [
     State_11211111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
  */

rule (modulo E) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_11211111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event AcceptR_PSK( ~id_r.2, method_psk_variant1, ID_CRED_PSK_I.2,
             psk_id(~id_r.2),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                              wrap(G_X.4), wrap(C_I.4), 
                                                              wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.2)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                              wrap(G_X.4), wrap(C_I.4), 
                                                              wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                  >)), 
                                        <psk_id(~id_r.2), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.4^~Y.2),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.2), 
                                                                               ~id_r.2, 
                                                                               wrap(hash(<
                                                                                          wrap(method.4), 
                                                                                          wrap(suitesI.4), 
                                                                                          wrap(G_X.4), 
                                                                                          wrap(C_I.4), 
                                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                                          EAD_1.4>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.2)),
                                                   'mac_2',
                                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                          wrap(hash(<wrap(method.4), 
                                                                     wrap(suitesI.4), wrap(G_X.4), 
                                                                     wrap(C_I.4), 
                                                                     wrap(ID_CRED_PSK_I.2), EAD_1.4
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.2), ~EAD_2.4>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.4>, 
                                        psk_cred(~psk.2)>)), 
                             plaintext_3.4, psk_cred(~psk.2)>),
                       hash_length)
);"]:
   [
   State_11211111111111211111111111121211111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                 ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                 G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]
  --[
  AcceptR_PSK( ~id_r.2, method_psk_variant1, ID_CRED_PSK_I.2,
               psk_id(~id_r.2),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                     hash(<wrap('g'^~Y.2), ~id_r.2, 
                                           wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                      wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.2)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                               'salt_3e2m',
                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                     wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                                wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.2)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                     wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                                wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                    >)), 
                                          <psk_id(~id_r.2), 
                                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                           'salt_3e2m',
                                                                           hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                 wrap(hash(<wrap(method.4), 
                                                                                            wrap(suitesI.4), 
                                                                                            wrap(G_X.4), 
                                                                                            wrap(C_I.4), 
                                                                                            wrap(ID_CRED_PSK_I.2), 
                                                                                            EAD_1.4>))
                                                                                >),
                                                                           hash_length),
                                                                 psk_cred(~psk.2)),
                                                     'mac_2',
                                                     <~id_r.2, ID_CRED_PSK_I.2, 
                                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                       wrap(G_X.4), wrap(C_I.4), 
                                                                       wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                           >), 
                                                      psk_cred(~psk.2), ~EAD_2.4>,
                                                     edhoc_mac_length), 
                                           ~EAD_2.4>, 
                                          psk_cred(~psk.2)>)), 
                               plaintext_3.4, psk_cred(~psk.2)>),
                         hash_length)
  )
  ]->
   [
   State_112111111111112111111111111212111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                  ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                  G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_11211111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event AcceptR_PSK( ~id_r.2, method_psk_variant1, ID_CRED_PSK_I.2,
             psk_id(~id_r.2),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.2)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                              wrap(G_X.4), wrap(C_I.4), 
                                                              wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.2)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                              wrap(G_X.4), wrap(C_I.4), 
                                                              wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                  >)), 
                                        <psk_id(~id_r.2), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.4^~Y.2),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.2), 
                                                                               ~id_r.2, 
                                                                               wrap(hash(<
                                                                                          wrap(method.4), 
                                                                                          wrap(suitesI.4), 
                                                                                          wrap(G_X.4), 
                                                                                          wrap(C_I.4), 
                                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                                          EAD_1.4>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.2)),
                                                   'mac_2',
                                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                          wrap(hash(<wrap(method.4), 
                                                                     wrap(suitesI.4), wrap(G_X.4), 
                                                                     wrap(C_I.4), 
                                                                     wrap(ID_CRED_PSK_I.2), EAD_1.4
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.2), ~EAD_2.4>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.4>, 
                                        psk_cred(~psk.2)>)), 
                             plaintext_3.4, psk_cred(~psk.2)>),
                       hash_length)
);"]:
     [
     State_11211111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptR_PSK( ~id_r, method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >)), 
                                            <psk_id(~id_r), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                                   wrap(hash(<wrap(method), 
                                                                                              wrap(suitesI), 
                                                                                              wrap(G_X), 
                                                                                              wrap(C_I), 
                                                                                              wrap(ID_CRED_PSK_I), 
                                                                                              EAD_1>))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk)),
                                                       'mac_2',
                                                       <~id_r, ID_CRED_PSK_I, 
                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap(G_X), wrap(C_I), 
                                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                                             >), 
                                                        psk_cred(~psk), ~EAD_2>,
                                                       edhoc_mac_length), 
                                             ~EAD_2>, 
                                            psk_cred(~psk)>)), 
                                 plaintext_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_112111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.31
       G_X   = G_X.39
       z     = G_X.39^~Y.31
    
    2. ~Y    = ~Y.38
       G_X   = z.53^inv(~Y.38)
       z     = z.53
    
    3. ~Y    = ~Y.177
       G_X   = x.346^x.347
       z     = x.346^(~Y.177*x.347)
    
    4. ~Y    = ~Y.185
       G_X   = x.362^inv((~Y.185*x.363))
       z     = x.362^inv(x.363)
    
    5. ~Y    = ~Y.185
       G_X   = x.362^(x.363*inv(~Y.185))
       z     = x.362^x.363
    
    6. ~Y    = ~Y.186
       G_X   = x.363^(x.364*inv((~Y.186*x.365)))
       z     = x.363^(x.364*inv(x.365))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_112111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event SessionSecrets_R( ~id_r.2, ~Y.2, G_X.4,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                        wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                   wrap(G_X.4), wrap(C_I.4), 
                                                                   wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.2)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                        wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                   wrap(G_X.4), wrap(C_I.4), 
                                                                   wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                       >)), 
                                             <psk_id(~id_r.2), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.4^~Y.2),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.2), 
                                                                                    ~id_r.2, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.4), 
                                                                                               wrap(suitesI.4), 
                                                                                               wrap(G_X.4), 
                                                                                               wrap(C_I.4), 
                                                                                               wrap(ID_CRED_PSK_I.2), 
                                                                                               EAD_1.4
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.2)),
                                                        'mac_2',
                                                        <~id_r.2, ID_CRED_PSK_I.2, 
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >), 
                                                         psk_cred(~psk.2), ~EAD_2.4>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.4>, 
                                             psk_cred(~psk.2)>)), 
                                  plaintext_3.4, psk_cred(~psk.2)>),
                            hash_length)
);"]:
   [
   State_112111111111112111111111111212111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                  ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                  G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]
  --[
  SessionSecrets_R( ~id_r.2, ~Y.2, G_X.4,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                    'salt_3e2m',
                                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                     wrap(G_X.4), wrap(C_I.4), 
                                                                     wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.2)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                     wrap(G_X.4), wrap(C_I.4), 
                                                                     wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                         >)), 
                                               <psk_id(~id_r.2), 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.4^~Y.2),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.2), 
                                                                                      ~id_r.2, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.4), 
                                                                                                 wrap(suitesI.4), 
                                                                                                 wrap(G_X.4), 
                                                                                                 wrap(C_I.4), 
                                                                                                 wrap(ID_CRED_PSK_I.2), 
                                                                                                 EAD_1.4>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.2)),
                                                          'mac_2',
                                                          <~id_r.2, ID_CRED_PSK_I.2, 
                                                           hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                 wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                            wrap(G_X.4), wrap(C_I.4), 
                                                                            wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                                >), 
                                                           psk_cred(~psk.2), ~EAD_2.4>,
                                                          edhoc_mac_length), 
                                                ~EAD_2.4>, 
                                               psk_cred(~psk.2)>)), 
                                    plaintext_3.4, psk_cred(~psk.2)>),
                              hash_length)
  )
  ]->
   [
   State_1121111111111121111111111112121111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                   ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                   G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_112111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     process="event SessionSecrets_R( ~id_r.2, ~Y.2, G_X.4,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                        wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                   wrap(G_X.4), wrap(C_I.4), 
                                                                   wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.2)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                        wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                   wrap(G_X.4), wrap(C_I.4), 
                                                                   wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                       >)), 
                                             <psk_id(~id_r.2), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.4^~Y.2),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.2), 
                                                                                    ~id_r.2, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.4), 
                                                                                               wrap(suitesI.4), 
                                                                                               wrap(G_X.4), 
                                                                                               wrap(C_I.4), 
                                                                                               wrap(ID_CRED_PSK_I.2), 
                                                                                               EAD_1.4
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.2)),
                                                        'mac_2',
                                                        <~id_r.2, ID_CRED_PSK_I.2, 
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >), 
                                                         psk_cred(~psk.2), ~EAD_2.4>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.4>, 
                                             psk_cred(~psk.2)>)), 
                                  plaintext_3.4, psk_cred(~psk.2)>),
                            hash_length)
);"]:
     [
     State_112111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    --[
    SessionSecrets_R( ~id_r, ~Y, G_X,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >)), 
                                                 <psk_id(~id_r), 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'mac_2',
                                                            <~id_r, ID_CRED_PSK_I, 
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >), 
                                                             psk_cred(~psk), ~EAD_2>,
                                                            edhoc_mac_length), 
                                                  ~EAD_2>, 
                                                 psk_cred(~psk)>)), 
                                      plaintext_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_1121111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.31
       G_X   = G_X.39
       z     = G_X.39^~Y.31
    
    2. ~Y    = ~Y.38
       G_X   = z.53^inv(~Y.38)
       z     = z.53
    
    3. ~Y    = ~Y.177
       G_X   = x.346^x.347
       z     = x.346^(~Y.177*x.347)
    
    4. ~Y    = ~Y.185
       G_X   = x.362^inv((~Y.185*x.363))
       z     = x.362^inv(x.363)
    
    5. ~Y    = ~Y.185
       G_X   = x.362^(x.363*inv(~Y.185))
       z     = x.362^x.363
    
    6. ~Y    = ~Y.186
       G_X   = x.363^(x.364*inv((~Y.186*x.365)))
       z     = x.363^(x.364*inv(x.365))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_1121111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event SecretsR_PSK( ~id_r.2, ID_CRED_PSK_I.2, psk_id(~id_r.2),
              hkdfextract('null', G_X.4^~Y.2),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >)), 
                                         <psk_id(~id_r.2), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.4^~Y.2),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.2), 
                                                                                ~id_r.2, 
                                                                                wrap(hash(<
                                                                                           wrap(method.4), 
                                                                                           wrap(suitesI.4), 
                                                                                           wrap(G_X.4), 
                                                                                           wrap(C_I.4), 
                                                                                           wrap(ID_CRED_PSK_I.2), 
                                                                                           EAD_1.4
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.2)),
                                                    'mac_2',
                                                    <~id_r.2, ID_CRED_PSK_I.2, 
                                                     hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                           wrap(hash(<wrap(method.4), 
                                                                      wrap(suitesI.4), wrap(G_X.4), 
                                                                      wrap(C_I.4), 
                                                                      wrap(ID_CRED_PSK_I.2), EAD_1.4
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.2), ~EAD_2.4>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.4>, 
                                         psk_cred(~psk.2)>)), 
                              plaintext_3.4, psk_cred(~psk.2)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                              wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                         wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >)), 
                              <psk_id(~id_r.2), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                     wrap(hash(<wrap(method.4), 
                                                                                wrap(suitesI.4), 
                                                                                wrap(G_X.4), 
                                                                                wrap(C_I.4), 
                                                                                wrap(ID_CRED_PSK_I.2), 
                                                                                EAD_1.4>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.2)),
                                         'mac_2',
                                         <~id_r.2, ID_CRED_PSK_I.2, 
                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                           wrap(G_X.4), wrap(C_I.4), 
                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                               >), 
                                          psk_cred(~psk.2), ~EAD_2.4>,
                                         edhoc_mac_length), 
                               ~EAD_2.4>, 
                              psk_cred(~psk.2)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >)), 
                              <psk_id(~id_r.2), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                     wrap(hash(<wrap(method.4), 
                                                                                wrap(suitesI.4), 
                                                                                wrap(G_X.4), 
                                                                                wrap(C_I.4), 
                                                                                wrap(ID_CRED_PSK_I.2), 
                                                                                EAD_1.4>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.2)),
                                         'mac_2',
                                         <~id_r.2, ID_CRED_PSK_I.2, 
                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                           wrap(G_X.4), wrap(C_I.4), 
                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                               >), 
                                          psk_cred(~psk.2), ~EAD_2.4>,
                                         edhoc_mac_length), 
                               ~EAD_2.4>, 
                              psk_cred(~psk.2)>),
                        iv_length),
              ~Y.2, G_X.4
);"]:
   [
   State_1121111111111121111111111112121111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                   ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4, EAD_1.4,
                                                   G_X.4, m1.4, m3.4, method.4, plaintext_3.4, suitesI.4
   )
   ]
  --[
  SecretsR_PSK( ~id_r.2, ID_CRED_PSK_I.2, psk_id(~id_r.2),
                hkdfextract('null', G_X.4^~Y.2),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                       wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                       wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.2)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >)), 
                                           <psk_id(~id_r.2), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                  wrap(hash(<wrap(method.4), 
                                                                                             wrap(suitesI.4), 
                                                                                             wrap(G_X.4), 
                                                                                             wrap(C_I.4), 
                                                                                             wrap(ID_CRED_PSK_I.2), 
                                                                                             EAD_1.4>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.2)),
                                                      'mac_2',
                                                      <~id_r.2, ID_CRED_PSK_I.2, 
                                                       hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                             wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                        wrap(G_X.4), wrap(C_I.4), 
                                                                        wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                            >), 
                                                       psk_cred(~psk.2), ~EAD_2.4>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.4>, 
                                           psk_cred(~psk.2)>)), 
                                plaintext_3.4, psk_cred(~psk.2)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                           wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                      wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                          >)), 
                                <psk_id(~id_r.2), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                       wrap(hash(<wrap(method.4), 
                                                                                  wrap(suitesI.4), 
                                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                                  wrap(ID_CRED_PSK_I.2), 
                                                                                  EAD_1.4>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.2)),
                                           'mac_2',
                                           <~id_r.2, ID_CRED_PSK_I.2, 
                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                  wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                             wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                 >), 
                                            psk_cred(~psk.2), ~EAD_2.4>,
                                           edhoc_mac_length), 
                                 ~EAD_2.4>, 
                                psk_cred(~psk.2)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                           wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                      wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                          >)), 
                                <psk_id(~id_r.2), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                       wrap(hash(<wrap(method.4), 
                                                                                  wrap(suitesI.4), 
                                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                                  wrap(ID_CRED_PSK_I.2), 
                                                                                  EAD_1.4>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.2)),
                                           'mac_2',
                                           <~id_r.2, ID_CRED_PSK_I.2, 
                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                  wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                             wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                 >), 
                                            psk_cred(~psk.2), ~EAD_2.4>,
                                           edhoc_mac_length), 
                                 ~EAD_2.4>, 
                                psk_cred(~psk.2)>),
                          iv_length),
                ~Y.2, G_X.4
  )
  ]->
   [
   State_11211111111111211111111111121211111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                    ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4,
                                                    EAD_1.4, G_X.4, m1.4, m3.4, method.4, plaintext_3.4,
                                                    suitesI.4
   )
   ]

  /*
  rule (modulo AC) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_1121111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SecretsR_PSK( ~id_r.2, ID_CRED_PSK_I.2, psk_id(~id_r.2),
              hkdfextract('null', G_X.4^~Y.2),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.2)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >)), 
                                         <psk_id(~id_r.2), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.4^~Y.2),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.2), 
                                                                                ~id_r.2, 
                                                                                wrap(hash(<
                                                                                           wrap(method.4), 
                                                                                           wrap(suitesI.4), 
                                                                                           wrap(G_X.4), 
                                                                                           wrap(C_I.4), 
                                                                                           wrap(ID_CRED_PSK_I.2), 
                                                                                           EAD_1.4
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.2)),
                                                    'mac_2',
                                                    <~id_r.2, ID_CRED_PSK_I.2, 
                                                     hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                           wrap(hash(<wrap(method.4), 
                                                                      wrap(suitesI.4), wrap(G_X.4), 
                                                                      wrap(C_I.4), 
                                                                      wrap(ID_CRED_PSK_I.2), EAD_1.4
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.2), ~EAD_2.4>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.4>, 
                                         psk_cred(~psk.2)>)), 
                              plaintext_3.4, psk_cred(~psk.2)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                              wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                         wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >)), 
                              <psk_id(~id_r.2), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                     wrap(hash(<wrap(method.4), 
                                                                                wrap(suitesI.4), 
                                                                                wrap(G_X.4), 
                                                                                wrap(C_I.4), 
                                                                                wrap(ID_CRED_PSK_I.2), 
                                                                                EAD_1.4>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.2)),
                                         'mac_2',
                                         <~id_r.2, ID_CRED_PSK_I.2, 
                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                           wrap(G_X.4), wrap(C_I.4), 
                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                               >), 
                                          psk_cred(~psk.2), ~EAD_2.4>,
                                         edhoc_mac_length), 
                               ~EAD_2.4>, 
                              psk_cred(~psk.2)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                    wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                               wrap(G_X.4), wrap(C_I.4), 
                                                               wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.2)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                    wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                        >)), 
                              <psk_id(~id_r.2), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                     wrap(hash(<wrap(method.4), 
                                                                                wrap(suitesI.4), 
                                                                                wrap(G_X.4), 
                                                                                wrap(C_I.4), 
                                                                                wrap(ID_CRED_PSK_I.2), 
                                                                                EAD_1.4>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.2)),
                                         'mac_2',
                                         <~id_r.2, ID_CRED_PSK_I.2, 
                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                           wrap(G_X.4), wrap(C_I.4), 
                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                               >), 
                                          psk_cred(~psk.2), ~EAD_2.4>,
                                         edhoc_mac_length), 
                               ~EAD_2.4>, 
                              psk_cred(~psk.2)>),
                        iv_length),
              ~Y.2, G_X.4
);"]:
     [
     State_1121111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    --[
    SecretsR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~Y, G_X
    )
    ]->
     [
     State_11211111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1,
                                                      m3, method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.31
       G_X   = G_X.39
       z     = G_X.39^~Y.31
    
    2. ~Y    = ~Y.38
       G_X   = z.53^inv(~Y.38)
       z     = z.53
    
    3. ~Y    = ~Y.270
       G_X   = x.532^x.533
       z     = x.532^(~Y.270*x.533)
    
    4. ~Y    = ~Y.278
       G_X   = x.548^inv((~Y.278*x.549))
       z     = x.548^inv(x.549)
    
    5. ~Y    = ~Y.278
       G_X   = x.548^(x.549*inv(~Y.278))
       z     = x.548^x.549
    
    6. ~Y    = ~Y.279
       G_X   = x.549^(x.550*inv((~Y.279*x.551)))
       z     = x.549^(x.550*inv(x.551))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_112111111111112111111111111212111111111111111[color=#408072,
                                                                                        process="event LeakSessionKey( 'null' );"]:
   [
   State_112111111111112111111111111212111111111111111( ~EAD_4.2, ~Y.2,
                                                        ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4,
                                                        C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                                        plaintext_3.4, suitesI.4
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_112111111111112111111111111212111111111111111[color=#408072,
                                                                                           process="event LeakSessionKey( 'null' );"]:
     [
     State_112111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                          ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                          m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_11211111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.4^~Y.2),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.2)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >)), 
                                            <psk_id(~id_r.2), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.4^~Y.2),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.2), 
                                                                                   ~id_r.2, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.4), 
                                                                                              wrap(suitesI.4), 
                                                                                              wrap(G_X.4), 
                                                                                              wrap(C_I.4), 
                                                                                              wrap(ID_CRED_PSK_I.2), 
                                                                                              EAD_1.4
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.2)),
                                                       'mac_2',
                                                       <~id_r.2, ID_CRED_PSK_I.2, 
                                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                              wrap(hash(<wrap(method.4), 
                                                                         wrap(suitesI.4), 
                                                                         wrap(G_X.4), wrap(C_I.4), 
                                                                         wrap(ID_CRED_PSK_I.2), 
                                                                         EAD_1.4>))
                                                             >), 
                                                        psk_cred(~psk.2), ~EAD_2.4>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.4>, 
                                            psk_cred(~psk.2)>)), 
                                 plaintext_3.4, psk_cred(~psk.2)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.2, psk_id(~id_r.2), ~Y.2, G_X.4,
                 <
                  hash(<wrap('g'^~Y.2), ~id_r.2, 
                        wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                   wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >)), 
                                   <psk_id(~id_r.2), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                          wrap(hash(<
                                                                                     wrap(method.4), 
                                                                                     wrap(suitesI.4), 
                                                                                     wrap(G_X.4), 
                                                                                     wrap(C_I.4), 
                                                                                     wrap(ID_CRED_PSK_I.2), 
                                                                                     EAD_1.4>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.2)),
                                              'mac_2',
                                              <~id_r.2, ID_CRED_PSK_I.2, 
                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                     wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                wrap(G_X.4), wrap(C_I.4), 
                                                                wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                    >), 
                                               psk_cred(~psk.2), ~EAD_2.4>,
                                              edhoc_mac_length), 
                                    ~EAD_2.4>, 
                                   psk_cred(~psk.2)>)), 
                        plaintext_3.4, psk_cred(~psk.2)>), 
                  suitesI.4, EAD_1.4, ~EAD_2.4, plaintext_3.4, m1.4, 
                  <'g'^~Y.2, 
                   decxor(<psk_id(~id_r.2), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                 wrap(hash(<wrap(method.4), 
                                                                            wrap(suitesI.4), 
                                                                            wrap(G_X.4), 
                                                                            wrap(C_I.4), 
                                                                            wrap(ID_CRED_PSK_I.2), 
                                                                            EAD_1.4>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.2)),
                                     'mac_2',
                                     <~id_r.2, ID_CRED_PSK_I.2, 
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                       wrap(G_X.4), wrap(C_I.4), 
                                                       wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >), 
                                      psk_cred(~psk.2), ~EAD_2.4>,
                                     edhoc_mac_length), 
                           ~EAD_2.4>,
                          edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.2>, 
                  m3.4>
);"]:
   [
   State_11211111111111211111111111121211111111111( ~EAD_4.2, ~Y.2, ~id_i.2,
                                                    ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4, C_I.4,
                                                    EAD_1.4, G_X.4, m1.4, m3.4, method.4, plaintext_3.4,
                                                    suitesI.4
   )
   ]
  --[
  AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_X.4^~Y.2),
                                                   'salt_3e2m',
                                                   hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                    wrap(G_X.4), wrap(C_I.4), 
                                                                    wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.2)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                         wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                    wrap(G_X.4), wrap(C_I.4), 
                                                                    wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                        >)), 
                                              <psk_id(~id_r.2), 
                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                           G_X.4^~Y.2),
                                                                               'salt_3e2m',
                                                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                     wrap(hash(<
                                                                                                wrap(method.4), 
                                                                                                wrap(suitesI.4), 
                                                                                                wrap(G_X.4), 
                                                                                                wrap(C_I.4), 
                                                                                                wrap(ID_CRED_PSK_I.2), 
                                                                                                EAD_1.4>))
                                                                                    >),
                                                                               hash_length),
                                                                     psk_cred(~psk.2)),
                                                         'mac_2',
                                                         <~id_r.2, ID_CRED_PSK_I.2, 
                                                          hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                           wrap(G_X.4), wrap(C_I.4), 
                                                                           wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                               >), 
                                                          psk_cred(~psk.2), ~EAD_2.4>,
                                                         edhoc_mac_length), 
                                               ~EAD_2.4>, 
                                              psk_cred(~psk.2)>)), 
                                   plaintext_3.4, psk_cred(~psk.2)>),
                             hash_length),
                   method_psk_variant1, ID_CRED_PSK_I.2, psk_id(~id_r.2), ~Y.2, G_X.4,
                   <
                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                     wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                         >), 
                    hash(<
                          wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                     wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), wrap(C_I.4), 
                                                wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                    >)), 
                          <psk_id(~id_r.2), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                 wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                            wrap(G_X.4), wrap(C_I.4), 
                                                                            wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.2)),
                                     'mac_2',
                                     <~id_r.2, ID_CRED_PSK_I.2, 
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                       wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >), 
                                      psk_cred(~psk.2), ~EAD_2.4>,
                                     edhoc_mac_length), 
                           ~EAD_2.4>, 
                          psk_cred(~psk.2)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                           wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                               >)), 
                                     <psk_id(~id_r.2), 
                                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                      'salt_3e2m',
                                                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                            wrap(hash(<wrap(method.4), 
                                                                                       wrap(suitesI.4), 
                                                                                       wrap(G_X.4), 
                                                                                       wrap(C_I.4), 
                                                                                       wrap(ID_CRED_PSK_I.2), 
                                                                                       EAD_1.4>))
                                                                           >),
                                                                      hash_length),
                                                            psk_cred(~psk.2)),
                                                'mac_2',
                                                <~id_r.2, ID_CRED_PSK_I.2, 
                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >), 
                                                 psk_cred(~psk.2), ~EAD_2.4>,
                                                edhoc_mac_length), 
                                      ~EAD_2.4>, 
                                     psk_cred(~psk.2)>)), 
                          plaintext_3.4, psk_cred(~psk.2)>), 
                    suitesI.4, EAD_1.4, ~EAD_2.4, plaintext_3.4, m1.4, 
                    <'g'^~Y.2, 
                     decxor(<psk_id(~id_r.2), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                             'salt_3e2m',
                                                             hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                   wrap(hash(<wrap(method.4), 
                                                                              wrap(suitesI.4), wrap(G_X.4), 
                                                                              wrap(C_I.4), 
                                                                              wrap(ID_CRED_PSK_I.2), EAD_1.4
                                                                             >))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk.2)),
                                       'mac_2',
                                       <~id_r.2, ID_CRED_PSK_I.2, 
                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                         wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >), 
                                        psk_cred(~psk.2), ~EAD_2.4>,
                                       edhoc_mac_length), 
                             ~EAD_2.4>,
                            edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                       wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >),
                                      plaintext_length)), 
                     ~id_r.2>, 
                    m3.4>
  )
  ]->
   [
   State_11211111111111211111111111121211111111111121( ~EAD_4.2, ~Y.2,
                                                       ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4,
                                                       C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                                       plaintext_3.4, suitesI.4
   ),
   State_112111111111112111111111111212111111111111111( ~EAD_4.2, ~Y.2,
                                                        ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4,
                                                        C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                                        plaintext_3.4, suitesI.4
   ),
   Out( aeadenc(~EAD_4.2, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'k_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >)), 
                                           <psk_id(~id_r.2), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                  wrap(hash(<wrap(method.4), 
                                                                                             wrap(suitesI.4), 
                                                                                             wrap(G_X.4), 
                                                                                             wrap(C_I.4), 
                                                                                             wrap(ID_CRED_PSK_I.2), 
                                                                                             EAD_1.4>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.2)),
                                                      'mac_2',
                                                      <~id_r.2, ID_CRED_PSK_I.2, 
                                                       hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                             wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                        wrap(G_X.4), wrap(C_I.4), 
                                                                        wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                            >), 
                                                       psk_cred(~psk.2), ~EAD_2.4>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.4>, 
                                           psk_cred(~psk.2)>)), 
                                plaintext_3.4, psk_cred(~psk.2)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.2)),
                          'iv_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                      wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                 wrap(G_X.4), wrap(C_I.4), 
                                                                 wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                     >)), 
                                           <psk_id(~id_r.2), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                                  wrap(hash(<wrap(method.4), 
                                                                                             wrap(suitesI.4), 
                                                                                             wrap(G_X.4), 
                                                                                             wrap(C_I.4), 
                                                                                             wrap(ID_CRED_PSK_I.2), 
                                                                                             EAD_1.4>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.2)),
                                                      'mac_2',
                                                      <~id_r.2, ID_CRED_PSK_I.2, 
                                                       hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                             wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                        wrap(G_X.4), wrap(C_I.4), 
                                                                        wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                            >), 
                                                       psk_cred(~psk.2), ~EAD_2.4>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.4>, 
                                           psk_cred(~psk.2)>)), 
                                plaintext_3.4, psk_cred(~psk.2)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_11211111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.4^~Y.2),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.2)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                       wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                  wrap(G_X.4), wrap(C_I.4), 
                                                                  wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                      >)), 
                                            <psk_id(~id_r.2), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.4^~Y.2),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.2), 
                                                                                   ~id_r.2, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.4), 
                                                                                              wrap(suitesI.4), 
                                                                                              wrap(G_X.4), 
                                                                                              wrap(C_I.4), 
                                                                                              wrap(ID_CRED_PSK_I.2), 
                                                                                              EAD_1.4
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.2)),
                                                       'mac_2',
                                                       <~id_r.2, ID_CRED_PSK_I.2, 
                                                        hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                              wrap(hash(<wrap(method.4), 
                                                                         wrap(suitesI.4), 
                                                                         wrap(G_X.4), wrap(C_I.4), 
                                                                         wrap(ID_CRED_PSK_I.2), 
                                                                         EAD_1.4>))
                                                             >), 
                                                        psk_cred(~psk.2), ~EAD_2.4>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.4>, 
                                            psk_cred(~psk.2)>)), 
                                 plaintext_3.4, psk_cred(~psk.2)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.2, psk_id(~id_r.2), ~Y.2, G_X.4,
                 <
                  hash(<wrap('g'^~Y.2), ~id_r.2, 
                        wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                   wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                   wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                              wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                  >)), 
                        <psk_id(~id_r.2), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                               wrap(hash(<wrap(method.4), 
                                                                          wrap(suitesI.4), 
                                                                          wrap(G_X.4), wrap(C_I.4), 
                                                                          wrap(ID_CRED_PSK_I.2), 
                                                                          EAD_1.4>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.2)),
                                   'mac_2',
                                   <~id_r.2, ID_CRED_PSK_I.2, 
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >), 
                                    psk_cred(~psk.2), ~EAD_2.4>,
                                   edhoc_mac_length), 
                         ~EAD_2.4>, 
                        psk_cred(~psk.2)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.2), ~id_r.2, 
                                              wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                         wrap(G_X.4), wrap(C_I.4), 
                                                         wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                             >)), 
                                   <psk_id(~id_r.2), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                          wrap(hash(<
                                                                                     wrap(method.4), 
                                                                                     wrap(suitesI.4), 
                                                                                     wrap(G_X.4), 
                                                                                     wrap(C_I.4), 
                                                                                     wrap(ID_CRED_PSK_I.2), 
                                                                                     EAD_1.4>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.2)),
                                              'mac_2',
                                              <~id_r.2, ID_CRED_PSK_I.2, 
                                               hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                     wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                                wrap(G_X.4), wrap(C_I.4), 
                                                                wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                                    >), 
                                               psk_cred(~psk.2), ~EAD_2.4>,
                                              edhoc_mac_length), 
                                    ~EAD_2.4>, 
                                   psk_cred(~psk.2)>)), 
                        plaintext_3.4, psk_cred(~psk.2)>), 
                  suitesI.4, EAD_1.4, ~EAD_2.4, plaintext_3.4, m1.4, 
                  <'g'^~Y.2, 
                   decxor(<psk_id(~id_r.2), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.4^~Y.2),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.2), ~id_r.2, 
                                                                 wrap(hash(<wrap(method.4), 
                                                                            wrap(suitesI.4), 
                                                                            wrap(G_X.4), 
                                                                            wrap(C_I.4), 
                                                                            wrap(ID_CRED_PSK_I.2), 
                                                                            EAD_1.4>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.2)),
                                     'mac_2',
                                     <~id_r.2, ID_CRED_PSK_I.2, 
                                      hash(<wrap('g'^~Y.2), ~id_r.2, 
                                            wrap(hash(<wrap(method.4), wrap(suitesI.4), 
                                                       wrap(G_X.4), wrap(C_I.4), 
                                                       wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                           >), 
                                      psk_cred(~psk.2), ~EAD_2.4>,
                                     edhoc_mac_length), 
                           ~EAD_2.4>,
                          edhoc_kdf(hkdfextract('null', G_X.4^~Y.2), 'keystream_2',
                                    hash(<wrap('g'^~Y.2), ~id_r.2, 
                                          wrap(hash(<wrap(method.4), wrap(suitesI.4), wrap(G_X.4), 
                                                     wrap(C_I.4), wrap(ID_CRED_PSK_I.2), EAD_1.4>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.2>, 
                  m3.4>
);"]:
     [
     State_11211111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i,
                                                      ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1,
                                                      m3, method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >)), 
                                                <psk_id(~id_r), 
                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                 'salt_3e2m',
                                                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                                                       wrap(hash(<
                                                                                                  wrap(method), 
                                                                                                  wrap(suitesI), 
                                                                                                  wrap(G_X), 
                                                                                                  wrap(C_I), 
                                                                                                  wrap(ID_CRED_PSK_I), 
                                                                                                  EAD_1>))
                                                                                      >),
                                                                                 hash_length),
                                                                       psk_cred(~psk)),
                                                           'mac_2',
                                                           <~id_r, ID_CRED_PSK_I, 
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >), 
                                                            psk_cred(~psk), ~EAD_2>,
                                                           edhoc_mac_length), 
                                                 ~EAD_2>, 
                                                psk_cred(~psk)>)), 
                                     plaintext_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r), ~Y, G_X,
                     <
                      hash(<wrap('g'^~Y), ~id_r, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                       wrap(ID_CRED_PSK_I), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                  wrap(ID_CRED_PSK_I), EAD_1>))
                                      >)), 
                            <psk_id(~id_r), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk)),
                                       'mac_2',
                                       <~id_r, ID_CRED_PSK_I, 
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >), 
                                        psk_cred(~psk), ~EAD_2>,
                                       edhoc_mac_length), 
                             ~EAD_2>, 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                             wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                 >)), 
                                       <psk_id(~id_r), 
                                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                                              wrap(hash(<wrap(method), 
                                                                                         wrap(suitesI), 
                                                                                         wrap(G_X), 
                                                                                         wrap(C_I), 
                                                                                         wrap(ID_CRED_PSK_I), 
                                                                                         EAD_1>))
                                                                             >),
                                                                        hash_length),
                                                              psk_cred(~psk)),
                                                  'mac_2',
                                                  <~id_r, ID_CRED_PSK_I, 
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >), 
                                                   psk_cred(~psk), ~EAD_2>,
                                                  edhoc_mac_length), 
                                        ~EAD_2>, 
                                       psk_cred(~psk)>)), 
                            plaintext_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, ~EAD_2, plaintext_3, m1, 
                      <'g'^~Y, 
                       decxor(<psk_id(~id_r), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                               hash(<wrap('g'^~Y), ~id_r, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap(G_X), wrap(C_I), 
                                                                                wrap(ID_CRED_PSK_I), EAD_1>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk)),
                                         'mac_2',
                                         <~id_r, ID_CRED_PSK_I, 
                                          hash(<wrap('g'^~Y), ~id_r, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                               >), 
                                          psk_cred(~psk), ~EAD_2>,
                                         edhoc_mac_length), 
                               ~EAD_2>,
                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        plaintext_length)), 
                       ~id_r>, 
                      m3>
    )
    ]->
     [
     State_11211111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     ),
     State_112111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                          ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                          m1, m3, method, plaintext_3, suitesI
     ),
     Out( aeadenc(~EAD_4, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.32
       G_X   = G_X.40
       z     = G_X.40^~Y.32
    
    2. ~Y    = ~Y.40
       G_X   = z.56^inv(~Y.40)
       z     = z.56
    
    3. ~Y    = ~Y.306
       G_X   = x.604^x.605
       z     = x.604^(~Y.306*x.605)
    
    4. ~Y    = ~Y.314
       G_X   = x.620^inv((~Y.314*x.621))
       z     = x.620^inv(x.621)
    
    5. ~Y    = ~Y.314
       G_X   = x.620^(x.621*inv(~Y.314))
       z     = x.620^x.621
    
    6. ~Y    = ~Y.315
       G_X   = x.621^(x.622*inv((~Y.315*x.623)))
       z     = x.621^(x.622*inv(x.623))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_11211111111111211111111111121211111111111121[color=#408072,
                                                                                       process="event LeakSessionKey( 'null' );"]:
   [
   State_11211111111111211111111111121211111111111121( ~EAD_4.2, ~Y.2,
                                                       ~id_i.2, ~id_r.2, ~psk.2, ID_CRED_PSK_I.2, ~EAD_2.4,
                                                       C_I.4, EAD_1.4, G_X.4, m1.4, m3.4, method.4,
                                                       plaintext_3.4, suitesI.4
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_11211111111111211111111111121211111111111121[color=#408072,
                                                                                          process="event LeakSessionKey( 'null' );"]:
     [
     State_11211111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventPSKGeneratedpsk_0_112111111111[color=#638040,
                                                    process="event PSKGenerated( ~psk.2 );"]:
   [ State_112111111111( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ PSKGenerated( ~psk.2 ) ]->
   [
   State_1121111111111121( ~id_i.2, ~id_r.2, ~psk.2 ),
   State_1121111111111111( ~id_i.2, ~id_r.2, ~psk.2 ),
   State_11211111111112( ~id_i.2, ~id_r.2, ~psk.2 )
   ]

  /*
  rule (modulo AC) eventPSKGeneratedpsk_0_112111111111[color=#638040,
                                                       process="event PSKGenerated( ~psk.2 );"]:
     [ State_112111111111( ~id_i, ~id_r, ~psk ) ]
    --[ PSKGenerated( ~psk ) ]->
     [
     State_1121111111111121( ~id_i, ~id_r, ~psk ),
     State_1121111111111111( ~id_i, ~id_r, ~psk ),
     State_11211111111112( ~id_i, ~id_r, ~psk )
     ]
  */

rule (modulo E) eventCompromisePSKpsk_0_11211111111112[color=#638040,
                                                       process="event CompromisePSK( ~psk.2 );"]:
   [ State_11211111111112( ~id_i.2, ~id_r.2, ~psk.2 ) ]
  --[ CompromisePSK( ~psk.2 ) ]->
   [ Out( ~psk.2 ) ]

  /*
  rule (modulo AC) eventCompromisePSKpsk_0_11211111111112[color=#638040,
                                                          process="event CompromisePSK( ~psk.2 );"]:
     [ State_11211111111112( ~id_i, ~id_r, ~psk ) ]
    --[ CompromisePSK( ~psk ) ]->
     [ Out( ~psk ) ]
  */

rule (modulo E) Init[color=#ffffff, process="System()"]:
   [ ] --[ Init( ) ]-> [ State_121( ), State_1121( ), State_1111( ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) newpsk_0_121[color=#40804e, process="new ~psk.3;"]:
   [ State_121( ), Fr( ~psk.3 ), Fr( ~id_i.3 ), Fr( ~id_r.3 ) ]
  --[ PSKEstablished( ~psk.3, ~id_i.3, ~id_r.3 ) ]->
   [ State_1211111( ~id_i.3, ~id_r.3, ~psk.3 ) ]

  /*
  rule (modulo AC) newpsk_0_121[color=#40804e, process="new ~psk.3;"]:
     [ State_121( ), Fr( ~psk ), Fr( ~id_i ), Fr( ~id_r ) ]
    --[ PSKEstablished( ~psk, ~id_i, ~id_r ) ]->
     [ State_1211111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididi_0_1211111[color=#638040,
                                                 process="event HonestPSK( psk_id(~id_i.3) );"]:
   [ State_1211111( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ HonestPSK( psk_id(~id_i.3) ) ]->
   [ State_12111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididi_0_1211111[color=#638040,
                                                    process="event HonestPSK( psk_id(~id_i.3) );"]:
     [ State_1211111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_i) ) ]->
     [ State_12111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestPSKpskididr_0_12111111[color=#638040,
                                                  process="event HonestPSK( psk_id(~id_r.3) );"]:
   [ State_12111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ HonestPSK( psk_id(~id_r.3) ) ]->
   [ State_121111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]

  /*
  rule (modulo AC) eventHonestPSKpskididr_0_12111111[color=#638040,
                                                     process="event HonestPSK( psk_id(~id_r.3) );"]:
     [ State_12111111( ~id_i, ~id_r, ~psk ) ]
    --[ HonestPSK( psk_id(~id_r) ) ]->
     [ State_121111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididi_0_121111111[color=#638040,
                                                process="event Honest( psk_id(~id_i.3) );"]:
   [ State_121111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ Honest( psk_id(~id_i.3) ) ]->
   [ State_1211111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]

  /*
  rule (modulo AC) eventHonestpskididi_0_121111111[color=#638040,
                                                   process="event Honest( psk_id(~id_i.3) );"]:
     [ State_121111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_i) ) ]->
     [ State_1211111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) eventHonestpskididr_0_1211111111[color=#638040,
                                                 process="event Honest( psk_id(~id_r.3) );"]:
   [ State_1211111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ Honest( psk_id(~id_r.3) ) ]->
   [ State_12111111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]

  /*
  rule (modulo AC) eventHonestpskididr_0_1211111111[color=#638040,
                                                    process="event Honest( psk_id(~id_r.3) );"]:
     [ State_1211111111( ~id_i, ~id_r, ~psk ) ]
    --[ Honest( psk_id(~id_r) ) ]->
     [ State_12111111111( ~id_i, ~id_r, ~psk ) ]
  */

rule (modulo E) inmethodsuitesICIEAD_0_121111111111111[color=#40805e,
                                                       process="in(<method.5, suitesI.5, C_I.5, EAD_1.5>);"]:
   [
   State_121111111111111( ~id_i.3, ~id_r.3, ~psk.3 ),
   In( <method.5, suitesI.5, C_I.5, EAD_1.5> )
   ]
  --[ MethodOk( method.5 ) ]->
   [
   State_12111111111111111( ~id_i.3, ~id_r.3, ~psk.3, C_I.5, EAD_1.5,
                            method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) inmethodsuitesICIEAD_0_121111111111111[color=#40805e,
                                                          process="in(<method.5, suitesI.5, C_I.5, EAD_1.5>);"]:
     [
     State_121111111111111( ~id_i, ~id_r, ~psk ),
     In( <method, suitesI, C_I, EAD_1> )
     ]
    --[ MethodOk( method ) ]->
     [
     State_12111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_12111111111111111[color=#408056,
                                                                  process="event Eq( method.5, method_psk_variant1 );"]:
   [
   State_12111111111111111( ~id_i.3, ~id_r.3, ~psk.3, C_I.5, EAD_1.5,
                            method.5, suitesI.5
   )
   ]
  --[ Eq( method.5, method_psk_variant1 ) ]->
   [
   State_121111111111111111( ~id_i.3, ~id_r.3, ~psk.3, C_I.5, EAD_1.5,
                             method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_12111111111111111[color=#408056,
                                                                     process="event Eq( method.5, method_psk_variant1 );"]:
     [
     State_12111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_121111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_121111111111111111111111[color=#408056,
                                                              process="event LeakShare( 'null' );"]:
   [
   State_121111111111111111111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                   C_I.5, EAD_1.5, method.5, suitesI.5
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_121111111111111111111111[color=#408056,
                                                                 process="event LeakShare( 'null' );"]:
     [
     State_121111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifmethodmethodpskvariant_0_121111111111111111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_121111111111111111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_121111111111111111[color=#408056,
                                                              process="if method.5 = method_psk_variant1"]:
   [
   State_121111111111111111( ~id_i.3, ~id_r.3, ~psk.3, C_I.5, EAD_1.5,
                             method.5, suitesI.5
   ),
   Fr( ~X.3 ), Fr( ~EAD_3.3 )
   ]
  --[
  Share( ~X.3 ),
  Restr_ifmethodmethodpskvariant_0_121111111111111111_1( method.5 )
  ]->
   [
   State_121111111111111111111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                   C_I.5, EAD_1.5, method.5, suitesI.5
   ),
   State_12111111111111111111112( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                  C_I.5, EAD_1.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_121111111111111111[color=#408056,
                                                                 process="if method.5 = method_psk_variant1"]:
     [
     State_121111111111111111( ~id_i, ~id_r, ~psk, C_I, EAD_1, method, suitesI
     ),
     Fr( ~X ), Fr( ~EAD_3 )
     ]
    --[
    Share( ~X ),
    Restr_ifmethodmethodpskvariant_0_121111111111111111_1( method )
    ]->
     [
     State_121111111111111111111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     ),
     State_12111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                    EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventInitiatorStartPSKidipskpskididi_0_12111111111111111111112[color=#408056,
                                                                               process="event InitiatorStart_PSK( ~id_i.3, ~psk.3, psk_id(~id_i.3) );"]:
   [
   State_12111111111111111111112( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                  C_I.5, EAD_1.5, method.5, suitesI.5
   )
   ]
  --[ InitiatorStart_PSK( ~id_i.3, ~psk.3, psk_id(~id_i.3) ) ]->
   [
   State_121111111111111111111121( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                   C_I.5, EAD_1.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventInitiatorStartPSKidipskpskididi_0_12111111111111111111112[color=#408056,
                                                                                  process="event InitiatorStart_PSK( ~id_i.3, ~psk.3, psk_id(~id_i.3) );"]:
     [
     State_12111111111111111111112( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                    EAD_1, method, suitesI
     )
     ]
    --[ InitiatorStart_PSK( ~id_i, ~psk, psk_id(~id_i) ) ]->
     [
     State_121111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididigrpid_0_121111111111111111111121[color=#408056,
                                                                 process="event Neq( psk_id(~id_i.3), grpid );"]:
   [
   State_121111111111111111111121( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3,
                                   C_I.5, EAD_1.5, method.5, suitesI.5
   )
   ]
  --[ Neq( psk_id(~id_i.3), grpid ) ]->
   [
   State_12111111111111111111112111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                     ~psk.3, C_I.5, EAD_1.5, method.5, suitesI.5
   ),
   Out( <method.5, suitesI.5, 'g'^~X.3, C_I.5, psk_id(~id_i.3), EAD_1.5> )
   ]

  /*
  rule (modulo AC) eventNeqpskididigrpid_0_121111111111111111111121[color=#408056,
                                                                    process="event Neq( psk_id(~id_i.3), grpid );"]:
     [
     State_121111111111111111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                     EAD_1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_i), grpid ) ]->
     [
     State_12111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                       EAD_1, method, suitesI
     ),
     Out( <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1> )
     ]
  */

rule (modulo E) inm_0_12111111111111111111112111[color=#408056,
                                                 process="in(m2.5);"]:
   [
   State_12111111111111111111112111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                     ~psk.3, C_I.5, EAD_1.5, method.5, suitesI.5
   ),
   In( m2.5 )
   ]
  -->
   [
   Let_1211111111111111111111211111( m2.5, ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                     ~psk.3, C_I.5, EAD_1.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) inm_0_12111111111111111111112111[color=#408056,
                                                    process="in(m2.5);"]:
     [
     State_12111111111111111111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk, C_I,
                                       EAD_1, method, suitesI
     ),
     In( m2 )
     ]
    -->
     [
     Let_1211111111111111111111211111( m2, ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                       C_I, EAD_1, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letGYCIPHERTEXTCRm_1_121111111111111111111121111[color=#ffffff,
                                                                 process="let <G_Y.5, CIPHERTEXT_2.5, C_R.5>=m2.5"]:
   [
   Let_1211111111111111111111211111( <G_Y.5, CIPHERTEXT_2.5, C_R.5>,
                                     ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3, C_I.5, EAD_1.5, m2.5, method.5,
                                     suitesI.5
   )
   ]
  -->
   [
   State_1211111111111111111111211111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5, G_Y.5, m2.5, method.5,
                                       suitesI.5
   )
   ]

  /*
  rule (modulo AC) letGYCIPHERTEXTCRm_1_121111111111111111111121111[color=#ffffff,
                                                                    process="let <G_Y.5, CIPHERTEXT_2.5, C_R.5>=m2.5"]:
     [
     Let_1211111111111111111111211111( <G_Y, CIPHERTEXT_2, C_R>, ~EAD_3, ~X,
                                       ~id_i, ~id_r, ~psk, C_I, EAD_1, m2, method, suitesI
     )
     ]
    -->
     [
     State_1211111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                         CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_1211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                         process="let <ID_CRED_PSK_R.3, MAC_2.5, EAD_2.5>=decxor(CIPHERTEXT_2.5,
       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                 hash(<wrap(G_Y.5), C_R.5, 
                       wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                  wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                      >),
                 plaintext_length))"]:
   [
   State_1211111111111111111111211111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5, G_Y.5, m2.5, method.5,
                                       suitesI.5
   )
   ]
  -->
   [
   Let_12111111111111111111112111111( decxor(CIPHERTEXT_2.5,
                                             edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                       hash(<wrap(G_Y.5), C_R.5, 
                                                             wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                        wrap('g'^~X.3), wrap(C_I.5), 
                                                                        wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                            >),
                                                       plaintext_length)),
                                      ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                      EAD_1.5, G_Y.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_0_1211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                            process="let <ID_CRED_PSK_R.3, MAC_2.5, EAD_2.5>=decxor(CIPHERTEXT_2.5,
       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                 hash(<wrap(G_Y.5), C_R.5, 
                       wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                  wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                      >),
                 plaintext_length))"]:
     [
     State_1211111111111111111111211111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                         CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2, method, suitesI
     )
     ]
    -->
     [
     Let_12111111111111111111112111111( decxor(CIPHERTEXT_2,
                                               edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                         hash(<wrap(G_Y), C_R, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap('g'^~X), wrap(C_I), 
                                                                          wrap(psk_id(~id_i)), EAD_1>))
                                                              >),
                                                         plaintext_length)),
                                        ~EAD_3, ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y,
                                        m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.30
       G_Y   = G_Y.38
       z     = G_Y.38^~X.30
    
    2. ~X    = ~X.35
       G_Y   = z.48^inv(~X.35)
       z     = z.48
    
    3. ~X    = ~X.114
       G_Y   = x.219^x.220
       z     = x.219^(~X.114*x.220)
    
    4. ~X    = ~X.122
       G_Y   = x.235^inv((~X.122*x.236))
       z     = x.235^inv(x.236)
    
    5. ~X    = ~X.122
       G_Y   = x.235^(x.236*inv(~X.122))
       z     = x.235^x.236
    
    6. ~X    = ~X.123
       G_Y   = x.236^(x.237*inv((~X.123*x.238)))
       z     = x.236^(x.237*inv(x.238))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_1211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                         process="let <ID_CRED_PSK_R.3, MAC_2.5, EAD_2.5>=decxor(CIPHERTEXT_2.5,
       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                 hash(<wrap(G_Y.5), C_R.5, 
                       wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                  wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                      >),
                 plaintext_length))"]:
   [
   Let_12111111111111111111112111111( <ID_CRED_PSK_R.3, MAC_2.5, EAD_2.5>,
                                      ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3, ~psk.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                      EAD_1.5, G_Y.5, m2.5, method.5, suitesI.5
   )
   ]
  -->
   [
   State_12111111111111111111112111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                        ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                        EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) letIDCREDPSKRMACEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlength_1_1211111111111111111111211111[color=#ffffff,
                                                                                                                                                                                                            process="let <ID_CRED_PSK_R.3, MAC_2.5, EAD_2.5>=decxor(CIPHERTEXT_2.5,
       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                 hash(<wrap(G_Y.5), C_R.5, 
                       wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                  wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                      >),
                 plaintext_length))"]:
     [
     Let_12111111111111111111112111111( <ID_CRED_PSK_R, MAC_2, EAD_2>, ~EAD_3,
                                        ~X, ~id_i, ~id_r, ~psk, CIPHERTEXT_2, C_I, C_R, EAD_1, G_Y, m2,
                                        method, suitesI
     )
     ]
    -->
     [
     State_12111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2, m2,
                                          method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGY_0_12111111111111111111112111111[color=#408056,
                                                                  process="event GroupCheck( G_Y.5 );"]:
   [
   State_12111111111111111111112111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                        ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                        EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[ GroupCheck( G_Y.5 ) ]->
   [
   State_121111111111111111111121111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                         ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                         EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGY_0_12111111111111111111112111111[color=#408056,
                                                                     process="event GroupCheck( G_Y.5 );"]:
     [
     State_12111111111111111111112111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                          ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2, m2,
                                          method, suitesI
     )
     ]
    --[ GroupCheck( G_Y ) ]->
     [
     State_121111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                           m2, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGYgrpid_1_121111111111111111111121111111_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGYgrpid_1_121111111111111111111121111111_1( x
     ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGYgrpid_1_121111111111111111111121111111[color=#408056,
                                                                   process="if check_grp(G_Y.5) = grpid"]:
   [
   State_121111111111111111111121111111( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                         ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                         EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[
  Eq( ID_CRED_PSK_R.3, ~id_r.3 ),
  Restr_ifcheckgrpGYgrpid_1_121111111111111111111121111111_1( check_grp(G_Y.5)
  )
  ]->
   [
   State_12111111111111111111112111111121( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                           ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                           EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGYgrpid_1_121111111111111111111121111111[color=#408056,
                                                                      process="if check_grp(G_Y.5) = grpid"]:
     [
     State_121111111111111111111121111111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                           m2, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_R, ~id_r ),
    Restr_ifcheckgrpGYgrpid_1_121111111111111111111121111111_1( check_grp(G_Y)
    )
    ]->
     [
     State_12111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                             m2, method, suitesI
     )
     ]
  */

restriction Restr_ifIDCREDPSKRidr_0_12111111111111111111112111111121_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKRidr_0_12111111111111111111112111111121_1( x, x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKRidr_0_12111111111111111111112111111121[color=#408056,
                                                                   process="if ID_CRED_PSK_R.3 = ~id_r.3"]:
   [
   State_12111111111111111111112111111121( ~EAD_3.3, ~X.3, ~id_i.3, ~id_r.3,
                                           ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5,
                                           EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[
  DerivedIShared_PSK( ~id_i.3, psk_id(~id_i.3), ID_CRED_PSK_R.3,
                      hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                            hash(<wrap(G_Y.5), C_R.5, 
                                                  wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                             wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                 >),
                                            hash_length),
                                  psk_cred(~psk.3)),
                      ~X.3, G_Y.5
  ),
  Restr_ifIDCREDPSKRidr_0_12111111111111111111112111111121_1( ID_CRED_PSK_R.3,
                                                              ~id_r.3
  )
  ]->
   [
   State_1211111111111111111111211111112111( ~EAD_3.3, ~X.3, ~id_i.3,
                                             ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                             EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKRidr_0_12111111111111111111112111111121[color=#408056,
                                                                      process="if ID_CRED_PSK_R.3 = ~id_r.3"]:
     [
     State_12111111111111111111112111111121( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y, MAC_2,
                                             m2, method, suitesI
     )
     ]
    --[
    DerivedIShared_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                        hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                              hash(<wrap(G_Y), C_R, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                               wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk)),
                        ~X, G_Y
    ),
    Restr_ifIDCREDPSKRidr_0_12111111111111111111112111111121_1( ID_CRED_PSK_R,
                                                                ~id_r
    )
    ]->
     [
     State_1211111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                               ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                               MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.35
       G_Y   = G_Y.45
       z     = G_Y.45^~X.35
    
    2. ~X    = ~X.41
       G_Y   = z.57^inv(~X.41)
       z     = z.57
    
    3. ~X    = ~X.132
       G_Y   = x.255^x.256
       z     = x.255^(~X.132*x.256)
    
    4. ~X    = ~X.142
       G_Y   = x.275^inv((~X.142*x.276))
       z     = x.275^inv(x.276)
    
    5. ~X    = ~X.142
       G_Y   = x.275^(x.276*inv(~X.142))
       z     = x.275^x.276
    
    6. ~X    = ~X.143
       G_Y   = x.276^(x.277*inv((~X.143*x.278)))
       z     = x.276^(x.277*inv(x.278))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_1211111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                       process="event Eq( MAC_2.5,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              'mac_2',
              <C_R.5, psk_id(~id_i.3), 
               hash(<wrap(G_Y.5), C_R.5, 
                     wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                    >), 
               psk_cred(~psk.3), EAD_2.5>,
              edhoc_mac_length)
);"]:
   [
   State_1211111111111111111111211111112111( ~EAD_3.3, ~X.3, ~id_i.3,
                                             ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                             EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[
  Eq( MAC_2.5,
      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                      'salt_3e2m',
                                      hash(<wrap(G_Y.5), C_R.5, 
                                            wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                       wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                'mac_2',
                <C_R.5, psk_id(~id_i.3), 
                 hash(<wrap(G_Y.5), C_R.5, 
                       wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), wrap(C_I.5), 
                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                      >), 
                 psk_cred(~psk.3), EAD_2.5>,
                edhoc_mac_length)
  )
  ]->
   [
   State_12111111111111111111112111111121111( ~EAD_3.3, ~X.3, ~id_i.3,
                                              ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                              EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventEqMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_1211111111111111111111211111112111[color=#408056,
                                                                                                                                                                                                                                                                                                                          process="event Eq( MAC_2.5,
    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                    'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              'mac_2',
              <C_R.5, psk_id(~id_i.3), 
               hash(<wrap(G_Y.5), C_R.5, 
                     wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                    >), 
               psk_cred(~psk.3), EAD_2.5>,
              edhoc_mac_length)
);"]:
     [
     State_1211111111111111111111211111112111( ~EAD_3, ~X, ~id_i, ~id_r, ~psk,
                                               ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2, G_Y,
                                               MAC_2, m2, method, suitesI
     )
     ]
    --[
    Eq( MAC_2,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  'mac_2',
                  <C_R, psk_id(~id_i), 
                   hash(<wrap(G_Y), C_R, 
                         wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                    wrap(psk_id(~id_i)), EAD_1>))
                        >), 
                   psk_cred(~psk), EAD_2>,
                  edhoc_mac_length)
    )
    ]->
     [
     State_12111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.35
       G_Y   = G_Y.45
       z     = G_Y.45^~X.35
    
    2. ~X    = ~X.41
       G_Y   = z.57^inv(~X.41)
       z     = z.57
    
    3. ~X    = ~X.158
       G_Y   = x.307^x.308
       z     = x.307^(~X.158*x.308)
    
    4. ~X    = ~X.168
       G_Y   = x.327^inv((~X.168*x.328))
       z     = x.327^inv(x.328)
    
    5. ~X    = ~X.168
       G_Y   = x.327^(x.328*inv(~X.168))
       z     = x.327^x.328
    
    6. ~X    = ~X.169
       G_Y   = x.328^(x.329*inv((~X.169*x.330)))
       z     = x.328^(x.329*inv(x.330))
    
    7. G_Y   = grpid
       z     = grpid
  */

restriction Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111_1:
  "∀ x #NOW x.1.
    (Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111_1( x,
                                                                                                                                                                                                                                                                                                                 x.1
     ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                   process="if MAC_2.5 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                'salt_3e2m',
                                hash(<wrap(G_Y.5), C_R.5, 
                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                 wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                     >),
                                hash_length),
                      psk_cred(~psk.3)),
          'mac_2',
          <C_R.5, psk_id(~id_i.3), 
           hash(<wrap(G_Y.5), C_R.5, 
                 wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                            wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                >), 
           psk_cred(~psk.3), EAD_2.5>,
          edhoc_mac_length)"]:
   [
   State_12111111111111111111112111111121111( ~EAD_3.3, ~X.3, ~id_i.3,
                                              ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5, C_R.5,
                                              EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[
  THIShared_PSK( psk_id(~id_i.3),
                 hash(<
                       wrap(hash(<wrap(G_Y.5), C_R.5, 
                                  wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), wrap(C_I.5), 
                                             wrap(psk_id(~id_i.3)), EAD_1.5>))
                                 >)), 
                       decxor(CIPHERTEXT_2.5,
                              edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                        hash(<wrap(G_Y.5), C_R.5, 
                                              wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                         wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                             >),
                                        plaintext_length)), 
                       psk_cred(~psk.3)>)
  ),
  Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111_1( MAC_2.5,
                                                                                                                                                                                                                                                                                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                          G_Y.5^~X.3),
                                                                                                                                                                                                                                                                                                                                              'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                              hash(<
                                                                                                                                                                                                                                                                                                                                                    wrap(G_Y.5), 
                                                                                                                                                                                                                                                                                                                                                    C_R.5, 
                                                                                                                                                                                                                                                                                                                                                    wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                               wrap(method.5), 
                                                                                                                                                                                                                                                                                                                                                               wrap(suitesI.5), 
                                                                                                                                                                                                                                                                                                                                                               wrap('g'^~X.3), 
                                                                                                                                                                                                                                                                                                                                                               wrap(C_I.5), 
                                                                                                                                                                                                                                                                                                                                                               wrap(psk_id(~id_i.3)), 
                                                                                                                                                                                                                                                                                                                                                               EAD_1.5
                                                                                                                                                                                                                                                                                                                                                              >))
                                                                                                                                                                                                                                                                                                                                                   >),
                                                                                                                                                                                                                                                                                                                                              hash_length),
                                                                                                                                                                                                                                                                                                                                    psk_cred(~psk.3)),
                                                                                                                                                                                                                                                                                                                        'mac_2',
                                                                                                                                                                                                                                                                                                                        <
                                                                                                                                                                                                                                                                                                                         C_R.5, 
                                                                                                                                                                                                                                                                                                                         psk_id(~id_i.3), 
                                                                                                                                                                                                                                                                                                                         hash(<
                                                                                                                                                                                                                                                                                                                               wrap(G_Y.5), 
                                                                                                                                                                                                                                                                                                                               C_R.5, 
                                                                                                                                                                                                                                                                                                                               wrap(hash(<
                                                                                                                                                                                                                                                                                                                                          wrap(method.5), 
                                                                                                                                                                                                                                                                                                                                          wrap(suitesI.5), 
                                                                                                                                                                                                                                                                                                                                          wrap('g'^~X.3), 
                                                                                                                                                                                                                                                                                                                                          wrap(C_I.5), 
                                                                                                                                                                                                                                                                                                                                          wrap(psk_id(~id_i.3)), 
                                                                                                                                                                                                                                                                                                                                          EAD_1.5
                                                                                                                                                                                                                                                                                                                                         >))
                                                                                                                                                                                                                                                                                                                              >), 
                                                                                                                                                                                                                                                                                                                         psk_cred(~psk.3), 
                                                                                                                                                                                                                                                                                                                         EAD_2.5
                                                                                                                                                                                                                                                                                                                        >,
                                                                                                                                                                                                                                                                                                                        edhoc_mac_length)
  )
  ]->
   [
   State_1211111111111111111111211111112111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                suitesI.5
   )
   ]

  /*
  rule (modulo AC) ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111[color=#408056,
                                                                                                                                                                                                                                                                                                                      process="if MAC_2.5 =
edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                'salt_3e2m',
                                hash(<wrap(G_Y.5), C_R.5, 
                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                 wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                     >),
                                hash_length),
                      psk_cred(~psk.3)),
          'mac_2',
          <C_R.5, psk_id(~id_i.3), 
           hash(<wrap(G_Y.5), C_R.5, 
                 wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                            wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                >), 
           psk_cred(~psk.3), EAD_2.5>,
          edhoc_mac_length)"]:
     [
     State_12111111111111111111112111111121111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    THIShared_PSK( psk_id(~id_i),
                   hash(<
                         wrap(hash(<wrap(G_Y), C_R, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                               wrap(psk_id(~id_i)), EAD_1>))
                                   >)), 
                         decxor(CIPHERTEXT_2,
                                edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                          hash(<wrap(G_Y), C_R, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                           wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                               >),
                                          plaintext_length)), 
                         psk_cred(~psk)>)
    ),
    Restr_ifMACedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskmacCRpskididihashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADpskcredpskEADedhocmaclength_0_12111111111111111111112111111121111_1( MAC_2,
                                                                                                                                                                                                                                                                                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                                                                                                                                                                                                                                                                            z),
                                                                                                                                                                                                                                                                                                                                                'salt_3e2m',
                                                                                                                                                                                                                                                                                                                                                hash(<
                                                                                                                                                                                                                                                                                                                                                      wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                                      C_R, 
                                                                                                                                                                                                                                                                                                                                                      wrap(hash(<
                                                                                                                                                                                                                                                                                                                                                                 wrap(method), 
                                                                                                                                                                                                                                                                                                                                                                 wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                                                 wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                                                 wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                                                 wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                                                 EAD_1
                                                                                                                                                                                                                                                                                                                                                                >))
                                                                                                                                                                                                                                                                                                                                                     >),
                                                                                                                                                                                                                                                                                                                                                hash_length),
                                                                                                                                                                                                                                                                                                                                      psk_cred(~psk)),
                                                                                                                                                                                                                                                                                                                          'mac_2',
                                                                                                                                                                                                                                                                                                                          <
                                                                                                                                                                                                                                                                                                                           C_R, 
                                                                                                                                                                                                                                                                                                                           psk_id(~id_i), 
                                                                                                                                                                                                                                                                                                                           hash(<
                                                                                                                                                                                                                                                                                                                                 wrap(G_Y), 
                                                                                                                                                                                                                                                                                                                                 C_R, 
                                                                                                                                                                                                                                                                                                                                 wrap(hash(<
                                                                                                                                                                                                                                                                                                                                            wrap(method), 
                                                                                                                                                                                                                                                                                                                                            wrap(suitesI), 
                                                                                                                                                                                                                                                                                                                                            wrap('g'^~X), 
                                                                                                                                                                                                                                                                                                                                            wrap(C_I), 
                                                                                                                                                                                                                                                                                                                                            wrap(psk_id(~id_i)), 
                                                                                                                                                                                                                                                                                                                                            EAD_1
                                                                                                                                                                                                                                                                                                                                           >))
                                                                                                                                                                                                                                                                                                                                >), 
                                                                                                                                                                                                                                                                                                                           psk_cred(~psk), 
                                                                                                                                                                                                                                                                                                                           EAD_2
                                                                                                                                                                                                                                                                                                                          >,
                                                                                                                                                                                                                                                                                                                          edhoc_mac_length)
    )
    ]->
     [
     State_1211111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                  ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                  G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.36
       G_Y   = G_Y.46
       z     = G_Y.46^~X.36
    
    2. ~X    = ~X.43
       G_Y   = z.60^inv(~X.43)
       z     = z.60
    
    3. ~X    = ~X.187
       G_Y   = x.365^x.366
       z     = x.365^(~X.187*x.366)
    
    4. ~X    = ~X.197
       G_Y   = x.385^inv((~X.197*x.386))
       z     = x.385^inv(x.386)
    
    5. ~X    = ~X.197
       G_Y   = x.385^(x.386*inv(~X.197))
       z     = x.385^x.386
    
    6. ~X    = ~X.198
       G_Y   = x.386^(x.387*inv((~X.198*x.388)))
       z     = x.386^(x.387*inv(x.388))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_1211111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               process="event AcceptI_PSK( ~id_i.3, method_psk_variant1, psk_id(~id_i.3),
             ID_CRED_PSK_R.3,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                   hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                   hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.5), C_R.5, 
                                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                              wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.3)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                              wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.5,
                                               edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.5), C_R.5, 
                                                               wrap(hash(<wrap(method.5), 
                                                                          wrap(suitesI.5), 
                                                                          wrap('g'^~X.3), 
                                                                          wrap(C_I.5), 
                                                                          wrap(psk_id(~id_i.3)), 
                                                                          EAD_1.5>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.3)>)), 
                             ~EAD_3.3, psk_cred(~psk.3)>),
                       hash_length)
);"]:
   [
   State_1211111111111111111111211111112111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                suitesI.5
   )
   ]
  --[
  AcceptI_PSK( ~id_i.3, method_psk_variant1, psk_id(~id_i.3),
               ID_CRED_PSK_R.3,
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                     hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.3)),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                     hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.3)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                               'salt_3e2m',
                                               hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.3)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.5,
                                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                           hash(<wrap(G_Y.5), C_R.5, 
                                                                 wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                            wrap('g'^~X.3), wrap(C_I.5), 
                                                                            wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.3)>)), 
                               ~EAD_3.3, psk_cred(~psk.3)>),
                         hash_length)
  )
  ]->
   [
   State_12111111111111111111112111111121111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                 ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                 C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                 suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventAcceptIPSKidimethodpskvariantpskididiIDCREDPSKRhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_1211111111111111111111211111112111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event AcceptI_PSK( ~id_i.3, method_psk_variant1, psk_id(~id_i.3),
             ID_CRED_PSK_R.3,
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                   hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                   hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                             'salt_3e2m',
                                             hash(<wrap(G_Y.5), C_R.5, 
                                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                              wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.3)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                              wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                  >)), 
                                        decxor(CIPHERTEXT_2.5,
                                               edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                         'keystream_2',
                                                         hash(<wrap(G_Y.5), C_R.5, 
                                                               wrap(hash(<wrap(method.5), 
                                                                          wrap(suitesI.5), 
                                                                          wrap('g'^~X.3), 
                                                                          wrap(C_I.5), 
                                                                          wrap(psk_id(~id_i.3)), 
                                                                          EAD_1.5>))
                                                              >),
                                                         plaintext_length)), 
                                        psk_cred(~psk.3)>)), 
                             ~EAD_3.3, psk_cred(~psk.3)>),
                       hash_length)
);"]:
     [
     State_1211111111111111111111211111112111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                  ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                  G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptI_PSK( ~id_i, method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R,
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y), C_R, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                  wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2,
                                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                             hash(<wrap(G_Y), C_R, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap('g'^~X), wrap(C_I), 
                                                                              wrap(psk_id(~id_i)), EAD_1>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk)>)), 
                                 ~EAD_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_12111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                   G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.35
       G_Y   = G_Y.45
       z     = G_Y.45^~X.35
    
    2. ~X    = ~X.41
       G_Y   = z.57^inv(~X.41)
       z     = z.57
    
    3. ~X    = ~X.186
       G_Y   = x.363^x.364
       z     = x.363^(~X.186*x.364)
    
    4. ~X    = ~X.196
       G_Y   = x.383^inv((~X.196*x.384))
       z     = x.383^inv(x.384)
    
    5. ~X    = ~X.196
       G_Y   = x.383^(x.384*inv(~X.196))
       z     = x.383^x.384
    
    6. ~X    = ~X.197
       G_Y   = x.384^(x.385*inv((~X.197*x.386)))
       z     = x.384^(x.385*inv(x.386))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_12111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event SessionSecrets_I( ~id_i.3, ~X.3, G_Y.5,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.5), C_R.5, 
                                                        wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                   wrap('g'^~X.3), wrap(C_I.5), 
                                                                   wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.3)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                        wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                   wrap('g'^~X.3), wrap(C_I.5), 
                                                                   wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.5,
                                                    edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.5), C_R.5, 
                                                                    wrap(hash(<wrap(method.5), 
                                                                               wrap(suitesI.5), 
                                                                               wrap('g'^~X.3), 
                                                                               wrap(C_I.5), 
                                                                               wrap(psk_id(~id_i.3)), 
                                                                               EAD_1.5>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.3)>)), 
                                  ~EAD_3.3, psk_cred(~psk.3)>),
                            hash_length)
);"]:
   [
   State_12111111111111111111112111111121111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                 ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                 C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                 suitesI.5
   )
   ]
  --[
  SessionSecrets_I( ~id_i.3, ~X.3, G_Y.5,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                    'salt_3e2m',
                                                    hash(<wrap(G_Y.5), C_R.5, 
                                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.3)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                         >)), 
                                               decxor(CIPHERTEXT_2.5,
                                                      edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                                'keystream_2',
                                                                hash(<wrap(G_Y.5), C_R.5, 
                                                                      wrap(hash(<wrap(method.5), 
                                                                                 wrap(suitesI.5), 
                                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                                 wrap(psk_id(~id_i.3)), 
                                                                                 EAD_1.5>))
                                                                     >),
                                                                plaintext_length)), 
                                               psk_cred(~psk.3)>)), 
                                    ~EAD_3.3, psk_cred(~psk.3)>),
                              hash_length)
  )
  ]->
   [
   State_121111111111111111111121111111211111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                  ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                  C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                  suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsIidiXGYedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlength_0_12111111111111111111112111111121111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SessionSecrets_I( ~id_i.3, ~X.3, G_Y.5,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                  'salt_3e2m',
                                                  hash(<wrap(G_Y.5), C_R.5, 
                                                        wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                   wrap('g'^~X.3), wrap(C_I.5), 
                                                                   wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.3)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                        wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                   wrap('g'^~X.3), wrap(C_I.5), 
                                                                   wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2.5,
                                                    edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                              'keystream_2',
                                                              hash(<wrap(G_Y.5), C_R.5, 
                                                                    wrap(hash(<wrap(method.5), 
                                                                               wrap(suitesI.5), 
                                                                               wrap('g'^~X.3), 
                                                                               wrap(C_I.5), 
                                                                               wrap(psk_id(~id_i.3)), 
                                                                               EAD_1.5>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk.3)>)), 
                                  ~EAD_3.3, psk_cred(~psk.3)>),
                            hash_length)
);"]:
     [
     State_12111111111111111111112111111121111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                   G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SessionSecrets_I( ~id_i, ~X, G_Y,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap(G_Y), C_R, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap('g'^~X), wrap(C_I), 
                                                                       wrap(psk_id(~id_i)), EAD_1>))
                                                           >)), 
                                                 decxor(CIPHERTEXT_2,
                                                        edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                  hash(<wrap(G_Y), C_R, 
                                                                        wrap(hash(<wrap(method), 
                                                                                   wrap(suitesI), 
                                                                                   wrap('g'^~X), wrap(C_I), 
                                                                                   wrap(psk_id(~id_i)), EAD_1
                                                                                  >))
                                                                       >),
                                                                  plaintext_length)), 
                                                 psk_cred(~psk)>)), 
                                      ~EAD_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_121111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                    G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.35
       G_Y   = G_Y.45
       z     = G_Y.45^~X.35
    
    2. ~X    = ~X.41
       G_Y   = z.57^inv(~X.41)
       z     = z.57
    
    3. ~X    = ~X.186
       G_Y   = x.363^x.364
       z     = x.363^(~X.186*x.364)
    
    4. ~X    = ~X.196
       G_Y   = x.383^inv((~X.196*x.384))
       z     = x.383^inv(x.384)
    
    5. ~X    = ~X.196
       G_Y   = x.383^(x.384*inv(~X.196))
       z     = x.383^x.384
    
    6. ~X    = ~X.197
       G_Y   = x.384^(x.385*inv((~X.197*x.386)))
       z     = x.384^(x.385*inv(x.386))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_121111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               process="event SecretsI_PSK( ~id_i.3, psk_id(~id_i.3), ID_CRED_PSK_R.3,
              hkdfextract('null', G_Y.5^~X.3),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.5,
                                                edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.3)>)), 
                              ~EAD_3.3, psk_cred(~psk.3)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                        hash(<wrap(G_Y.5), C_R.5, 
                              wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                         wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >)), 
                              decxor(CIPHERTEXT_2.5,
                                     edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                               hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.3)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >)), 
                              decxor(CIPHERTEXT_2.5,
                                     edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                               hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.3)>),
                        iv_length),
              ~X.3, G_Y.5
);"]:
   [
   State_121111111111111111111121111111211111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                  ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                  C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                  suitesI.5
   )
   ]
  --[
  SecretsI_PSK( ~id_i.3, psk_id(~id_i.3), ID_CRED_PSK_R.3,
                hkdfextract('null', G_Y.5^~X.3),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                      hash(<wrap(G_Y.5), C_R.5, 
                                            wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                       wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                      hash(<wrap(G_Y.5), C_R.5, 
                                            wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                       wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >)), 
                                           decxor(CIPHERTEXT_2.5,
                                                  edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                            hash(<wrap(G_Y.5), C_R.5, 
                                                                  wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                             wrap('g'^~X.3), wrap(C_I.5), 
                                                                             wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                                 >),
                                                            plaintext_length)), 
                                           psk_cred(~psk.3)>)), 
                                ~EAD_3.3, psk_cred(~psk.3)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                          hash(<wrap(G_Y.5), C_R.5, 
                                wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), wrap(C_I.5), 
                                           wrap(psk_id(~id_i.3)), EAD_1.5>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >)), 
                                decxor(CIPHERTEXT_2.5,
                                       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.3)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >)), 
                                decxor(CIPHERTEXT_2.5,
                                       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.3)>),
                          iv_length),
                ~X.3, G_Y.5
  )
  ]->
   [
   State_1211111111111111111111211111112111111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                   ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                   C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                   suitesI.5
   )
   ]

  /*
  rule (modulo AC) eventSecretsIPSKidipskididiIDCREDPSKRhkdfextractnullGYXhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlengthXGY_0_121111111111111111111121111111211111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event SecretsI_PSK( ~id_i.3, psk_id(~id_i.3), ID_CRED_PSK_R.3,
              hkdfextract('null', G_Y.5^~X.3),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'salt_3e2m',
                                    hash(<wrap(G_Y.5), C_R.5, 
                                          wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >)), 
                                         decxor(CIPHERTEXT_2.5,
                                                edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'keystream_2',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          plaintext_length)), 
                                         psk_cred(~psk.3)>)), 
                              ~EAD_3.3, psk_cred(~psk.3)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                        hash(<wrap(G_Y.5), C_R.5, 
                              wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                         wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >)), 
                              decxor(CIPHERTEXT_2.5,
                                     edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                               hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.3)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                              'salt_3e2m',
                                              hash(<wrap(G_Y.5), C_R.5, 
                                                    wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                               wrap('g'^~X.3), wrap(C_I.5), 
                                                               wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap(G_Y.5), C_R.5, 
                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                        >)), 
                              decxor(CIPHERTEXT_2.5,
                                     edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                               hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >),
                                               plaintext_length)), 
                              psk_cred(~psk.3)>),
                        iv_length),
              ~X.3, G_Y.5
);"]:
     [
     State_121111111111111111111121111111211111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1, EAD_2,
                                                    G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    SecretsI_PSK( ~id_i, psk_id(~id_i), ID_CRED_PSK_R,
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap(G_Y), C_R, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                         wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >)), 
                                             decxor(CIPHERTEXT_2,
                                                    edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              plaintext_length)), 
                                             psk_cred(~psk)>)), 
                                  ~EAD_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap(G_Y), C_R, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                             wrap(psk_id(~id_i)), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~X, G_Y
    )
    ]->
     [
     State_1211111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1,
                                                     EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.35
       G_Y   = G_Y.45
       z     = G_Y.45^~X.35
    
    2. ~X    = ~X.41
       G_Y   = z.57^inv(~X.41)
       z     = z.57
    
    3. ~X    = ~X.248
       G_Y   = x.487^x.488
       z     = x.487^(~X.248*x.488)
    
    4. ~X    = ~X.258
       G_Y   = x.507^inv((~X.258*x.508))
       z     = x.507^inv(x.508)
    
    5. ~X    = ~X.258
       G_Y   = x.507^(x.508*inv(~X.258))
       z     = x.507^x.508
    
    6. ~X    = ~X.259
       G_Y   = x.508^(x.509*inv((~X.259*x.510)))
       z     = x.508^(x.509*inv(x.510))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_1211111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.5^~X.3),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.3)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.5,
                                                   edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.5), C_R.5, 
                                                                   wrap(hash(<wrap(method.5), 
                                                                              wrap(suitesI.5), 
                                                                              wrap('g'^~X.3), 
                                                                              wrap(C_I.5), 
                                                                              wrap(psk_id(~id_i.3)), 
                                                                              EAD_1.5>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.3)>)), 
                                 ~EAD_3.3, psk_cred(~psk.3)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.3), ID_CRED_PSK_R.3, ~X.3, G_Y.5,
                 <
                  hash(<wrap(G_Y.5), C_R.5, 
                        wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                   wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.5), C_R.5, 
                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                              wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                  >)), 
                        decxor(CIPHERTEXT_2.5,
                               edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                         hash(<wrap(G_Y.5), C_R.5, 
                                               wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                          wrap('g'^~X.3), wrap(C_I.5), 
                                                          wrap(psk_id(~id_i.3)), EAD_1.5>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.3)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.5), C_R.5, 
                                              wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                         wrap('g'^~X.3), wrap(C_I.5), 
                                                         wrap(psk_id(~id_i.3)), EAD_1.5>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.5,
                                          edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                    hash(<wrap(G_Y.5), C_R.5, 
                                                          wrap(hash(<wrap(method.5), 
                                                                     wrap(suitesI.5), 
                                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                                     wrap(psk_id(~id_i.3)), EAD_1.5
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.3)>)), 
                        ~EAD_3.3, psk_cred(~psk.3)>), 
                  suitesI.5, EAD_1.5, EAD_2.5, ~EAD_3.3, 
                  <method.5, suitesI.5, 'g'^~X.3, C_I.5, psk_id(~id_i.3), EAD_1.5>, 
                  m2.5, 
                  aeadenc(~EAD_3.3, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.3)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.5,
                                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.5), C_R.5, 
                                                                 wrap(hash(<wrap(method.5), 
                                                                            wrap(suitesI.5), 
                                                                            wrap('g'^~X.3), 
                                                                            wrap(C_I.5), 
                                                                            wrap(psk_id(~id_i.3)), 
                                                                            EAD_1.5>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.3)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.3)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.5,
                                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.5), C_R.5, 
                                                                 wrap(hash(<wrap(method.5), 
                                                                            wrap(suitesI.5), 
                                                                            wrap('g'^~X.3), 
                                                                            wrap(C_I.5), 
                                                                            wrap(psk_id(~id_i.3)), 
                                                                            EAD_1.5>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.3)>),
                                    iv_length))
                 >
);"]:
   [
   State_1211111111111111111111211111112111111111( ~EAD_3.3, ~X.3, ~id_i.3,
                                                   ~id_r.3, ~psk.3, ID_CRED_PSK_R.3, CIPHERTEXT_2.5, C_I.5,
                                                   C_R.5, EAD_1.5, EAD_2.5, G_Y.5, MAC_2.5, m2.5, method.5,
                                                   suitesI.5
   )
   ]
  --[
  AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_Y.5^~X.3),
                                                   'salt_3e2m',
                                                   hash(<wrap(G_Y.5), C_R.5, 
                                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.3)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                         wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                    wrap('g'^~X.3), wrap(C_I.5), 
                                                                    wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2.5,
                                                     edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                               hash(<wrap(G_Y.5), C_R.5, 
                                                                     wrap(hash(<wrap(method.5), 
                                                                                wrap(suitesI.5), 
                                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                                wrap(psk_id(~id_i.3)), EAD_1.5
                                                                               >))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk.3)>)), 
                                   ~EAD_3.3, psk_cred(~psk.3)>),
                             hash_length),
                   method_psk_variant1, psk_id(~id_i.3), ID_CRED_PSK_R.3, ~X.3, G_Y.5,
                   <
                    hash(<wrap(G_Y.5), C_R.5, 
                          wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), wrap(C_I.5), 
                                     wrap(psk_id(~id_i.3)), EAD_1.5>))
                         >), 
                    hash(<
                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), wrap(C_I.5), 
                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                    >)), 
                          decxor(CIPHERTEXT_2.5,
                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                           hash(<wrap(G_Y.5), C_R.5, 
                                                 wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                            wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                >),
                                           plaintext_length)), 
                          psk_cred(~psk.3)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                           wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                               >)), 
                                     decxor(CIPHERTEXT_2.5,
                                            edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                      hash(<wrap(G_Y.5), C_R.5, 
                                                            wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                       wrap('g'^~X.3), wrap(C_I.5), 
                                                                       wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                           >),
                                                      plaintext_length)), 
                                     psk_cred(~psk.3)>)), 
                          ~EAD_3.3, psk_cred(~psk.3)>), 
                    suitesI.5, EAD_1.5, EAD_2.5, ~EAD_3.3, 
                    <method.5, suitesI.5, 'g'^~X.3, C_I.5, psk_id(~id_i.3), EAD_1.5>, m2.5, 
                    aeadenc(~EAD_3.3, 'rep',
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.5), C_R.5, 
                                                                  wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                             wrap('g'^~X.3), wrap(C_I.5), 
                                                                             wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.3)),
                                      'k_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.5,
                                                   edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                             hash(<wrap(G_Y.5), C_R.5, 
                                                                   wrap(hash(<wrap(method.5), 
                                                                              wrap(suitesI.5), 
                                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                                              wrap(psk_id(~id_i.3)), EAD_1.5
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.3)>),
                                      key_length),
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                            'salt_3e2m',
                                                            hash(<wrap(G_Y.5), C_R.5, 
                                                                  wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                             wrap('g'^~X.3), wrap(C_I.5), 
                                                                             wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk.3)),
                                      'iv_3',
                                      hash(<
                                            wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.5,
                                                   edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                             hash(<wrap(G_Y.5), C_R.5, 
                                                                   wrap(hash(<wrap(method.5), 
                                                                              wrap(suitesI.5), 
                                                                              wrap('g'^~X.3), wrap(C_I.5), 
                                                                              wrap(psk_id(~id_i.3)), EAD_1.5
                                                                             >))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.3)>),
                                      iv_length))
                   >
  )
  ]->
   [
   State_1211111111111111111111211111112111111111111( ~EAD_3.3, ~X.3,
                                                      ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_R.3,
                                                      CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5, EAD_2.5, G_Y.5,
                                                      MAC_2.5, m2.5, method.5, suitesI.5
   ),
   Out( aeadenc(~EAD_3.3, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >)), 
                                decxor(CIPHERTEXT_2.5,
                                       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.3)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                'salt_3e2m',
                                                hash(<wrap(G_Y.5), C_R.5, 
                                                      wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                 wrap('g'^~X.3), wrap(C_I.5), 
                                                                 wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap(G_Y.5), C_R.5, 
                                           wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                                      wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                          >)), 
                                decxor(CIPHERTEXT_2.5,
                                       edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 plaintext_length)), 
                                psk_cred(~psk.3)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptIDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskprkouthashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpskhashlengthmethodpskvariantpskididiIDCREDPSKRXGYhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskhashwraphashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskEADpskcredpsksuitesIEADEADEADmethodsuitesIgXCIpskididiEADmaeadencEADrepedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskkhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGYXsaltemhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADhashlengthpskcredpskivhashwraphashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADdecxorCIPHERTEXTedhockdfhkdfextractnullGYXkeystreamhashwrapGYCRwraphashwrapmethodwrapsuitesIwrapgXwrapCIwrappskididiEADplaintextlengthpskcredpskivlength_0_1211111111111111111111211111112111111111[color=#408056,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_Y.5^~X.3),
                                                 'salt_3e2m',
                                                 hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.3)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                       wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                  wrap('g'^~X.3), wrap(C_I.5), 
                                                                  wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                      >)), 
                                            decxor(CIPHERTEXT_2.5,
                                                   edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                             'keystream_2',
                                                             hash(<wrap(G_Y.5), C_R.5, 
                                                                   wrap(hash(<wrap(method.5), 
                                                                              wrap(suitesI.5), 
                                                                              wrap('g'^~X.3), 
                                                                              wrap(C_I.5), 
                                                                              wrap(psk_id(~id_i.3)), 
                                                                              EAD_1.5>))
                                                                  >),
                                                             plaintext_length)), 
                                            psk_cred(~psk.3)>)), 
                                 ~EAD_3.3, psk_cred(~psk.3)>),
                           hash_length),
                 method_psk_variant1, psk_id(~id_i.3), ID_CRED_PSK_R.3, ~X.3, G_Y.5,
                 <
                  hash(<wrap(G_Y.5), C_R.5, 
                        wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                   wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                       >), 
                  hash(<
                        wrap(hash(<wrap(G_Y.5), C_R.5, 
                                   wrap(hash(<wrap(method.5), wrap(suitesI.5), wrap('g'^~X.3), 
                                              wrap(C_I.5), wrap(psk_id(~id_i.3)), EAD_1.5>))
                                  >)), 
                        decxor(CIPHERTEXT_2.5,
                               edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                         hash(<wrap(G_Y.5), C_R.5, 
                                               wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                          wrap('g'^~X.3), wrap(C_I.5), 
                                                          wrap(psk_id(~id_i.3)), EAD_1.5>))
                                              >),
                                         plaintext_length)), 
                        psk_cred(~psk.3)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap(G_Y.5), C_R.5, 
                                              wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                         wrap('g'^~X.3), wrap(C_I.5), 
                                                         wrap(psk_id(~id_i.3)), EAD_1.5>))
                                             >)), 
                                   decxor(CIPHERTEXT_2.5,
                                          edhoc_kdf(hkdfextract('null', G_Y.5^~X.3), 'keystream_2',
                                                    hash(<wrap(G_Y.5), C_R.5, 
                                                          wrap(hash(<wrap(method.5), 
                                                                     wrap(suitesI.5), 
                                                                     wrap('g'^~X.3), wrap(C_I.5), 
                                                                     wrap(psk_id(~id_i.3)), EAD_1.5
                                                                    >))
                                                         >),
                                                    plaintext_length)), 
                                   psk_cred(~psk.3)>)), 
                        ~EAD_3.3, psk_cred(~psk.3)>), 
                  suitesI.5, EAD_1.5, EAD_2.5, ~EAD_3.3, 
                  <method.5, suitesI.5, 'g'^~X.3, C_I.5, psk_id(~id_i.3), EAD_1.5>, 
                  m2.5, 
                  aeadenc(~EAD_3.3, 'rep',
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.3)),
                                    'k_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.5,
                                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.5), C_R.5, 
                                                                 wrap(hash(<wrap(method.5), 
                                                                            wrap(suitesI.5), 
                                                                            wrap('g'^~X.3), 
                                                                            wrap(C_I.5), 
                                                                            wrap(psk_id(~id_i.3)), 
                                                                            EAD_1.5>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.3)>),
                                    key_length),
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                          'salt_3e2m',
                                                          hash(<wrap(G_Y.5), C_R.5, 
                                                                wrap(hash(<wrap(method.5), 
                                                                           wrap(suitesI.5), 
                                                                           wrap('g'^~X.3), 
                                                                           wrap(C_I.5), 
                                                                           wrap(psk_id(~id_i.3)), 
                                                                           EAD_1.5>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.3)),
                                    'iv_3',
                                    hash(<
                                          wrap(hash(<wrap(G_Y.5), C_R.5, 
                                                     wrap(hash(<wrap(method.5), wrap(suitesI.5), 
                                                                wrap('g'^~X.3), wrap(C_I.5), 
                                                                wrap(psk_id(~id_i.3)), EAD_1.5>))
                                                    >)), 
                                          decxor(CIPHERTEXT_2.5,
                                                 edhoc_kdf(hkdfextract('null', G_Y.5^~X.3),
                                                           'keystream_2',
                                                           hash(<wrap(G_Y.5), C_R.5, 
                                                                 wrap(hash(<wrap(method.5), 
                                                                            wrap(suitesI.5), 
                                                                            wrap('g'^~X.3), 
                                                                            wrap(C_I.5), 
                                                                            wrap(psk_id(~id_i.3)), 
                                                                            EAD_1.5>))
                                                                >),
                                                           plaintext_length)), 
                                          psk_cred(~psk.3)>),
                                    iv_length))
                 >
);"]:
     [
     State_1211111111111111111111211111112111111111( ~EAD_3, ~X, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R, EAD_1,
                                                     EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[
    AcceptIData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap(G_Y), C_R, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), 
                                                                      wrap('g'^~X), wrap(C_I), 
                                                                      wrap(psk_id(~id_i)), EAD_1>))
                                                          >)), 
                                                decxor(CIPHERTEXT_2,
                                                       edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                                 hash(<wrap(G_Y), C_R, 
                                                                       wrap(hash(<wrap(method), 
                                                                                  wrap(suitesI), 
                                                                                  wrap('g'^~X), wrap(C_I), 
                                                                                  wrap(psk_id(~id_i)), EAD_1
                                                                                 >))
                                                                      >),
                                                                 plaintext_length)), 
                                                psk_cred(~psk)>)), 
                                     ~EAD_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, psk_id(~id_i), ID_CRED_PSK_R, ~X, G_Y,
                     <
                      hash(<wrap(G_Y), C_R, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                       wrap(psk_id(~id_i)), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap(G_Y), C_R, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                  wrap(psk_id(~id_i)), EAD_1>))
                                      >)), 
                            decxor(CIPHERTEXT_2,
                                   edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                             hash(<wrap(G_Y), C_R, 
                                                   wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                              wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                  >),
                                             plaintext_length)), 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap(G_Y), C_R, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                             wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                 >)), 
                                       decxor(CIPHERTEXT_2,
                                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                        hash(<wrap(G_Y), C_R, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap('g'^~X), wrap(C_I), 
                                                                         wrap(psk_id(~id_i)), EAD_1>))
                                                             >),
                                                        plaintext_length)), 
                                       psk_cred(~psk)>)), 
                            ~EAD_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, EAD_2, ~EAD_3, 
                      <method, suitesI, 'g'^~X, C_I, psk_id(~id_i), EAD_1>, m2, 
                      aeadenc(~EAD_3, 'rep',
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'k_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        key_length),
                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                              hash(<wrap(G_Y), C_R, 
                                                                    wrap(hash(<wrap(method), wrap(suitesI), 
                                                                               wrap('g'^~X), wrap(C_I), 
                                                                               wrap(psk_id(~id_i)), EAD_1>))
                                                                   >),
                                                              hash_length),
                                                    psk_cred(~psk)),
                                        'iv_3',
                                        hash(<
                                              wrap(hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >)), 
                                              decxor(CIPHERTEXT_2,
                                                     edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                               hash(<wrap(G_Y), C_R, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap('g'^~X), wrap(C_I), 
                                                                                wrap(psk_id(~id_i)), EAD_1>))
                                                                    >),
                                                               plaintext_length)), 
                                              psk_cred(~psk)>),
                                        iv_length))
                     >
    )
    ]->
     [
     State_1211111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                        ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                        EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     ),
     Out( aeadenc(~EAD_3, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap(G_Y), C_R, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), 
                                                                   wrap(C_I), wrap(psk_id(~id_i)), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap(G_Y), C_R, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap('g'^~X), wrap(C_I), 
                                                        wrap(psk_id(~id_i)), EAD_1>))
                                            >)), 
                                  decxor(CIPHERTEXT_2,
                                         edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                                   hash(<wrap(G_Y), C_R, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), 
                                                                    wrap('g'^~X), wrap(C_I), 
                                                                    wrap(psk_id(~id_i)), EAD_1>))
                                                        >),
                                                   plaintext_length)), 
                                  psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~X    = ~X.36
       G_Y   = G_Y.46
       z     = G_Y.46^~X.36
    
    2. ~X    = ~X.43
       G_Y   = z.60^inv(~X.43)
       z     = z.60
    
    3. ~X    = ~X.283
       G_Y   = x.557^x.558
       z     = x.557^(~X.283*x.558)
    
    4. ~X    = ~X.293
       G_Y   = x.577^inv((~X.293*x.578))
       z     = x.577^inv(x.578)
    
    5. ~X    = ~X.293
       G_Y   = x.577^(x.578*inv(~X.293))
       z     = x.577^x.578
    
    6. ~X    = ~X.294
       G_Y   = x.578^(x.579*inv((~X.294*x.580)))
       z     = x.578^(x.579*inv(x.580))
    
    7. G_Y   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_1211111111111111111111211111112111111111111[color=#408079,
                                                                                      process="event LeakSessionKey( 'null' );"]:
   [
   State_1211111111111111111111211111112111111111111( ~EAD_3.3, ~X.3,
                                                      ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_R.3,
                                                      CIPHERTEXT_2.5, C_I.5, C_R.5, EAD_1.5, EAD_2.5, G_Y.5,
                                                      MAC_2.5, m2.5, method.5, suitesI.5
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_1211111111111111111111211111112111111111111[color=#408079,
                                                                                         process="event LeakSessionKey( 'null' );"]:
     [
     State_1211111111111111111111211111112111111111111( ~EAD_3, ~X, ~id_i,
                                                        ~id_r, ~psk, ID_CRED_PSK_R, CIPHERTEXT_2, C_I, C_R,
                                                        EAD_1, EAD_2, G_Y, MAC_2, m2, method, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) inm_0_121111111111121[color=#408057,
                                      process="in(m1.6);"]:
   [ State_121111111111121( ~id_i.3, ~id_r.3, ~psk.3 ), In( m1.6 ) ]
  -->
   [ Let_12111111111112111( m1.6, ~id_i.3, ~id_r.3, ~psk.3, m1.6 ) ]

  /*
  rule (modulo AC) inm_0_121111111111121[color=#408057,
                                         process="in(m1.6);"]:
     [ State_121111111111121( ~id_i, ~id_r, ~psk ), In( m1 ) ]
    -->
     [ Let_12111111111112111( m1, ~id_i, ~id_r, ~psk, m1 ) ]
  */

rule (modulo E) letmethodsuitesIGXCIIDCREDPSKIEADm_1_1211111111111211[color=#ffffff,
                                                                      process="let <method.6, suitesI.6, G_X.6, C_I.6, ID_CRED_PSK_I.3, EAD_1.6>=m1.6"]:
   [
   Let_12111111111112111( <method.6, suitesI.6, G_X.6, C_I.6, 
                           ID_CRED_PSK_I.3, EAD_1.6>,
                          ~id_i.3, ~id_r.3, ~psk.3, m1.6
   )
   ]
  -->
   [
   State_12111111111112111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                            C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) letmethodsuitesIGXCIIDCREDPSKIEADm_1_1211111111111211[color=#ffffff,
                                                                         process="let <method.6, suitesI.6, G_X.6, C_I.6, ID_CRED_PSK_I.3, EAD_1.6>=m1.6"]:
     [
     Let_12111111111112111( <method, suitesI, G_X, C_I, ID_CRED_PSK_I, EAD_1>,
                            ~id_i, ~id_r, ~psk, m1
     )
     ]
    -->
     [
     State_12111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                              G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventMethodOkmethod_0_12111111111112111[color=#408048,
                                                        process="event MethodOk( method.6 );"]:
   [
   State_12111111111112111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                            C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]
  --[ MethodOk( method.6 ) ]->
   [
   State_121111111111121111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                             C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventMethodOkmethod_0_12111111111112111[color=#408048,
                                                           process="event MethodOk( method.6 );"]:
     [
     State_12111111111112111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                              G_X, m1, method, suitesI
     )
     ]
    --[ MethodOk( method ) ]->
     [
     State_121111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventEqmethodmethodpskvariant_0_121111111111121111[color=#408048,
                                                                   process="event Eq( method.6, method_psk_variant1 );"]:
   [
   State_121111111111121111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                             C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]
  --[ Eq( method.6, method_psk_variant1 ) ]->
   [
   State_1211111111111211111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                              C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventEqmethodmethodpskvariant_0_121111111111121111[color=#408048,
                                                                      process="event Eq( method.6, method_psk_variant1 );"]:
     [
     State_121111111111121111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                               G_X, m1, method, suitesI
     )
     ]
    --[ Eq( method, method_psk_variant1 ) ]->
     [
     State_1211111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifmethodmethodpskvariant_0_1211111111111211111_1:
  "∀ x #NOW.
    (Restr_ifmethodmethodpskvariant_0_1211111111111211111_1( x ) @ #NOW) ⇒
    (x = method_psk_variant1)"
  // safety formula

rule (modulo E) ifmethodmethodpskvariant_0_1211111111111211111[color=#408048,
                                                               process="if method.6 = method_psk_variant1"]:
   [
   State_1211111111111211111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                              C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]
  --[
  Eq( ID_CRED_PSK_I.3, ~id_i.3 ),
  Restr_ifmethodmethodpskvariant_0_1211111111111211111_1( method.6 )
  ]->
   [
   State_121111111111121111111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                                C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) ifmethodmethodpskvariant_0_1211111111111211111[color=#408048,
                                                                  process="if method.6 = method_psk_variant1"]:
     [
     State_1211111111111211111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I, EAD_1,
                                G_X, m1, method, suitesI
     )
     ]
    --[
    Eq( ID_CRED_PSK_I, ~id_i ),
    Restr_ifmethodmethodpskvariant_0_1211111111111211111_1( method )
    ]->
     [
     State_121111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                  EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventLeakSharenull_0_1211111111111211111111111111[color=#40804f,
                                                                  process="event LeakShare( 'null' );"]:
   [
   State_1211111111111211111111111111( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                       method.6, suitesI.6
   )
   ]
  --[ LeakShare( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSharenull_0_1211111111111211111111111111[color=#40804f,
                                                                     process="event LeakShare( 'null' );"]:
     [
     State_1211111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ LeakShare( 'null' ) ]->
     [ ]
  */

restriction Restr_ifIDCREDPSKIidi_0_121111111111121111111_1:
  "∀ x #NOW x.1.
    (Restr_ifIDCREDPSKIidi_0_121111111111121111111_1( x, x.1 ) @ #NOW) ⇒
    (x = x.1)"
  // safety formula

rule (modulo E) ifIDCREDPSKIidi_0_121111111111121111111[color=#408048,
                                                        process="if ID_CRED_PSK_I.3 = ~id_i.3"]:
   [
   State_121111111111121111111( ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                                C_I.6, EAD_1.6, G_X.6, m1.6, method.6, suitesI.6
   ),
   Fr( ~Y.3 ), Fr( ~EAD_2.6 ), Fr( ~EAD_4.3 )
   ]
  --[
  Share( ~Y.3 ),
  Restr_ifIDCREDPSKIidi_0_121111111111121111111_1( ID_CRED_PSK_I.3, ~id_i.3
  )
  ]->
   [
   State_1211111111111211111111111111( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                       method.6, suitesI.6
   ),
   State_121111111111121111111111112( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                      ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                      method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) ifIDCREDPSKIidi_0_121111111111121111111[color=#408048,
                                                           process="if ID_CRED_PSK_I.3 = ~id_i.3"]:
     [
     State_121111111111121111111( ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, C_I,
                                  EAD_1, G_X, m1, method, suitesI
     ),
     Fr( ~Y ), Fr( ~EAD_2 ), Fr( ~EAD_4 )
     ]
    --[
    Share( ~Y ),
    Restr_ifIDCREDPSKIidi_0_121111111111121111111_1( ID_CRED_PSK_I, ~id_i )
    ]->
     [
     State_1211111111111211111111111111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     ),
     State_121111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                        ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventGroupCheckGX_0_121111111111121111111111112[color=#408048,
                                                                process="event GroupCheck( G_X.6 );"]:
   [
   State_121111111111121111111111112( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                      ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                      method.6, suitesI.6
   )
   ]
  --[ GroupCheck( G_X.6 ) ]->
   [
   State_1211111111111211111111111121( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                       method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventGroupCheckGX_0_121111111111121111111111112[color=#408048,
                                                                   process="event GroupCheck( G_X.6 );"]:
     [
     State_121111111111121111111111112( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                        ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ GroupCheck( G_X ) ]->
     [
     State_1211111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

restriction Restr_ifcheckgrpGXgrpid_1_1211111111111211111111111121_1:
  "∀ x #NOW.
    (Restr_ifcheckgrpGXgrpid_1_1211111111111211111111111121_1( x ) @ #NOW) ⇒
    (¬(x = grpid))"
  // safety formula

rule (modulo E) ifcheckgrpGXgrpid_1_1211111111111211111111111121[color=#408048,
                                                                 process="if check_grp(G_X.6) = grpid"]:
   [
   State_1211111111111211111111111121( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                       ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                       method.6, suitesI.6
   )
   ]
  --[
  DerivedR_PSK( ~id_r.3, ID_CRED_PSK_I.3, psk_id(~id_r.3),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                       wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                ~Y.3, G_X.6
  ),
  Restr_ifcheckgrpGXgrpid_1_1211111111111211111111111121_1( check_grp(G_X.6)
  )
  ]->
   [
   State_121111111111121111111111112121( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                         ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                         method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) ifcheckgrpGXgrpid_1_1211111111111211111111111121[color=#408048,
                                                                    process="if check_grp(G_X.6) = grpid"]:
     [
     State_1211111111111211111111111121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                         ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    DerivedR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  ~Y, G_X
    ),
    Restr_ifcheckgrpGXgrpid_1_1211111111111211111111111121_1( check_grp(G_X)
    )
    ]->
     [
     State_121111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.31
       G_X   = G_X.39
       z     = G_X.39^~Y.31
    
    2. ~Y    = ~Y.36
       G_X   = z.49^inv(~Y.36)
       z     = z.49
    
    3. ~Y    = ~Y.115
       G_X   = x.220^x.221
       z     = x.220^(~Y.115*x.221)
    
    4. ~Y    = ~Y.123
       G_X   = x.236^inv((~Y.123*x.237))
       z     = x.236^inv(x.237)
    
    5. ~Y    = ~Y.123
       G_X   = x.236^(x.237*inv(~Y.123))
       z     = x.236^x.237
    
    6. ~Y    = ~Y.124
       G_X   = x.237^(x.238*inv((~Y.124*x.239)))
       z     = x.237^(x.238*inv(x.239))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventResponderStartPSKidrpskIDCREDPSKI_0_121111111111121111111111112121[color=#408048,
                                                                                        process="event ResponderStart_PSK( ~id_r.3, ~psk.3, ID_CRED_PSK_I.3 );"]:
   [
   State_121111111111121111111111112121( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                         ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                         method.6, suitesI.6
   )
   ]
  --[ ResponderStart_PSK( ~id_r.3, ~psk.3, ID_CRED_PSK_I.3 ) ]->
   [
   State_1211111111111211111111111121211( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                          ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                          method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventResponderStartPSKidrpskIDCREDPSKI_0_121111111111121111111111112121[color=#408048,
                                                                                           process="event ResponderStart_PSK( ~id_r.3, ~psk.3, ID_CRED_PSK_I.3 );"]:
     [
     State_121111111111121111111111112121( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                           ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ ResponderStart_PSK( ~id_r, ~psk, ID_CRED_PSK_I ) ]->
     [
     State_1211111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventNeqpskididrgrpid_0_1211111111111211111111111121211[color=#408048,
                                                                        process="event Neq( psk_id(~id_r.3), grpid );"]:
   [
   State_1211111111111211111111111121211( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                          ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                          method.6, suitesI.6
   )
   ]
  --[ Neq( psk_id(~id_r.3), grpid ) ]->
   [
   State_12111111111112111111111111212111( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                           ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                           method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventNeqpskididrgrpid_0_1211111111111211111111111121211[color=#408048,
                                                                           process="event Neq( psk_id(~id_r.3), grpid );"]:
     [
     State_1211111111111211111111111121211( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                            ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[ Neq( psk_id(~id_r), grpid ) ]->
     [
     State_12111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
  */

rule (modulo E) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_12111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.3,
               <
                hash(<wrap('g'^~Y.3), ~id_r.3, 
                      wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                 wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                     >), 
                suitesI.6, EAD_1.6, ~EAD_2.6, m1.6, 'g'^~Y.3, 
                decxor(<psk_id(~id_r.3), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                              wrap(hash(<wrap(method.6), 
                                                                         wrap(suitesI.6), 
                                                                         wrap(G_X.6), wrap(C_I.6), 
                                                                         wrap(ID_CRED_PSK_I.3), 
                                                                         EAD_1.6>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.3)),
                                  'mac_2',
                                  <~id_r.3, ID_CRED_PSK_I.3, 
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >), 
                                   psk_cred(~psk.3), ~EAD_2.6>,
                                  edhoc_mac_length), 
                        ~EAD_2.6>,
                       edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                  wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                      >),
                                 plaintext_length)), 
                ~id_r.3>
);"]:
   [
   State_12111111111112111111111111212111( ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3,
                                           ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6,
                                           method.6, suitesI.6
   )
   ]
  --[
  SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.3,
                 <
                  hash(<wrap('g'^~Y.3), ~id_r.3, 
                        wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                   wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                       >), 
                  suitesI.6, EAD_1.6, ~EAD_2.6, m1.6, 'g'^~Y.3, 
                  decxor(<psk_id(~id_r.3), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                          'salt_3e2m',
                                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                           wrap(G_X.6), wrap(C_I.6), 
                                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk.3)),
                                    'mac_2',
                                    <~id_r.3, ID_CRED_PSK_I.3, 
                                     hash(<wrap('g'^~Y.3), ~id_r.3, 
                                           wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                      wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                          >), 
                                     psk_cred(~psk.3), ~EAD_2.6>,
                                    edhoc_mac_length), 
                          ~EAD_2.6>,
                         edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >),
                                   plaintext_length)), 
                  ~id_r.3>
  )
  ]->
   [
   State_1211111111111211111111111121211111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                             ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                             G_X.6, m1.6, method.6, suitesI.6
   ),
   Out( <'g'^~Y.3, 
         decxor(<psk_id(~id_r.3), 
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.3)),
                           'mac_2',
                           <~id_r.3, ID_CRED_PSK_I.3, 
                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                  wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                             wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                 >), 
                            psk_cred(~psk.3), ~EAD_2.6>,
                           edhoc_mac_length), 
                 ~EAD_2.6>,
                edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                               >),
                          plaintext_length)), 
         ~id_r.3>
   )
   ]

  /*
  rule (modulo AC) eventSendRDataPSKmethodpskvariantIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADsuitesIEADEADmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidr_0_12111111111112111111111111212111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      process="event SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I.3,
               <
                hash(<wrap('g'^~Y.3), ~id_r.3, 
                      wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                 wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                     >), 
                suitesI.6, EAD_1.6, ~EAD_2.6, m1.6, 'g'^~Y.3, 
                decxor(<psk_id(~id_r.3), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                              wrap(hash(<wrap(method.6), 
                                                                         wrap(suitesI.6), 
                                                                         wrap(G_X.6), wrap(C_I.6), 
                                                                         wrap(ID_CRED_PSK_I.3), 
                                                                         EAD_1.6>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.3)),
                                  'mac_2',
                                  <~id_r.3, ID_CRED_PSK_I.3, 
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >), 
                                   psk_cred(~psk.3), ~EAD_2.6>,
                                  edhoc_mac_length), 
                        ~EAD_2.6>,
                       edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                  wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                      >),
                                 plaintext_length)), 
                ~id_r.3>
);"]:
     [
     State_12111111111112111111111111212111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                             ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     )
     ]
    --[
    SendRData_PSK( method_psk_variant1, ID_CRED_PSK_I,
                   <
                    hash(<wrap('g'^~Y), ~id_r, 
                          wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                     wrap(ID_CRED_PSK_I), EAD_1>))
                         >), 
                    suitesI, EAD_1, ~EAD_2, m1, 'g'^~Y, 
                    decxor(<psk_id(~id_r), 
                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >),
                                                            hash_length),
                                                  psk_cred(~psk)),
                                      'mac_2',
                                      <~id_r, ID_CRED_PSK_I, 
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >), 
                                       psk_cred(~psk), ~EAD_2>,
                                      edhoc_mac_length), 
                            ~EAD_2>,
                           edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >),
                                     plaintext_length)), 
                    ~id_r>
    )
    ]->
     [
     State_1211111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                               ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     ),
     Out( <'g'^~Y, 
           decxor(<psk_id(~id_r), 
                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk)),
                             'mac_2',
                             <~id_r, ID_CRED_PSK_I, 
                              hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >), 
                              psk_cred(~psk), ~EAD_2>,
                             edhoc_mac_length), 
                   ~EAD_2>,
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length)), 
           ~id_r>
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.32
       G_X   = G_X.40
       z     = G_X.40^~Y.32
    
    2. ~Y    = ~Y.38
       G_X   = z.52^inv(~Y.38)
       z     = z.52
    
    3. ~Y    = ~Y.164
       G_X   = x.318^x.319
       z     = x.318^(~Y.164*x.319)
    
    4. ~Y    = ~Y.172
       G_X   = x.334^inv((~Y.172*x.335))
       z     = x.334^inv(x.335)
    
    5. ~Y    = ~Y.172
       G_X   = x.334^(x.335*inv(~Y.172))
       z     = x.334^x.335
    
    6. ~Y    = ~Y.173
       G_X   = x.335^(x.336*inv((~Y.173*x.337)))
       z     = x.335^(x.336*inv(x.337))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) inm_0_1211111111111211111111111121211111[color=#408048,
                                                         process="in(m3.6);"]:
   [
   State_1211111111111211111111111121211111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                             ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                             G_X.6, m1.6, method.6, suitesI.6
   ),
   In( m3.6 )
   ]
  --[
  THRShared_PSK( psk_id(~id_r.3),
                 hash(<
                       wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                  wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                             wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                 >)), 
                       <psk_id(~id_r.3), 
                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                        'salt_3e2m',
                                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                         wrap(G_X.6), wrap(C_I.6), 
                                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                             >),
                                                        hash_length),
                                              psk_cred(~psk.3)),
                                  'mac_2',
                                  <~id_r.3, ID_CRED_PSK_I.3, 
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >), 
                                   psk_cred(~psk.3), ~EAD_2.6>,
                                  edhoc_mac_length), 
                        ~EAD_2.6>, 
                       psk_cred(~psk.3)>)
  )
  ]->
   [
   Let_1211111111111211111111111121211111111( <m3.6, 
                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                           G_X.6^~Y.3),
                                                                               'salt_3e2m',
                                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                     wrap(hash(<
                                                                                                wrap(method.6), 
                                                                                                wrap(suitesI.6), 
                                                                                                wrap(G_X.6), 
                                                                                                wrap(C_I.6), 
                                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                                EAD_1.6>))
                                                                                    >),
                                                                               hash_length),
                                                                     psk_cred(~psk.3)),
                                                         'k_3',
                                                         hash(<
                                                               wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                          wrap(hash(<wrap(method.6), 
                                                                                     wrap(suitesI.6), 
                                                                                     wrap(G_X.6), 
                                                                                     wrap(C_I.6), 
                                                                                     wrap(ID_CRED_PSK_I.3), 
                                                                                     EAD_1.6>))
                                                                         >)), 
                                                               <psk_id(~id_r.3), 
                                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                            G_X.6^~Y.3),
                                                                                                'salt_3e2m',
                                                                                                hash(<
                                                                                                      wrap('g'^~Y.3), 
                                                                                                      ~id_r.3, 
                                                                                                      wrap(hash(<
                                                                                                                 wrap(method.6), 
                                                                                                                 wrap(suitesI.6), 
                                                                                                                 wrap(G_X.6), 
                                                                                                                 wrap(C_I.6), 
                                                                                                                 wrap(ID_CRED_PSK_I.3), 
                                                                                                                 EAD_1.6
                                                                                                                >))
                                                                                                     >),
                                                                                                hash_length),
                                                                                      psk_cred(~psk.3)),
                                                                          'mac_2',
                                                                          <~id_r.3, ID_CRED_PSK_I.3, 
                                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                 wrap(hash(<wrap(method.6), 
                                                                                            wrap(suitesI.6), 
                                                                                            wrap(G_X.6), 
                                                                                            wrap(C_I.6), 
                                                                                            wrap(ID_CRED_PSK_I.3), 
                                                                                            EAD_1.6>))
                                                                                >), 
                                                                           psk_cred(~psk.3), ~EAD_2.6>,
                                                                          edhoc_mac_length), 
                                                                ~EAD_2.6>, 
                                                               psk_cred(~psk.3)>),
                                                         key_length), 
                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                           G_X.6^~Y.3),
                                                                               'salt_3e2m',
                                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                     wrap(hash(<
                                                                                                wrap(method.6), 
                                                                                                wrap(suitesI.6), 
                                                                                                wrap(G_X.6), 
                                                                                                wrap(C_I.6), 
                                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                                EAD_1.6>))
                                                                                    >),
                                                                               hash_length),
                                                                     psk_cred(~psk.3)),
                                                         'iv_3',
                                                         hash(<
                                                               wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                          wrap(hash(<wrap(method.6), 
                                                                                     wrap(suitesI.6), 
                                                                                     wrap(G_X.6), 
                                                                                     wrap(C_I.6), 
                                                                                     wrap(ID_CRED_PSK_I.3), 
                                                                                     EAD_1.6>))
                                                                         >)), 
                                                               <psk_id(~id_r.3), 
                                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                            G_X.6^~Y.3),
                                                                                                'salt_3e2m',
                                                                                                hash(<
                                                                                                      wrap('g'^~Y.3), 
                                                                                                      ~id_r.3, 
                                                                                                      wrap(hash(<
                                                                                                                 wrap(method.6), 
                                                                                                                 wrap(suitesI.6), 
                                                                                                                 wrap(G_X.6), 
                                                                                                                 wrap(C_I.6), 
                                                                                                                 wrap(ID_CRED_PSK_I.3), 
                                                                                                                 EAD_1.6
                                                                                                                >))
                                                                                                     >),
                                                                                                hash_length),
                                                                                      psk_cred(~psk.3)),
                                                                          'mac_2',
                                                                          <~id_r.3, ID_CRED_PSK_I.3, 
                                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                 wrap(hash(<wrap(method.6), 
                                                                                            wrap(suitesI.6), 
                                                                                            wrap(G_X.6), 
                                                                                            wrap(C_I.6), 
                                                                                            wrap(ID_CRED_PSK_I.3), 
                                                                                            EAD_1.6>))
                                                                                >), 
                                                                           psk_cred(~psk.3), ~EAD_2.6>,
                                                                          edhoc_mac_length), 
                                                                ~EAD_2.6>, 
                                                               psk_cred(~psk.3)>),
                                                         iv_length)
                                              >,
                                              ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                                              ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) inm_0_1211111111111211111111111121211111[color=#408048,
                                                            process="in(m3.6);"]:
     [
     State_1211111111111211111111111121211111( ~EAD_4, ~Y, ~id_i, ~id_r, ~psk,
                                               ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, method, suitesI
     ),
     In( m3 )
     ]
    --[
    THRShared_PSK( psk_id(~id_r),
                   hash(<
                         wrap(hash(<wrap('g'^~Y), ~id_r, 
                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                               wrap(ID_CRED_PSK_I), EAD_1>))
                                   >)), 
                         <psk_id(~id_r), 
                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                          hash(<wrap('g'^~Y), ~id_r, 
                                                                wrap(hash(<wrap(method), wrap(suitesI), 
                                                                           wrap(G_X), wrap(C_I), 
                                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                                               >),
                                                          hash_length),
                                                psk_cred(~psk)),
                                    'mac_2',
                                    <~id_r, ID_CRED_PSK_I, 
                                     hash(<wrap('g'^~Y), ~id_r, 
                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                      wrap(ID_CRED_PSK_I), EAD_1>))
                                          >), 
                                     psk_cred(~psk), ~EAD_2>,
                                    edhoc_mac_length), 
                          ~EAD_2>, 
                         psk_cred(~psk)>)
    )
    ]->
     [
     Let_1211111111111211111111111121211111111( <m3, 
                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                 'salt_3e2m',
                                                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                                                       wrap(hash(<
                                                                                                  wrap(method), 
                                                                                                  wrap(suitesI), 
                                                                                                  wrap(G_X), 
                                                                                                  wrap(C_I), 
                                                                                                  wrap(ID_CRED_PSK_I), 
                                                                                                  EAD_1>))
                                                                                      >),
                                                                                 hash_length),
                                                                       psk_cred(~psk)),
                                                           'k_3',
                                                           hash(<
                                                                 wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                            wrap(hash(<wrap(method), 
                                                                                       wrap(suitesI), 
                                                                                       wrap(G_X), wrap(C_I), 
                                                                                       wrap(ID_CRED_PSK_I), 
                                                                                       EAD_1>))
                                                                           >)), 
                                                                 <psk_id(~id_r), 
                                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                              z),
                                                                                                  'salt_3e2m',
                                                                                                  hash(<
                                                                                                        wrap('g'^~Y), 
                                                                                                        ~id_r, 
                                                                                                        wrap(hash(<
                                                                                                                   wrap(method), 
                                                                                                                   wrap(suitesI), 
                                                                                                                   wrap(G_X), 
                                                                                                                   wrap(C_I), 
                                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                                   EAD_1
                                                                                                                  >))
                                                                                                       >),
                                                                                                  hash_length),
                                                                                        psk_cred(~psk)),
                                                                            'mac_2',
                                                                            <~id_r, ID_CRED_PSK_I, 
                                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                                   wrap(hash(<wrap(method), 
                                                                                              wrap(suitesI), 
                                                                                              wrap(G_X), 
                                                                                              wrap(C_I), 
                                                                                              wrap(ID_CRED_PSK_I), 
                                                                                              EAD_1>))
                                                                                  >), 
                                                                             psk_cred(~psk), ~EAD_2>,
                                                                            edhoc_mac_length), 
                                                                  ~EAD_2>, 
                                                                 psk_cred(~psk)>),
                                                           key_length), 
                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                 'salt_3e2m',
                                                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                                                       wrap(hash(<
                                                                                                  wrap(method), 
                                                                                                  wrap(suitesI), 
                                                                                                  wrap(G_X), 
                                                                                                  wrap(C_I), 
                                                                                                  wrap(ID_CRED_PSK_I), 
                                                                                                  EAD_1>))
                                                                                      >),
                                                                                 hash_length),
                                                                       psk_cred(~psk)),
                                                           'iv_3',
                                                           hash(<
                                                                 wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                                            wrap(hash(<wrap(method), 
                                                                                       wrap(suitesI), 
                                                                                       wrap(G_X), wrap(C_I), 
                                                                                       wrap(ID_CRED_PSK_I), 
                                                                                       EAD_1>))
                                                                           >)), 
                                                                 <psk_id(~id_r), 
                                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                                              z),
                                                                                                  'salt_3e2m',
                                                                                                  hash(<
                                                                                                        wrap('g'^~Y), 
                                                                                                        ~id_r, 
                                                                                                        wrap(hash(<
                                                                                                                   wrap(method), 
                                                                                                                   wrap(suitesI), 
                                                                                                                   wrap(G_X), 
                                                                                                                   wrap(C_I), 
                                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                                   EAD_1
                                                                                                                  >))
                                                                                                       >),
                                                                                                  hash_length),
                                                                                        psk_cred(~psk)),
                                                                            'mac_2',
                                                                            <~id_r, ID_CRED_PSK_I, 
                                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                                   wrap(hash(<wrap(method), 
                                                                                              wrap(suitesI), 
                                                                                              wrap(G_X), 
                                                                                              wrap(C_I), 
                                                                                              wrap(ID_CRED_PSK_I), 
                                                                                              EAD_1>))
                                                                                  >), 
                                                                             psk_cred(~psk), ~EAD_2>,
                                                                            edhoc_mac_length), 
                                                                  ~EAD_2>, 
                                                                 psk_cred(~psk)>),
                                                           iv_length)
                                                >,
                                                ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.32
       G_X   = G_X.40
       z     = G_X.40^~Y.32
    
    2. ~Y    = ~Y.38
       G_X   = z.52^inv(~Y.38)
       z     = z.52
    
    3. ~Y    = ~Y.199
       G_X   = x.388^x.389
       z     = x.388^(~Y.199*x.389)
    
    4. ~Y    = ~Y.207
       G_X   = x.404^inv((~Y.207*x.405))
       z     = x.404^inv(x.405)
    
    5. ~Y    = ~Y.207
       G_X   = x.404^(x.405*inv(~Y.207))
       z     = x.404^x.405
    
    6. ~Y    = ~Y.208
       G_X   = x.405^(x.406*inv((~Y.208*x.407)))
       z     = x.405^(x.406*inv(x.407))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_121111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="let plaintext_3.6=aeaddec(m3.6,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.3)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.3)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>),
                  iv_length))"]:
   [
   Let_1211111111111211111111111121211111111( <
                                               aeadenc(plaintext_3.6, r, k, ad), k, ad>,
                                              ~EAD_4.3, ~Y.3, ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3,
                                              ~EAD_2.6, C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6, suitesI.6
   )
   ]
  -->
   [
   State_1211111111111211111111111121211111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) letplaintextaeaddecmedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlength_1_121111111111121111111111112121111111[color=#ffffff,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       process="let plaintext_3.6=aeaddec(m3.6,
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.3)),
                  'k_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>),
                  key_length),
        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                        'salt_3e2m',
                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >),
                                        hash_length),
                              psk_cred(~psk.3)),
                  'iv_3',
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>),
                  iv_length))"]:
     [
     Let_1211111111111211111111111121211111111( <
                                                 aeadenc(plaintext_3, r, k, ad), k, ad>,
                                                ~EAD_4, ~Y, ~id_i, ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I,
                                                EAD_1, G_X, m1, m3, method, suitesI
     )
     ]
    -->
     [
     State_1211111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                  ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                  method, plaintext_3, suitesI
     )
     ]
  */

rule (modulo E) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_1211111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                process="event AcceptR_PSK( ~id_r.3, method_psk_variant1, ID_CRED_PSK_I.3,
             psk_id(~id_r.3),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                              wrap(G_X.6), wrap(C_I.6), 
                                                              wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.3)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                              wrap(G_X.6), wrap(C_I.6), 
                                                              wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                  >)), 
                                        <psk_id(~id_r.3), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.6^~Y.3),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.3), 
                                                                               ~id_r.3, 
                                                                               wrap(hash(<
                                                                                          wrap(method.6), 
                                                                                          wrap(suitesI.6), 
                                                                                          wrap(G_X.6), 
                                                                                          wrap(C_I.6), 
                                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                                          EAD_1.6>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.3)),
                                                   'mac_2',
                                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                          wrap(hash(<wrap(method.6), 
                                                                     wrap(suitesI.6), wrap(G_X.6), 
                                                                     wrap(C_I.6), 
                                                                     wrap(ID_CRED_PSK_I.3), EAD_1.6
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.3), ~EAD_2.6>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.6>, 
                                        psk_cred(~psk.3)>)), 
                             plaintext_3.6, psk_cred(~psk.3)>),
                       hash_length)
);"]:
   [
   State_1211111111111211111111111121211111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]
  --[
  AcceptR_PSK( ~id_r.3, method_psk_variant1, ID_CRED_PSK_I.3,
               psk_id(~id_r.3),
               hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                     hash(<wrap('g'^~Y.3), ~id_r.3, 
                                           wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                      wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                          >),
                                     hash_length),
                           psk_cred(~psk.3)),
               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                               'salt_3e2m',
                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                     wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                                wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                    >),
                                               hash_length),
                                     psk_cred(~psk.3)),
                         'prk_out',
                         hash(<
                               wrap(hash(<
                                          wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                     wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                                wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                    >)), 
                                          <psk_id(~id_r.3), 
                                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                           'salt_3e2m',
                                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                 wrap(hash(<wrap(method.6), 
                                                                                            wrap(suitesI.6), 
                                                                                            wrap(G_X.6), 
                                                                                            wrap(C_I.6), 
                                                                                            wrap(ID_CRED_PSK_I.3), 
                                                                                            EAD_1.6>))
                                                                                >),
                                                                           hash_length),
                                                                 psk_cred(~psk.3)),
                                                     'mac_2',
                                                     <~id_r.3, ID_CRED_PSK_I.3, 
                                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                       wrap(G_X.6), wrap(C_I.6), 
                                                                       wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                           >), 
                                                      psk_cred(~psk.3), ~EAD_2.6>,
                                                     edhoc_mac_length), 
                                           ~EAD_2.6>, 
                                          psk_cred(~psk.3)>)), 
                               plaintext_3.6, psk_cred(~psk.3)>),
                         hash_length)
  )
  ]->
   [
   State_12111111111112111111111111212111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                 ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                 G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventAcceptRPSKidrmethodpskvariantIDCREDPSKIpskididrhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_1211111111111211111111111121211111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   process="event AcceptR_PSK( ~id_r.3, method_psk_variant1, ID_CRED_PSK_I.3,
             psk_id(~id_r.3),
             hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >),
                                   hash_length),
                         psk_cred(~psk.3)),
             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                             'salt_3e2m',
                                             hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                              wrap(G_X.6), wrap(C_I.6), 
                                                              wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                  >),
                                             hash_length),
                                   psk_cred(~psk.3)),
                       'prk_out',
                       hash(<
                             wrap(hash(<
                                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                              wrap(G_X.6), wrap(C_I.6), 
                                                              wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                  >)), 
                                        <psk_id(~id_r.3), 
                                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                     G_X.6^~Y.3),
                                                                         'salt_3e2m',
                                                                         hash(<wrap('g'^~Y.3), 
                                                                               ~id_r.3, 
                                                                               wrap(hash(<
                                                                                          wrap(method.6), 
                                                                                          wrap(suitesI.6), 
                                                                                          wrap(G_X.6), 
                                                                                          wrap(C_I.6), 
                                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                                          EAD_1.6>))
                                                                              >),
                                                                         hash_length),
                                                               psk_cred(~psk.3)),
                                                   'mac_2',
                                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                          wrap(hash(<wrap(method.6), 
                                                                     wrap(suitesI.6), wrap(G_X.6), 
                                                                     wrap(C_I.6), 
                                                                     wrap(ID_CRED_PSK_I.3), EAD_1.6
                                                                    >))
                                                         >), 
                                                    psk_cred(~psk.3), ~EAD_2.6>,
                                                   edhoc_mac_length), 
                                         ~EAD_2.6>, 
                                        psk_cred(~psk.3)>)), 
                             plaintext_3.6, psk_cred(~psk.3)>),
                       hash_length)
);"]:
     [
     State_1211111111111211111111111121211111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                  ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                  method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptR_PSK( ~id_r, method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r),
                 hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                       hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >),
                                       hash_length),
                             psk_cred(~psk)),
                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                  wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                      >)), 
                                            <psk_id(~id_r), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                                   wrap(hash(<wrap(method), 
                                                                                              wrap(suitesI), 
                                                                                              wrap(G_X), 
                                                                                              wrap(C_I), 
                                                                                              wrap(ID_CRED_PSK_I), 
                                                                                              EAD_1>))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk)),
                                                       'mac_2',
                                                       <~id_r, ID_CRED_PSK_I, 
                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                              wrap(hash(<wrap(method), wrap(suitesI), 
                                                                         wrap(G_X), wrap(C_I), 
                                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                                             >), 
                                                        psk_cred(~psk), ~EAD_2>,
                                                       edhoc_mac_length), 
                                             ~EAD_2>, 
                                            psk_cred(~psk)>)), 
                                 plaintext_3, psk_cred(~psk)>),
                           hash_length)
    )
    ]->
     [
     State_12111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.33
       G_X   = G_X.41
       z     = G_X.41^~Y.33
    
    2. ~Y    = ~Y.40
       G_X   = z.55^inv(~Y.40)
       z     = z.55
    
    3. ~Y    = ~Y.179
       G_X   = x.348^x.349
       z     = x.348^(~Y.179*x.349)
    
    4. ~Y    = ~Y.187
       G_X   = x.364^inv((~Y.187*x.365))
       z     = x.364^inv(x.365)
    
    5. ~Y    = ~Y.187
       G_X   = x.364^(x.365*inv(~Y.187))
       z     = x.364^x.365
    
    6. ~Y    = ~Y.188
       G_X   = x.365^(x.366*inv((~Y.188*x.367)))
       z     = x.365^(x.366*inv(x.367))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_12111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 process="event SessionSecrets_R( ~id_r.3, ~Y.3, G_X.6,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                        wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                   wrap(G_X.6), wrap(C_I.6), 
                                                                   wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.3)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                        wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                   wrap(G_X.6), wrap(C_I.6), 
                                                                   wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                       >)), 
                                             <psk_id(~id_r.3), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.6^~Y.3),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.3), 
                                                                                    ~id_r.3, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.6), 
                                                                                               wrap(suitesI.6), 
                                                                                               wrap(G_X.6), 
                                                                                               wrap(C_I.6), 
                                                                                               wrap(ID_CRED_PSK_I.3), 
                                                                                               EAD_1.6
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.3)),
                                                        'mac_2',
                                                        <~id_r.3, ID_CRED_PSK_I.3, 
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >), 
                                                         psk_cred(~psk.3), ~EAD_2.6>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.6>, 
                                             psk_cred(~psk.3)>)), 
                                  plaintext_3.6, psk_cred(~psk.3)>),
                            hash_length)
);"]:
   [
   State_12111111111112111111111111212111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                 ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                 G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]
  --[
  SessionSecrets_R( ~id_r.3, ~Y.3, G_X.6,
                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                    'salt_3e2m',
                                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                     wrap(G_X.6), wrap(C_I.6), 
                                                                     wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                         >),
                                                    hash_length),
                                          psk_cred(~psk.3)),
                              'prk_out',
                              hash(<
                                    wrap(hash(<
                                               wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                     wrap(G_X.6), wrap(C_I.6), 
                                                                     wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                         >)), 
                                               <psk_id(~id_r.3), 
                                                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                            G_X.6^~Y.3),
                                                                                'salt_3e2m',
                                                                                hash(<wrap('g'^~Y.3), 
                                                                                      ~id_r.3, 
                                                                                      wrap(hash(<
                                                                                                 wrap(method.6), 
                                                                                                 wrap(suitesI.6), 
                                                                                                 wrap(G_X.6), 
                                                                                                 wrap(C_I.6), 
                                                                                                 wrap(ID_CRED_PSK_I.3), 
                                                                                                 EAD_1.6>))
                                                                                     >),
                                                                                hash_length),
                                                                      psk_cred(~psk.3)),
                                                          'mac_2',
                                                          <~id_r.3, ID_CRED_PSK_I.3, 
                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                 wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                            wrap(G_X.6), wrap(C_I.6), 
                                                                            wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                                >), 
                                                           psk_cred(~psk.3), ~EAD_2.6>,
                                                          edhoc_mac_length), 
                                                ~EAD_2.6>, 
                                               psk_cred(~psk.3)>)), 
                                    plaintext_3.6, psk_cred(~psk.3)>),
                              hash_length)
  )
  ]->
   [
   State_121111111111121111111111112121111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                  ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                  G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventSessionSecretsRidrYGXedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlength_0_12111111111112111111111111212111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    process="event SessionSecrets_R( ~id_r.3, ~Y.3, G_X.6,
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                  'salt_3e2m',
                                                  hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                        wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                   wrap(G_X.6), wrap(C_I.6), 
                                                                   wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk.3)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                        wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                   wrap(G_X.6), wrap(C_I.6), 
                                                                   wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                       >)), 
                                             <psk_id(~id_r.3), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                          G_X.6^~Y.3),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y.3), 
                                                                                    ~id_r.3, 
                                                                                    wrap(hash(<
                                                                                               wrap(method.6), 
                                                                                               wrap(suitesI.6), 
                                                                                               wrap(G_X.6), 
                                                                                               wrap(C_I.6), 
                                                                                               wrap(ID_CRED_PSK_I.3), 
                                                                                               EAD_1.6
                                                                                              >))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk.3)),
                                                        'mac_2',
                                                        <~id_r.3, ID_CRED_PSK_I.3, 
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >), 
                                                         psk_cred(~psk.3), ~EAD_2.6>,
                                                        edhoc_mac_length), 
                                              ~EAD_2.6>, 
                                             psk_cred(~psk.3)>)), 
                                  plaintext_3.6, psk_cred(~psk.3)>),
                            hash_length)
);"]:
     [
     State_12111111111112111111111111212111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                   ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                   method, plaintext_3, suitesI
     )
     ]
    --[
    SessionSecrets_R( ~id_r, ~Y, G_X,
                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                      hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >),
                                                      hash_length),
                                            psk_cred(~psk)),
                                'prk_out',
                                hash(<
                                      wrap(hash(<
                                                 wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                            wrap(hash(<wrap(method), wrap(suitesI), 
                                                                       wrap(G_X), wrap(C_I), 
                                                                       wrap(ID_CRED_PSK_I), EAD_1>))
                                                           >)), 
                                                 <psk_id(~id_r), 
                                                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                  'salt_3e2m',
                                                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                                                        wrap(hash(<
                                                                                                   wrap(method), 
                                                                                                   wrap(suitesI), 
                                                                                                   wrap(G_X), 
                                                                                                   wrap(C_I), 
                                                                                                   wrap(ID_CRED_PSK_I), 
                                                                                                   EAD_1>))
                                                                                       >),
                                                                                  hash_length),
                                                                        psk_cred(~psk)),
                                                            'mac_2',
                                                            <~id_r, ID_CRED_PSK_I, 
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >), 
                                                             psk_cred(~psk), ~EAD_2>,
                                                            edhoc_mac_length), 
                                                  ~EAD_2>, 
                                                 psk_cred(~psk)>)), 
                                      plaintext_3, psk_cred(~psk)>),
                                hash_length)
    )
    ]->
     [
     State_121111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.33
       G_X   = G_X.41
       z     = G_X.41^~Y.33
    
    2. ~Y    = ~Y.40
       G_X   = z.55^inv(~Y.40)
       z     = z.55
    
    3. ~Y    = ~Y.179
       G_X   = x.348^x.349
       z     = x.348^(~Y.179*x.349)
    
    4. ~Y    = ~Y.187
       G_X   = x.364^inv((~Y.187*x.365))
       z     = x.364^inv(x.365)
    
    5. ~Y    = ~Y.187
       G_X   = x.364^(x.365*inv(~Y.187))
       z     = x.364^x.365
    
    6. ~Y    = ~Y.188
       G_X   = x.365^(x.366*inv((~Y.188*x.367)))
       z     = x.365^(x.366*inv(x.367))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_121111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               process="event SecretsR_PSK( ~id_r.3, ID_CRED_PSK_I.3, psk_id(~id_r.3),
              hkdfextract('null', G_X.6^~Y.3),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >)), 
                                         <psk_id(~id_r.3), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.6^~Y.3),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.3), 
                                                                                ~id_r.3, 
                                                                                wrap(hash(<
                                                                                           wrap(method.6), 
                                                                                           wrap(suitesI.6), 
                                                                                           wrap(G_X.6), 
                                                                                           wrap(C_I.6), 
                                                                                           wrap(ID_CRED_PSK_I.3), 
                                                                                           EAD_1.6
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.3)),
                                                    'mac_2',
                                                    <~id_r.3, ID_CRED_PSK_I.3, 
                                                     hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                           wrap(hash(<wrap(method.6), 
                                                                      wrap(suitesI.6), wrap(G_X.6), 
                                                                      wrap(C_I.6), 
                                                                      wrap(ID_CRED_PSK_I.3), EAD_1.6
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.3), ~EAD_2.6>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.6>, 
                                         psk_cred(~psk.3)>)), 
                              plaintext_3.6, psk_cred(~psk.3)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                              wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                         wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >)), 
                              <psk_id(~id_r.3), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                     wrap(hash(<wrap(method.6), 
                                                                                wrap(suitesI.6), 
                                                                                wrap(G_X.6), 
                                                                                wrap(C_I.6), 
                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                EAD_1.6>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.3)),
                                         'mac_2',
                                         <~id_r.3, ID_CRED_PSK_I.3, 
                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                           wrap(G_X.6), wrap(C_I.6), 
                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                               >), 
                                          psk_cred(~psk.3), ~EAD_2.6>,
                                         edhoc_mac_length), 
                               ~EAD_2.6>, 
                              psk_cred(~psk.3)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >)), 
                              <psk_id(~id_r.3), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                     wrap(hash(<wrap(method.6), 
                                                                                wrap(suitesI.6), 
                                                                                wrap(G_X.6), 
                                                                                wrap(C_I.6), 
                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                EAD_1.6>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.3)),
                                         'mac_2',
                                         <~id_r.3, ID_CRED_PSK_I.3, 
                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                           wrap(G_X.6), wrap(C_I.6), 
                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                               >), 
                                          psk_cred(~psk.3), ~EAD_2.6>,
                                         edhoc_mac_length), 
                               ~EAD_2.6>, 
                              psk_cred(~psk.3)>),
                        iv_length),
              ~Y.3, G_X.6
);"]:
   [
   State_121111111111121111111111112121111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                  ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                  G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]
  --[
  SecretsR_PSK( ~id_r.3, ID_CRED_PSK_I.3, psk_id(~id_r.3),
                hkdfextract('null', G_X.6^~Y.3),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                       wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                       wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >),
                                      hash_length),
                            psk_cred(~psk.3)),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'prk_out',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >)), 
                                           <psk_id(~id_r.3), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                  wrap(hash(<wrap(method.6), 
                                                                                             wrap(suitesI.6), 
                                                                                             wrap(G_X.6), 
                                                                                             wrap(C_I.6), 
                                                                                             wrap(ID_CRED_PSK_I.3), 
                                                                                             EAD_1.6>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.3)),
                                                      'mac_2',
                                                      <~id_r.3, ID_CRED_PSK_I.3, 
                                                       hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                             wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                        wrap(G_X.6), wrap(C_I.6), 
                                                                        wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                            >), 
                                                       psk_cred(~psk.3), ~EAD_2.6>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.6>, 
                                           psk_cred(~psk.3)>)), 
                                plaintext_3.6, psk_cred(~psk.3)>),
                          hash_length),
                edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                               >),
                          plaintext_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'k_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                           wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                      wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                          >)), 
                                <psk_id(~id_r.3), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                       wrap(hash(<wrap(method.6), 
                                                                                  wrap(suitesI.6), 
                                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                                  wrap(ID_CRED_PSK_I.3), 
                                                                                  EAD_1.6>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.3)),
                                           'mac_2',
                                           <~id_r.3, ID_CRED_PSK_I.3, 
                                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                  wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                             wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                 >), 
                                            psk_cred(~psk.3), ~EAD_2.6>,
                                           edhoc_mac_length), 
                                 ~EAD_2.6>, 
                                psk_cred(~psk.3)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'iv_3',
                          hash(<
                                wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                           wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                      wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                          >)), 
                                <psk_id(~id_r.3), 
                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                 'salt_3e2m',
                                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                       wrap(hash(<wrap(method.6), 
                                                                                  wrap(suitesI.6), 
                                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                                  wrap(ID_CRED_PSK_I.3), 
                                                                                  EAD_1.6>))
                                                                      >),
                                                                 hash_length),
                                                       psk_cred(~psk.3)),
                                           'mac_2',
                                           <~id_r.3, ID_CRED_PSK_I.3, 
                                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                  wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                             wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                 >), 
                                            psk_cred(~psk.3), ~EAD_2.6>,
                                           edhoc_mac_length), 
                                 ~EAD_2.6>, 
                                psk_cred(~psk.3)>),
                          iv_length),
                ~Y.3, G_X.6
  )
  ]->
   [
   State_1211111111111211111111111121211111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                   ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                   G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]

  /*
  rule (modulo AC) eventSecretsRPSKidrIDCREDPSKIpskididrhkdfextractnullGXYhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskkhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskkeylengthedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskivhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskivlengthYGX_0_121111111111121111111111112121111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event SecretsR_PSK( ~id_r.3, ID_CRED_PSK_I.3, psk_id(~id_r.3),
              hkdfextract('null', G_X.6^~Y.3),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'salt_3e2m',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    hash_length),
                          psk_cred(~psk.3)),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'prk_out',
                        hash(<
                              wrap(hash(<
                                         wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >)), 
                                         <psk_id(~id_r.3), 
                                          edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                      G_X.6^~Y.3),
                                                                          'salt_3e2m',
                                                                          hash(<wrap('g'^~Y.3), 
                                                                                ~id_r.3, 
                                                                                wrap(hash(<
                                                                                           wrap(method.6), 
                                                                                           wrap(suitesI.6), 
                                                                                           wrap(G_X.6), 
                                                                                           wrap(C_I.6), 
                                                                                           wrap(ID_CRED_PSK_I.3), 
                                                                                           EAD_1.6
                                                                                          >))
                                                                               >),
                                                                          hash_length),
                                                                psk_cred(~psk.3)),
                                                    'mac_2',
                                                    <~id_r.3, ID_CRED_PSK_I.3, 
                                                     hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                           wrap(hash(<wrap(method.6), 
                                                                      wrap(suitesI.6), wrap(G_X.6), 
                                                                      wrap(C_I.6), 
                                                                      wrap(ID_CRED_PSK_I.3), EAD_1.6
                                                                     >))
                                                          >), 
                                                     psk_cred(~psk.3), ~EAD_2.6>,
                                                    edhoc_mac_length), 
                                          ~EAD_2.6>, 
                                         psk_cred(~psk.3)>)), 
                              plaintext_3.6, psk_cred(~psk.3)>),
                        hash_length),
              edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                              wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                         wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                             >),
                        plaintext_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'k_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >)), 
                              <psk_id(~id_r.3), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                     wrap(hash(<wrap(method.6), 
                                                                                wrap(suitesI.6), 
                                                                                wrap(G_X.6), 
                                                                                wrap(C_I.6), 
                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                EAD_1.6>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.3)),
                                         'mac_2',
                                         <~id_r.3, ID_CRED_PSK_I.3, 
                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                           wrap(G_X.6), wrap(C_I.6), 
                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                               >), 
                                          psk_cred(~psk.3), ~EAD_2.6>,
                                         edhoc_mac_length), 
                               ~EAD_2.6>, 
                              psk_cred(~psk.3)>),
                        key_length),
              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                              'salt_3e2m',
                                              hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                    wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                               wrap(G_X.6), wrap(C_I.6), 
                                                               wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                   >),
                                              hash_length),
                                    psk_cred(~psk.3)),
                        'iv_3',
                        hash(<
                              wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                    wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                        >)), 
                              <psk_id(~id_r.3), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                               'salt_3e2m',
                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                     wrap(hash(<wrap(method.6), 
                                                                                wrap(suitesI.6), 
                                                                                wrap(G_X.6), 
                                                                                wrap(C_I.6), 
                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                EAD_1.6>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk.3)),
                                         'mac_2',
                                         <~id_r.3, ID_CRED_PSK_I.3, 
                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                           wrap(G_X.6), wrap(C_I.6), 
                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                               >), 
                                          psk_cred(~psk.3), ~EAD_2.6>,
                                         edhoc_mac_length), 
                               ~EAD_2.6>, 
                              psk_cred(~psk.3)>),
                        iv_length),
              ~Y.3, G_X.6
);"]:
     [
     State_121111111111121111111111112121111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                    ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                    method, plaintext_3, suitesI
     )
     ]
    --[
    SecretsR_PSK( ~id_r, ID_CRED_PSK_I, psk_id(~id_r),
                  hkdfextract('null', z),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        hash_length),
                              psk_cred(~psk)),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'prk_out',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            hash_length),
                  edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                            hash(<wrap('g'^~Y), ~id_r, 
                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                 >),
                            plaintext_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_3',
                            hash(<
                                  wrap(hash(<wrap('g'^~Y), ~id_r, 
                                             wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                        wrap(ID_CRED_PSK_I), EAD_1>))
                                            >)), 
                                  <psk_id(~id_r), 
                                   edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                                         wrap(hash(<wrap(method), 
                                                                                    wrap(suitesI), wrap(G_X), 
                                                                                    wrap(C_I), 
                                                                                    wrap(ID_CRED_PSK_I), EAD_1
                                                                                   >))
                                                                        >),
                                                                   hash_length),
                                                         psk_cred(~psk)),
                                             'mac_2',
                                             <~id_r, ID_CRED_PSK_I, 
                                              hash(<wrap('g'^~Y), ~id_r, 
                                                    wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                               wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                   >), 
                                              psk_cred(~psk), ~EAD_2>,
                                             edhoc_mac_length), 
                                   ~EAD_2>, 
                                  psk_cred(~psk)>),
                            iv_length),
                  ~Y, G_X
    )
    ]->
     [
     State_1211111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.33
       G_X   = G_X.41
       z     = G_X.41^~Y.33
    
    2. ~Y    = ~Y.40
       G_X   = z.55^inv(~Y.40)
       z     = z.55
    
    3. ~Y    = ~Y.272
       G_X   = x.534^x.535
       z     = x.534^(~Y.272*x.535)
    
    4. ~Y    = ~Y.280
       G_X   = x.550^inv((~Y.280*x.551))
       z     = x.550^inv(x.551)
    
    5. ~Y    = ~Y.280
       G_X   = x.550^(x.551*inv(~Y.280))
       z     = x.550^x.551
    
    6. ~Y    = ~Y.281
       G_X   = x.551^(x.552*inv((~Y.281*x.553)))
       z     = x.551^(x.552*inv(x.553))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_12111111111112111111111111212111111111111111[color=#408072,
                                                                                       process="event LeakSessionKey( 'null' );"]:
   [
   State_12111111111112111111111111212111111111111111( ~EAD_4.3, ~Y.3,
                                                       ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6,
                                                       C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6,
                                                       plaintext_3.6, suitesI.6
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_12111111111112111111111111212111111111111111[color=#408072,
                                                                                          process="event LeakSessionKey( 'null' );"]:
     [
     State_12111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_1211111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.6^~Y.3),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.3)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >)), 
                                            <psk_id(~id_r.3), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.6^~Y.3),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.3), 
                                                                                   ~id_r.3, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.6), 
                                                                                              wrap(suitesI.6), 
                                                                                              wrap(G_X.6), 
                                                                                              wrap(C_I.6), 
                                                                                              wrap(ID_CRED_PSK_I.3), 
                                                                                              EAD_1.6
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.3)),
                                                       'mac_2',
                                                       <~id_r.3, ID_CRED_PSK_I.3, 
                                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                              wrap(hash(<wrap(method.6), 
                                                                         wrap(suitesI.6), 
                                                                         wrap(G_X.6), wrap(C_I.6), 
                                                                         wrap(ID_CRED_PSK_I.3), 
                                                                         EAD_1.6>))
                                                             >), 
                                                        psk_cred(~psk.3), ~EAD_2.6>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.6>, 
                                            psk_cred(~psk.3)>)), 
                                 plaintext_3.6, psk_cred(~psk.3)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.3, psk_id(~id_r.3), ~Y.3, G_X.6,
                 <
                  hash(<wrap('g'^~Y.3), ~id_r.3, 
                        wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                   wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >)), 
                                   <psk_id(~id_r.3), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                          wrap(hash(<
                                                                                     wrap(method.6), 
                                                                                     wrap(suitesI.6), 
                                                                                     wrap(G_X.6), 
                                                                                     wrap(C_I.6), 
                                                                                     wrap(ID_CRED_PSK_I.3), 
                                                                                     EAD_1.6>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.3)),
                                              'mac_2',
                                              <~id_r.3, ID_CRED_PSK_I.3, 
                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                     wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                wrap(G_X.6), wrap(C_I.6), 
                                                                wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                    >), 
                                               psk_cred(~psk.3), ~EAD_2.6>,
                                              edhoc_mac_length), 
                                    ~EAD_2.6>, 
                                   psk_cred(~psk.3)>)), 
                        plaintext_3.6, psk_cred(~psk.3)>), 
                  suitesI.6, EAD_1.6, ~EAD_2.6, plaintext_3.6, m1.6, 
                  <'g'^~Y.3, 
                   decxor(<psk_id(~id_r.3), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                 wrap(hash(<wrap(method.6), 
                                                                            wrap(suitesI.6), 
                                                                            wrap(G_X.6), 
                                                                            wrap(C_I.6), 
                                                                            wrap(ID_CRED_PSK_I.3), 
                                                                            EAD_1.6>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.3)),
                                     'mac_2',
                                     <~id_r.3, ID_CRED_PSK_I.3, 
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                       wrap(G_X.6), wrap(C_I.6), 
                                                       wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >), 
                                      psk_cred(~psk.3), ~EAD_2.6>,
                                     edhoc_mac_length), 
                           ~EAD_2.6>,
                          edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.3>, 
                  m3.6>
);"]:
   [
   State_1211111111111211111111111121211111111111( ~EAD_4.3, ~Y.3, ~id_i.3,
                                                   ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6, C_I.6, EAD_1.6,
                                                   G_X.6, m1.6, m3.6, method.6, plaintext_3.6, suitesI.6
   )
   ]
  --[
  AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                               G_X.6^~Y.3),
                                                   'salt_3e2m',
                                                   hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                    wrap(G_X.6), wrap(C_I.6), 
                                                                    wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                        >),
                                                   hash_length),
                                         psk_cred(~psk.3)),
                             'prk_out',
                             hash(<
                                   wrap(hash(<
                                              wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                         wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                    wrap(G_X.6), wrap(C_I.6), 
                                                                    wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                        >)), 
                                              <psk_id(~id_r.3), 
                                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                           G_X.6^~Y.3),
                                                                               'salt_3e2m',
                                                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                     wrap(hash(<
                                                                                                wrap(method.6), 
                                                                                                wrap(suitesI.6), 
                                                                                                wrap(G_X.6), 
                                                                                                wrap(C_I.6), 
                                                                                                wrap(ID_CRED_PSK_I.3), 
                                                                                                EAD_1.6>))
                                                                                    >),
                                                                               hash_length),
                                                                     psk_cred(~psk.3)),
                                                         'mac_2',
                                                         <~id_r.3, ID_CRED_PSK_I.3, 
                                                          hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                           wrap(G_X.6), wrap(C_I.6), 
                                                                           wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                               >), 
                                                          psk_cred(~psk.3), ~EAD_2.6>,
                                                         edhoc_mac_length), 
                                               ~EAD_2.6>, 
                                              psk_cred(~psk.3)>)), 
                                   plaintext_3.6, psk_cred(~psk.3)>),
                             hash_length),
                   method_psk_variant1, ID_CRED_PSK_I.3, psk_id(~id_r.3), ~Y.3, G_X.6,
                   <
                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                     wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                         >), 
                    hash(<
                          wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                     wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), wrap(C_I.6), 
                                                wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                    >)), 
                          <psk_id(~id_r.3), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                 wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                            wrap(G_X.6), wrap(C_I.6), 
                                                                            wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.3)),
                                     'mac_2',
                                     <~id_r.3, ID_CRED_PSK_I.3, 
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                       wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >), 
                                      psk_cred(~psk.3), ~EAD_2.6>,
                                     edhoc_mac_length), 
                           ~EAD_2.6>, 
                          psk_cred(~psk.3)>), 
                    hash(<
                          wrap(hash(<
                                     wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                           wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                               >)), 
                                     <psk_id(~id_r.3), 
                                      edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                      'salt_3e2m',
                                                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                            wrap(hash(<wrap(method.6), 
                                                                                       wrap(suitesI.6), 
                                                                                       wrap(G_X.6), 
                                                                                       wrap(C_I.6), 
                                                                                       wrap(ID_CRED_PSK_I.3), 
                                                                                       EAD_1.6>))
                                                                           >),
                                                                      hash_length),
                                                            psk_cred(~psk.3)),
                                                'mac_2',
                                                <~id_r.3, ID_CRED_PSK_I.3, 
                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >), 
                                                 psk_cred(~psk.3), ~EAD_2.6>,
                                                edhoc_mac_length), 
                                      ~EAD_2.6>, 
                                     psk_cred(~psk.3)>)), 
                          plaintext_3.6, psk_cred(~psk.3)>), 
                    suitesI.6, EAD_1.6, ~EAD_2.6, plaintext_3.6, m1.6, 
                    <'g'^~Y.3, 
                     decxor(<psk_id(~id_r.3), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                             'salt_3e2m',
                                                             hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                   wrap(hash(<wrap(method.6), 
                                                                              wrap(suitesI.6), wrap(G_X.6), 
                                                                              wrap(C_I.6), 
                                                                              wrap(ID_CRED_PSK_I.3), EAD_1.6
                                                                             >))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk.3)),
                                       'mac_2',
                                       <~id_r.3, ID_CRED_PSK_I.3, 
                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                         wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >), 
                                        psk_cred(~psk.3), ~EAD_2.6>,
                                       edhoc_mac_length), 
                             ~EAD_2.6>,
                            edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                       wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >),
                                      plaintext_length)), 
                     ~id_r.3>, 
                    m3.6>
  )
  ]->
   [
   State_1211111111111211111111111121211111111111121( ~EAD_4.3, ~Y.3,
                                                      ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6,
                                                      C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6,
                                                      plaintext_3.6, suitesI.6
   ),
   State_12111111111112111111111111212111111111111111( ~EAD_4.3, ~Y.3,
                                                       ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6,
                                                       C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6,
                                                       plaintext_3.6, suitesI.6
   ),
   Out( aeadenc(~EAD_4.3, 'rep',
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'k_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >)), 
                                           <psk_id(~id_r.3), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                  wrap(hash(<wrap(method.6), 
                                                                                             wrap(suitesI.6), 
                                                                                             wrap(G_X.6), 
                                                                                             wrap(C_I.6), 
                                                                                             wrap(ID_CRED_PSK_I.3), 
                                                                                             EAD_1.6>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.3)),
                                                      'mac_2',
                                                      <~id_r.3, ID_CRED_PSK_I.3, 
                                                       hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                             wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                        wrap(G_X.6), wrap(C_I.6), 
                                                                        wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                            >), 
                                                       psk_cred(~psk.3), ~EAD_2.6>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.6>, 
                                           psk_cred(~psk.3)>)), 
                                plaintext_3.6, psk_cred(~psk.3)>),
                          key_length),
                edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                'salt_3e2m',
                                                hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >),
                                                hash_length),
                                      psk_cred(~psk.3)),
                          'iv_4',
                          hash(<
                                wrap(hash(<
                                           wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                      wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                 wrap(G_X.6), wrap(C_I.6), 
                                                                 wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                     >)), 
                                           <psk_id(~id_r.3), 
                                            edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                            'salt_3e2m',
                                                                            hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                                  wrap(hash(<wrap(method.6), 
                                                                                             wrap(suitesI.6), 
                                                                                             wrap(G_X.6), 
                                                                                             wrap(C_I.6), 
                                                                                             wrap(ID_CRED_PSK_I.3), 
                                                                                             EAD_1.6>))
                                                                                 >),
                                                                            hash_length),
                                                                  psk_cred(~psk.3)),
                                                      'mac_2',
                                                      <~id_r.3, ID_CRED_PSK_I.3, 
                                                       hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                             wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                        wrap(G_X.6), wrap(C_I.6), 
                                                                        wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                            >), 
                                                       psk_cred(~psk.3), ~EAD_2.6>,
                                                      edhoc_mac_length), 
                                            ~EAD_2.6>, 
                                           psk_cred(~psk.3)>)), 
                                plaintext_3.6, psk_cred(~psk.3)>),
                          iv_length))
   )
   ]

  /*
  rule (modulo AC) eventAcceptRDataPSKedhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskprkouthashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpskhashlengthmethodpskvariantIDCREDPSKIpskididrYGXhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskhashwraphashwraphashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADpskcredpskplaintextpskcredpsksuitesIEADEADplaintextmgYdecxorpskididredhockdfhkdfextractedhockdfhkdfextractnullGXYsaltemhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADhashlengthpskcredpskmacidrIDCREDPSKIhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADpskcredpskEADedhocmaclengthEADedhockdfhkdfextractnullGXYkeystreamhashwrapgYidrwraphashwrapmethodwrapsuitesIwrapGXwrapCIwrapIDCREDPSKIEADplaintextlengthidrm_0_1211111111111211111111111121211111111111[color=#408048,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     process="event AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                             G_X.6^~Y.3),
                                                 'salt_3e2m',
                                                 hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >),
                                                 hash_length),
                                       psk_cred(~psk.3)),
                           'prk_out',
                           hash(<
                                 wrap(hash(<
                                            wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                       wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                  wrap(G_X.6), wrap(C_I.6), 
                                                                  wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                      >)), 
                                            <psk_id(~id_r.3), 
                                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null',
                                                                                         G_X.6^~Y.3),
                                                                             'salt_3e2m',
                                                                             hash(<wrap('g'^~Y.3), 
                                                                                   ~id_r.3, 
                                                                                   wrap(hash(<
                                                                                              wrap(method.6), 
                                                                                              wrap(suitesI.6), 
                                                                                              wrap(G_X.6), 
                                                                                              wrap(C_I.6), 
                                                                                              wrap(ID_CRED_PSK_I.3), 
                                                                                              EAD_1.6
                                                                                             >))
                                                                                  >),
                                                                             hash_length),
                                                                   psk_cred(~psk.3)),
                                                       'mac_2',
                                                       <~id_r.3, ID_CRED_PSK_I.3, 
                                                        hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                              wrap(hash(<wrap(method.6), 
                                                                         wrap(suitesI.6), 
                                                                         wrap(G_X.6), wrap(C_I.6), 
                                                                         wrap(ID_CRED_PSK_I.3), 
                                                                         EAD_1.6>))
                                                             >), 
                                                        psk_cred(~psk.3), ~EAD_2.6>,
                                                       edhoc_mac_length), 
                                             ~EAD_2.6>, 
                                            psk_cred(~psk.3)>)), 
                                 plaintext_3.6, psk_cred(~psk.3)>),
                           hash_length),
                 method_psk_variant1, ID_CRED_PSK_I.3, psk_id(~id_r.3), ~Y.3, G_X.6,
                 <
                  hash(<wrap('g'^~Y.3), ~id_r.3, 
                        wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                   wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                       >), 
                  hash(<
                        wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                   wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                              wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                  >)), 
                        <psk_id(~id_r.3), 
                         edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                         'salt_3e2m',
                                                         hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                               wrap(hash(<wrap(method.6), 
                                                                          wrap(suitesI.6), 
                                                                          wrap(G_X.6), wrap(C_I.6), 
                                                                          wrap(ID_CRED_PSK_I.3), 
                                                                          EAD_1.6>))
                                                              >),
                                                         hash_length),
                                               psk_cred(~psk.3)),
                                   'mac_2',
                                   <~id_r.3, ID_CRED_PSK_I.3, 
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >), 
                                    psk_cred(~psk.3), ~EAD_2.6>,
                                   edhoc_mac_length), 
                         ~EAD_2.6>, 
                        psk_cred(~psk.3)>), 
                  hash(<
                        wrap(hash(<
                                   wrap(hash(<wrap('g'^~Y.3), ~id_r.3, 
                                              wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                         wrap(G_X.6), wrap(C_I.6), 
                                                         wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                             >)), 
                                   <psk_id(~id_r.3), 
                                    edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                                    'salt_3e2m',
                                                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                          wrap(hash(<
                                                                                     wrap(method.6), 
                                                                                     wrap(suitesI.6), 
                                                                                     wrap(G_X.6), 
                                                                                     wrap(C_I.6), 
                                                                                     wrap(ID_CRED_PSK_I.3), 
                                                                                     EAD_1.6>))
                                                                         >),
                                                                    hash_length),
                                                          psk_cred(~psk.3)),
                                              'mac_2',
                                              <~id_r.3, ID_CRED_PSK_I.3, 
                                               hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                     wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                                wrap(G_X.6), wrap(C_I.6), 
                                                                wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                                    >), 
                                               psk_cred(~psk.3), ~EAD_2.6>,
                                              edhoc_mac_length), 
                                    ~EAD_2.6>, 
                                   psk_cred(~psk.3)>)), 
                        plaintext_3.6, psk_cred(~psk.3)>), 
                  suitesI.6, EAD_1.6, ~EAD_2.6, plaintext_3.6, m1.6, 
                  <'g'^~Y.3, 
                   decxor(<psk_id(~id_r.3), 
                           edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', G_X.6^~Y.3),
                                                           'salt_3e2m',
                                                           hash(<wrap('g'^~Y.3), ~id_r.3, 
                                                                 wrap(hash(<wrap(method.6), 
                                                                            wrap(suitesI.6), 
                                                                            wrap(G_X.6), 
                                                                            wrap(C_I.6), 
                                                                            wrap(ID_CRED_PSK_I.3), 
                                                                            EAD_1.6>))
                                                                >),
                                                           hash_length),
                                                 psk_cred(~psk.3)),
                                     'mac_2',
                                     <~id_r.3, ID_CRED_PSK_I.3, 
                                      hash(<wrap('g'^~Y.3), ~id_r.3, 
                                            wrap(hash(<wrap(method.6), wrap(suitesI.6), 
                                                       wrap(G_X.6), wrap(C_I.6), 
                                                       wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                           >), 
                                      psk_cred(~psk.3), ~EAD_2.6>,
                                     edhoc_mac_length), 
                           ~EAD_2.6>,
                          edhoc_kdf(hkdfextract('null', G_X.6^~Y.3), 'keystream_2',
                                    hash(<wrap('g'^~Y.3), ~id_r.3, 
                                          wrap(hash(<wrap(method.6), wrap(suitesI.6), wrap(G_X.6), 
                                                     wrap(C_I.6), wrap(ID_CRED_PSK_I.3), EAD_1.6>))
                                         >),
                                    plaintext_length)), 
                   ~id_r.3>, 
                  m3.6>
);"]:
     [
     State_1211111111111211111111111121211111111111( ~EAD_4, ~Y, ~id_i, ~id_r,
                                                     ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X, m1, m3,
                                                     method, plaintext_3, suitesI
     )
     ]
    --[
    AcceptRData_PSK( edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                     'salt_3e2m',
                                                     hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >),
                                                     hash_length),
                                           psk_cred(~psk)),
                               'prk_out',
                               hash(<
                                     wrap(hash(<
                                                wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                           wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                      wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                          >)), 
                                                <psk_id(~id_r), 
                                                 edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                                 'salt_3e2m',
                                                                                 hash(<wrap('g'^~Y), ~id_r, 
                                                                                       wrap(hash(<
                                                                                                  wrap(method), 
                                                                                                  wrap(suitesI), 
                                                                                                  wrap(G_X), 
                                                                                                  wrap(C_I), 
                                                                                                  wrap(ID_CRED_PSK_I), 
                                                                                                  EAD_1>))
                                                                                      >),
                                                                                 hash_length),
                                                                       psk_cred(~psk)),
                                                           'mac_2',
                                                           <~id_r, ID_CRED_PSK_I, 
                                                            hash(<wrap('g'^~Y), ~id_r, 
                                                                  wrap(hash(<wrap(method), wrap(suitesI), 
                                                                             wrap(G_X), wrap(C_I), 
                                                                             wrap(ID_CRED_PSK_I), EAD_1>))
                                                                 >), 
                                                            psk_cred(~psk), ~EAD_2>,
                                                           edhoc_mac_length), 
                                                 ~EAD_2>, 
                                                psk_cred(~psk)>)), 
                                     plaintext_3, psk_cred(~psk)>),
                               hash_length),
                     method_psk_variant1, ID_CRED_PSK_I, psk_id(~id_r), ~Y, G_X,
                     <
                      hash(<wrap('g'^~Y), ~id_r, 
                            wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                       wrap(ID_CRED_PSK_I), EAD_1>))
                           >), 
                      hash(<
                            wrap(hash(<wrap('g'^~Y), ~id_r, 
                                       wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                  wrap(ID_CRED_PSK_I), EAD_1>))
                                      >)), 
                            <psk_id(~id_r), 
                             edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                             hash(<wrap('g'^~Y), ~id_r, 
                                                                   wrap(hash(<wrap(method), wrap(suitesI), 
                                                                              wrap(G_X), wrap(C_I), 
                                                                              wrap(ID_CRED_PSK_I), EAD_1>))
                                                                  >),
                                                             hash_length),
                                                   psk_cred(~psk)),
                                       'mac_2',
                                       <~id_r, ID_CRED_PSK_I, 
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >), 
                                        psk_cred(~psk), ~EAD_2>,
                                       edhoc_mac_length), 
                             ~EAD_2>, 
                            psk_cred(~psk)>), 
                      hash(<
                            wrap(hash(<
                                       wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                  wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                             wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                 >)), 
                                       <psk_id(~id_r), 
                                        edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                                        hash(<wrap('g'^~Y), ~id_r, 
                                                                              wrap(hash(<wrap(method), 
                                                                                         wrap(suitesI), 
                                                                                         wrap(G_X), 
                                                                                         wrap(C_I), 
                                                                                         wrap(ID_CRED_PSK_I), 
                                                                                         EAD_1>))
                                                                             >),
                                                                        hash_length),
                                                              psk_cred(~psk)),
                                                  'mac_2',
                                                  <~id_r, ID_CRED_PSK_I, 
                                                   hash(<wrap('g'^~Y), ~id_r, 
                                                         wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                    wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                        >), 
                                                   psk_cred(~psk), ~EAD_2>,
                                                  edhoc_mac_length), 
                                        ~EAD_2>, 
                                       psk_cred(~psk)>)), 
                            plaintext_3, psk_cred(~psk)>), 
                      suitesI, EAD_1, ~EAD_2, plaintext_3, m1, 
                      <'g'^~Y, 
                       decxor(<psk_id(~id_r), 
                               edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                               hash(<wrap('g'^~Y), ~id_r, 
                                                                     wrap(hash(<wrap(method), wrap(suitesI), 
                                                                                wrap(G_X), wrap(C_I), 
                                                                                wrap(ID_CRED_PSK_I), EAD_1>))
                                                                    >),
                                                               hash_length),
                                                     psk_cred(~psk)),
                                         'mac_2',
                                         <~id_r, ID_CRED_PSK_I, 
                                          hash(<wrap('g'^~Y), ~id_r, 
                                                wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                           wrap(ID_CRED_PSK_I), EAD_1>))
                                               >), 
                                          psk_cred(~psk), ~EAD_2>,
                                         edhoc_mac_length), 
                               ~EAD_2>,
                              edhoc_kdf(hkdfextract('null', z), 'keystream_2',
                                        hash(<wrap('g'^~Y), ~id_r, 
                                              wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), wrap(C_I), 
                                                         wrap(ID_CRED_PSK_I), EAD_1>))
                                             >),
                                        plaintext_length)), 
                       ~id_r>, 
                      m3>
    )
    ]->
     [
     State_1211111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                        ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                        m1, m3, method, plaintext_3, suitesI
     ),
     State_12111111111112111111111111212111111111111111( ~EAD_4, ~Y, ~id_i,
                                                         ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                         m1, m3, method, plaintext_3, suitesI
     ),
     Out( aeadenc(~EAD_4, 'rep',
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'k_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            key_length),
                  edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z), 'salt_3e2m',
                                                  hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >),
                                                  hash_length),
                                        psk_cred(~psk)),
                            'iv_4',
                            hash(<
                                  wrap(hash(<
                                             wrap(hash(<wrap('g'^~Y), ~id_r, 
                                                        wrap(hash(<wrap(method), wrap(suitesI), wrap(G_X), 
                                                                   wrap(C_I), wrap(ID_CRED_PSK_I), EAD_1>))
                                                       >)), 
                                             <psk_id(~id_r), 
                                              edhoc_kdf(hkdfextract(edhoc_kdf(hkdfextract('null', z),
                                                                              'salt_3e2m',
                                                                              hash(<wrap('g'^~Y), ~id_r, 
                                                                                    wrap(hash(<wrap(method), 
                                                                                               wrap(suitesI), 
                                                                                               wrap(G_X), 
                                                                                               wrap(C_I), 
                                                                                               wrap(ID_CRED_PSK_I), 
                                                                                               EAD_1>))
                                                                                   >),
                                                                              hash_length),
                                                                    psk_cred(~psk)),
                                                        'mac_2',
                                                        <~id_r, ID_CRED_PSK_I, 
                                                         hash(<wrap('g'^~Y), ~id_r, 
                                                               wrap(hash(<wrap(method), wrap(suitesI), 
                                                                          wrap(G_X), wrap(C_I), 
                                                                          wrap(ID_CRED_PSK_I), EAD_1>))
                                                              >), 
                                                         psk_cred(~psk), ~EAD_2>,
                                                        edhoc_mac_length), 
                                              ~EAD_2>, 
                                             psk_cred(~psk)>)), 
                                  plaintext_3, psk_cred(~psk)>),
                            iv_length))
     )
     ]
    variants (modulo AC)
    1. ~Y    = ~Y.34
       G_X   = G_X.42
       z     = G_X.42^~Y.34
    
    2. ~Y    = ~Y.42
       G_X   = z.58^inv(~Y.42)
       z     = z.58
    
    3. ~Y    = ~Y.308
       G_X   = x.606^x.607
       z     = x.606^(~Y.308*x.607)
    
    4. ~Y    = ~Y.316
       G_X   = x.622^inv((~Y.316*x.623))
       z     = x.622^inv(x.623)
    
    5. ~Y    = ~Y.316
       G_X   = x.622^(x.623*inv(~Y.316))
       z     = x.622^x.623
    
    6. ~Y    = ~Y.317
       G_X   = x.623^(x.624*inv((~Y.317*x.625)))
       z     = x.623^(x.624*inv(x.625))
    
    7. G_X   = grpid
       z     = grpid
  */

rule (modulo E) eventLeakSessionKeynull_0_1211111111111211111111111121211111111111121[color=#408072,
                                                                                      process="event LeakSessionKey( 'null' );"]:
   [
   State_1211111111111211111111111121211111111111121( ~EAD_4.3, ~Y.3,
                                                      ~id_i.3, ~id_r.3, ~psk.3, ID_CRED_PSK_I.3, ~EAD_2.6,
                                                      C_I.6, EAD_1.6, G_X.6, m1.6, m3.6, method.6,
                                                      plaintext_3.6, suitesI.6
   )
   ]
  --[ LeakSessionKey( 'null' ) ]->
   [ ]

  /*
  rule (modulo AC) eventLeakSessionKeynull_0_1211111111111211111111111121211111111111121[color=#408072,
                                                                                         process="event LeakSessionKey( 'null' );"]:
     [
     State_1211111111111211111111111121211111111111121( ~EAD_4, ~Y, ~id_i,
                                                        ~id_r, ~psk, ID_CRED_PSK_I, ~EAD_2, C_I, EAD_1, G_X,
                                                        m1, m3, method, plaintext_3, suitesI
     )
     ]
    --[ LeakSessionKey( 'null' ) ]->
     [ ]
  */

rule (modulo E) eventPSKGeneratedpsk_0_12111111111[color=#638040,
                                                   process="event PSKGenerated( ~psk.3 );"]:
   [ State_12111111111( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ PSKGenerated( ~psk.3 ) ]->
   [
   State_121111111111121( ~id_i.3, ~id_r.3, ~psk.3 ),
   State_121111111111111( ~id_i.3, ~id_r.3, ~psk.3 ),
   State_1211111111112( ~id_i.3, ~id_r.3, ~psk.3 )
   ]

  /*
  rule (modulo AC) eventPSKGeneratedpsk_0_12111111111[color=#638040,
                                                      process="event PSKGenerated( ~psk.3 );"]:
     [ State_12111111111( ~id_i, ~id_r, ~psk ) ]
    --[ PSKGenerated( ~psk ) ]->
     [
     State_121111111111121( ~id_i, ~id_r, ~psk ),
     State_121111111111111( ~id_i, ~id_r, ~psk ),
     State_1211111111112( ~id_i, ~id_r, ~psk )
     ]
  */

rule (modulo E) eventCompromisePSKpsk_0_1211111111112[color=#638040,
                                                      process="event CompromisePSK( ~psk.3 );"]:
   [ State_1211111111112( ~id_i.3, ~id_r.3, ~psk.3 ) ]
  --[ CompromisePSK( ~psk.3 ) ]->
   [ Out( ~psk.3 ) ]

  /*
  rule (modulo AC) eventCompromisePSKpsk_0_1211111111112[color=#638040,
                                                         process="event CompromisePSK( ~psk.3 );"]:
     [ State_1211111111112( ~id_i, ~id_r, ~psk ) ]
    --[ CompromisePSK( ~psk ) ]->
     [ Out( ~psk ) ]
  */

restriction single_session:
  "∀ #i #j. ((Init( ) @ #i) ∧ (Init( ) @ #j)) ⇒ (#i = #j)"
  // safety formula

/* All well-formedness checks were successful. */

end